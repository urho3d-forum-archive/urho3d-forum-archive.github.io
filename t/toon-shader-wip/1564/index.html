<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Toon Shader (WIP)</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Toon Shader (WIP)</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/55_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rasteron</div>
          <div class="post_content">
<p>This is still a WIP…</p>
<p><a data-bbcode="true" href="http://i.imgur.com/JCAkehi.png" rel="nofollow noopener"><img alt="" height="331" src="../../../images2/321981737192fbec0e410767fc564418.png" width="640"/></a></p>
<p>…and don’t ask about the mushroom headgear on the AIs, I know it’s weird. Just testing node attachments there  <img alt=":laughing:" class="emoji" src="../../../images2/b0fdc4fb6086de559ad986fd4b9c7c63.png" title=":laughing:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<p>nice, even shadow have a lines border )<br/>
did you use screen normal buffer for this freestyle lines effect ?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p>Maybe it will be useful<br/>
<a href="http://wiki.unity3d.com/index.php/TeamFortress2Shader">wiki.unity3d.com/index.php/TeamFortress2Shader</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<blockquote>
<p>Maybe it will be useful<br/>
it’s very interesting)<br/>
I try to figure out with this little bit, a made some simplest test with toon.<br/>
actually in this picture below I use only diffuse texture (diff + ao) + ramp ramp texture from wiki TF topic. And rim color falls (from world pos) from - sky as emissive color</p>
</blockquote>
<p><a data-bbcode="true" href="http://savepic.su/6769984.htm"><img alt="" height="" src="../../../images2/ce136f86c3dc920cf0c6eff531138914.png" width=""/></a></p>
<p>crappy shader (only for testing purpose) litSolidToon.glsl <a href="http://pastebin.com/gbMLBacG">pastebin.com/gbMLBacG</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/55_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rasteron</div>
          <div class="post_content">
<p>[quote=“codingmonkey”]nice, even shadow have a lines border )<br/>
did you use screen normal buffer for this freestyle lines effect ?[/quote]</p>
<p>Thanks. <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/> This was some older code that I was talking about on previous posts. It uses Sobel filters for edge detection.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/55_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rasteron</div>
          <div class="post_content">
<p>[quote=“codingmonkey”]&gt;Maybe it will be useful<br/>
it’s very interesting)<br/>
I try to figure out with this little bit, a made some simplest test with toon.<br/>
actually in this picture below I use only diffuse texture (diff + ao) + ramp ramp texture from wiki TF topic. And rim color falls (from world pos) from - sky as emissive color</p>
<p><a data-bbcode="true" href="http://savepic.su/6769984.htm" rel="nofollow noopener"><img alt="" height="" src="../../../images2/ce136f86c3dc920cf0c6eff531138914.png" width=""/></a></p>
<p>crappy shader (only for testing purpose) litSolidToon.glsl <a href="http://pastebin.com/gbMLBacG" rel="nofollow noopener">pastebin.com/gbMLBacG</a>[/quote]</p>
<p>Nice, still looks close from reference though.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p>[quote=“codingmonkey”]&gt;<br/>
crappy shader (only for testing purpose) litSolidToon.glsl <a href="http://pastebin.com/gbMLBacG">pastebin.com/gbMLBacG</a>[/quote]</p>
<p>It uses default lighting</p>
<pre><code class="lang-auto">float diff = GetDiffuse(normal, vWorldPos.xyz, lightDir);</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p>Urho used notnormalized directions ? It is correct?</p>
<pre><code class="lang-auto">float GetDiffuse(vec3 normal, vec3 worldPos, out vec3 lightDir)
{
        ...
        lightDir = cLightDirPS;
            ....
            return abs(dot(normal, lightDir));</code></pre>
<pre><code class="lang-auto">void PS()
{
    ...
    gl_FragColor = vec4(finalColor.rgb, 1.0);
    if (cLightDirPS != normalize(cLightDirPS))
        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}</code></pre>
<p><a data-bbcode="true" href="http://savepic.ru/8278727.htm"><img alt="" height="" src="../../../images2/a4aa89d2ed0a1dc99a1a5cc8c5e9706f.jpg" width=""/></a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p><a data-bbcode="true" href="http://savepic.ru/8318699.htm"><img alt="" height="" src="../../../images2/70cdd4ecb975a3a3122cb0b0b7a775dc.png" width=""/></a></p>
<p>Without self-shadowing and fog, only perpixel light sources and forward rendering</p>
<p>[code]void PS()<br/>
{<br/>
// DIFF<br/>
vec4 diffInput = texture2D(sDiffMap, vTexCoord.xy);<br/>
vec3 normal = normalize(vNormal);<br/>
float NdotL = dot(normal, normalize(cLightDirPS)) * 0.5 + 0.5;<br/>
NdotL = clamp(NdotL, 0.01, 0.99);<br/>
vec3 ramp = texture2D(sNormalMap, vec2(NdotL, 0.5)).rgb;<br/>
vec3 finalColor = diffInput.rgb * ramp;</p>
<pre><code>// SPEC
vec3 cameraDir = cCameraPosPS - vWorldPos.xyz;
vec3 h = normalize(normalize(cLightDirPS) + normalize(cameraDir));
float nh = max(0, dot(normal, h));
float spec = pow(nh, 64);
finalColor += cLightColor.rgb * spec;

// RIM
vec3 rimDir = normalize(cameraDir);
float rimContribution = 1.0 - dot(normal, rimDir);
rimContribution = clamp(rimContribution, 0.0, 1.0);
rimContribution = pow(rimContribution, cRimPower);
rimContribution = clamp(rimContribution, 0.0, 1.0);
vec3 rimColor = rimContribution* cRimColor.rgb * cRimColor.a;
finalColor += rimColor;

gl_FragColor = vec4(finalColor.rgb, 1.0);
</code></pre>
<p>}<br/>
[/code]</p>
<p>Also i use ramp texture<br/>
<img alt="" height="" src="../../../images2/73e254d89a93eb799450d529f874e5f9.png" width=""/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p>Add selfshadowing and fog</p>
<p><a data-bbcode="true" href="http://savepic.ru/8322801.htm"><img alt="" height="" src="../../../images2/c0a255929bbb405d0f68de6d74eac352.png" width=""/></a></p>
<pre><code class="lang-auto">void PS()
{
    // DIFF
    vec4 diffInput = texture2D(sDiffMap, vTexCoord.xy);
    vec3 normal = normalize(vNormal);
    float NdotL = dot(normal, normalize(cLightDirPS)) * 0.5 + 0.5;
    NdotL = clamp(NdotL, 0.01, 0.99);
    vec3 ramp = texture2D(sNormalMap, vec2(NdotL, 0.5)).rgb;
    #ifdef SHADOW
       ramp *= GetShadow(vShadowPos, vWorldPos.w);
    #endif
    ramp += cAmbientColor;
    ramp = clamp(ramp, 0.0, 1.0);
    vec3 finalColor = diffInput.rgb * ramp;
    
    // SPEC
    vec3 cameraDir = cCameraPosPS - vWorldPos.xyz;
    vec3 h = normalize(normalize(cLightDirPS) + normalize(cameraDir));
    float nh = max(0, dot(normal, h));
    float spec = pow(nh, 64);
    finalColor += cLightColor.rgb * spec;

    // RIM
    vec3 rimDir = normalize(cameraDir);
    float rimContribution = 1.0 - dot(normal, rimDir);
    rimContribution = clamp(rimContribution, 0.0, 1.0);
    rimContribution = pow(rimContribution, cRimPower);
    rimContribution = clamp(rimContribution, 0.0, 1.0);
    vec3 rimColor = rimContribution* cRimColor.rgb * cRimColor.a;
    finalColor += rimColor;
    
    // FOG
    #ifdef HEIGHTFOG
        float fogFactor = GetHeightFogFactor(vWorldPos.w, vWorldPos.y);
    #else
        float fogFactor = GetFogFactor(vWorldPos.w);
    #endif
    finalColor = GetFog(finalColor, fogFactor);
    
    gl_FragColor = vec4(finalColor.rgb, 1.0);
}</code></pre>
<p>For correct working it is needed to move the center of gradient to the bright side</p>
<p><img alt="" height="" src="../../../images2/ee302fdd98f5fcc680a715e4e2c3e2d1.png" width=""/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p>Rim to outline (not perfect)</p>
<p><a data-bbcode="true" href="http://savepic.ru/8317441.htm"><img alt="" height="" src="../../../images2/98b754648aff06aeac260f6b76c2e11b.png" width=""/></a></p>
<pre><code class="lang-auto">void PS()
{
    // DIFF
    vec4 diffInput = texture2D(sDiffMap, vTexCoord.xy);
    vec3 normal = normalize(vNormal);
    float NdotL = dot(normal, normalize(cLightDirPS)) * 0.5 + 0.5;
    NdotL = clamp(NdotL, 0.01, 0.99);
    vec3 ramp = texture2D(sNormalMap, vec2(NdotL, 0.5)).rgb;
    #ifdef SHADOW
       ramp *= GetShadow(vShadowPos, vWorldPos.w);
    #endif
    ramp += cAmbientColor;
    ramp = clamp(ramp, 0.0, 1.0);
    vec3 finalColor = diffInput.rgb * ramp;
    
    // SPEC
    vec3 cameraDir = cCameraPosPS - vWorldPos.xyz;
    vec3 h = normalize(normalize(cLightDirPS) + normalize(cameraDir));
    float nh = max(0, dot(normal, h));
    float spec = pow(nh, 64);
    finalColor += cLightColor.rgb * spec;

    // BLACK RIM
    vec3 rimDir = normalize(cameraDir);
    float rimContribution = dot(normal, rimDir);
    rimContribution = clamp(rimContribution * 1.5, 0.0, 1.0);
    finalColor *= rimContribution;
    
    // FOG
    #ifdef HEIGHTFOG
        float fogFactor = GetHeightFogFactor(vWorldPos.w, vWorldPos.y);
    #else
        float fogFactor = GetFogFactor(vWorldPos.w);
    #endif
    finalColor = GetFog(finalColor, fogFactor);
    
    gl_FragColor = vec4(finalColor.rgb, 1.0);
}</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">thebluefish</div>
          <div class="post_content">
<p>I’m totally going to grab that rim shader, I’ve always wanted rim lighting <img alt=":stuck_out_tongue:" class="emoji" src="../../../images2/31a2303e479834609bf5befdf8c3501a.png" title=":stuck_out_tongue:"/></p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>