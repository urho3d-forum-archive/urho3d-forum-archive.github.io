<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Problem for playing an animation with some Blender models</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Problem for playing an animation with some Blender models</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/750_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">crisx</div>
          <div class="post_content">
<p>Hello,</p>
<p>I’m a beginner with both Blender and the engine, and I’m having difficulties with some animated models.<br/>
I’m successfully exporting the blender model to .fbx with the default options, and using AssetImporter to create both the .mdl files and .ani files, the generated model works just fine, but sometimes none of the animations seems to do anything</p>
<p>Here’s the sample of code I’m using</p>
<pre><code>				AnimatedModel* Object = tileNode-&gt;CreateComponent&lt;AnimatedModel&gt;();
				RigidBody* Body = tileNode-&gt;CreateComponent&lt;RigidBody&gt;();
				CollisionShape* Shape = tileNode-&gt;CreateComponent&lt;CollisionShape&gt;();
				Shape-&gt;SetSphere(1.0f);
				Body-&gt;SetMass(0.1f);
				Body-&gt;SetGravityOverride(Vector3(0.0, 0.0, 0.0));
				Body-&gt;SetUseGravity(false);
				Body-&gt;SetLinearDamping(0.0f);
				Body-&gt;SetAngularDamping(0.0f);
				Body-&gt;SetAngularVelocity(Vector3(0.0, 0.0, 0.0));
				Body-&gt;SetCollisionLayer(1);
				Object-&gt;SetModel(cache-&gt;GetResource&lt;Model&gt;("Models/Train.mdl"));
				Object-&gt;SetCastShadows(true);
				Object-&gt;SetMaterial(cache-&gt;GetResource&lt;Material&gt;("Materials/Stone.xml"));
				AnimationController* Animated = tileNode-&gt;CreateComponent&lt;AnimationController&gt;();
				Animated-&gt;Play("Models/Train_MiddleWheelCDABigWhellIPO.ani", 0, true, 0.1f);
				Object-&gt;SetAnimationEnabled(true);
				//wheelAnimated-&gt;SetWeight("Models/Train_MiddleWheelCDABigWhellIPO.ani", 1.0f);
				Animated-&gt;SetSpeed("Models/Train_MiddleWheelCDABigWhellIPO.ani", 4.0);
</code></pre>
<p>Here’s one of the models I’m having issues with:<br/>
<aside class="onebox whitelistedgeneric">
<header class="source">
<img class="site-icon" height="96" src="../../../images2/fe92ddd1391c38225eedcd1d79245b8b.png" width="96"/>
<a href="https://uploadfiles.io/0uzvy" rel="nofollow noopener" target="_blank">uploadfiles.io</a>
</header>
<article class="onebox-body">
<div class="aspect-image" style="--aspect-ratio:690/443;"><img class="thumbnail" src="../../../images2/9e4240e828f8f81aac6d14ad0165cfc2.gif"/></div>
<h3><a href="https://uploadfiles.io/0uzvy" rel="nofollow noopener" target="_blank">Uploadfiles.io - 42846_Animated_Train.zip</a></h3>
<p>Upload files, for free, securely, anonymously, without limits. @UploadFilesFree</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
<p>Any help is welcomed <img alt=":grinning:" class="emoji" src="../../../images2/993cdd6d5aba3f941b7389fd0b3a1ba1.png" title=":grinning:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/768_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">1vanK</div>
          <div class="post_content">
<p><a href="https://github.com/reattiva/Urho3D-Blender">https://github.com/reattiva/Urho3D-Blender</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3290_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Modanung</div>
          <div class="post_content">
<p>What <span class="mention">@1vanK</span>  said.<br/>
Also you may want to consider joining the meshes and redoing the animation using an armature. This would make it possible to add the train as a single animated model that uses one animation.<br/>
Nice train though. It’ll look great with PBR. <span class="spoiler">Quick blender render:</span><br/>
<img alt="image" height="360" src="../../../images2/5752db5b12ddb39bf7e1f9534a648610.jpg" width="589"/></p>
<p>You’ll have to recreate the particle effect using the Urho Editor, btw. It will not be exported.</p>
<p>And welcome to the forums! <img alt=":confetti_ball:" class="emoji" src="../../../images2/2e7550946e098183e5e0689c128eb557.png" title=":confetti_ball:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/750_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">crisx</div>
          <div class="post_content">
<aside class="quote" data-post="3" data-topic="3490">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/8b9decec7cc30729aa8f8f7015602d32.png" width="20"/> Modanung:</div>
<blockquote>
<p>Also you may want to consider joining the meshes and redoing the animation using an armature.</p>
</blockquote>
</aside>
<p>OK I get it, I’ll try that.<br/>
Thanks!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/750_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">crisx</div>
          <div class="post_content">
<p>I was wondering, is it possible to play an animation associated to a mesh, not only to an armature? I have several independent animations on different meshes of the model:</p>
<p><img alt="Image2" height="330" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/1X/f74df4e9e2d2a4c0668ce283abf0de5c809e20e0.png" width="690"/></p>
<p>The .ani files are successfully created with AssetImporter.</p>
<p>Train_MiddleWheel.001CDABigWhellIPO.001.ani<br/>
Train_MiddleWheel.001CDABigWhellIPO.002.ani<br/>
Train_MiddleWheel.001CDABigWhellIPO.ani<br/>
Train_MiddleWheel.002CDABigWhellIPO.001.ani<br/>
Train_MiddleWheel.002CDABigWhellIPO.002.ani<br/>
Train_MiddleWheel.002CDABigWhellIPO.ani<br/>
Train_MiddleWheelCDABigWhellIPO.001.ani<br/>
Train_MiddleWheelCDABigWhellIPO.002.ani<br/>
Train_MiddleWheelCDABigWhellIPO.ani<br/>
Train_SmallWheel2.001CDABigWhellIPO.001.ani<br/>
Train_SmallWheel2.001CDABigWhellIPO.002.ani<br/>
Train_SmallWheel2.001CDABigWhellIPO.ani<br/>
Train_SmallWheel2CDABigWhellIPO.001.ani<br/>
Train_SmallWheel2CDABigWhellIPO.002.ani<br/>
Train_SmallWheel2CDABigWhellIPO.ani</p>
<p>When I try to play them, nothing happens, I must do something wrong. I found the instructions related to this topic in the documentation here:</p>
<p><a class="onebox" href="https://urho3d.github.io/documentation/1.5/_skeletal_animation.html" rel="nofollow noopener" target="_blank">https://urho3d.github.io/documentation/1.5/_skeletal_animation.html</a></p>
<p>It says:</p>
<p>"Animations can also be applied outside of an AnimatedModel’s bone hierarchy, to control the transforms of named nodes in the scene. The AssetImporter utility will automatically save node animations in both model or scene modes to the output file directory.</p>
<p>Like with skeletal animations, there are two ways to play back node animations:</p>
<p>Instantiate an AnimationState yourself, using the constructor which takes a root scene node (animated nodes are searched for as children of this node) and an animation pointer. You need to manually advance its time position, and then call Apply() to apply to the scene nodes.<br/>
Create an AnimationController component to the root scene node of the animation. This node should not contain an AnimatedModel component. Use the AnimationController to play back the animation just like you would play back a skeletal animation."</p>
<p>However i’m confuse about what is the proper code to do this, here’s what I tried:</p>
<pre><code>				AnimatedModel* Object = tileNode-&gt;CreateComponent&lt;AnimatedModel&gt;();
				RigidBody* Body = tileNode-&gt;CreateComponent&lt;RigidBody&gt;();
				CollisionShape* Shape = tileNode-&gt;CreateComponent&lt;CollisionShape&gt;();
				Shape-&gt;SetSphere(1.0f);
				Body-&gt;SetMass(0.1f);
				Body-&gt;SetGravityOverride(Vector3(0.0, 0.0, 0.0));
				Body-&gt;SetUseGravity(false);
				Body-&gt;SetLinearDamping(0.0f);
				Body-&gt;SetAngularDamping(0.0f);
				Body-&gt;SetAngularVelocity(Vector3(0.0, 0.0, 0.0));
				Body-&gt;SetCollisionLayer(1);
				Object-&gt;SetModel(cache-&gt;GetResource&lt;Model&gt;("Models/Train.mdl"));
				//wheelObject-&gt;SetModel(cache-&gt;GetResource&lt;Model&gt;("Models/castleguard.mdl"));
				Object-&gt;SetCastShadows(true);
				Object-&gt;SetMaterial(cache-&gt;GetResource&lt;Material&gt;("Materials/Stone.xml"));
				Animation* trainAnimation = cache-&gt;GetResource&lt;Animation&gt;("Models/Train_MiddleWheel.001CDABigWhellIPO.001.ani");
				trainAnimation-&gt;SetName("Train_MiddleWheel");
				AnimationState* state = Object-&gt;AddAnimationState(trainAnimation);
				if (state)
				{
					state-&gt;SetWeight(1.0f);
					state-&gt;SetLooped(true);
					state-&gt;SetTime(Random(trainAnimation-&gt;GetLength()));
				}
				AnimationController* Animated = tileNode-&gt;CreateComponent&lt;AnimationController&gt;();
				Animated-&gt;SetSpeed("Train_MiddleWheel", 1.0);
				Animated-&gt;Play("Train_MiddleWheel", 0, true, 0.1f);
</code></pre>
<p>Here’s the model files created with AssetImporter:<br/>
<a class="onebox" href="https://ufile.io/62h4o" rel="nofollow noopener" target="_blank">https://ufile.io/62h4o</a></p>
<p>If you have any idea <img alt=":grin:" class="emoji" src="/images/emoji/twitter/grin.png?v=9" title=":grin:"/></p>
<p>thanks</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3290_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Modanung</div>
          <div class="post_content">
<p>I have no personal experience with this.</p>
<p>Have you seen this thread?<br/>
<a class="onebox" href="https://discourse.urho3d.io/t/export-animated-node-transforms-to-urho3d/1067" target="_blank">https://discourse.urho3d.io/t/export-animated-node-transforms-to-urho3d/1067</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/750_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">crisx</div>
          <div class="post_content">
<p>I’ll take a look</p>
<p>thanks</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/788_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">johnnycable</div>
          <div class="post_content">
<p>I dug this up from somewhere:</p>
<pre><code>auto animateThem = [&amp;]() {

    // Create triangle animation
    SharedPtr&lt;ObjectAnimation&gt; triangleAnimation(new ObjectAnimation(context_));

    // Create triangle position animation
    SharedPtr&lt;ValueAnimation&gt; positionAnimation(new ValueAnimation(context_));
    // Use spline interpolation method
    positionAnimation-&gt;SetInterpolationMethod(IM_NONE);
    // Set spline tension
    positionAnimation-&gt;SetSplineTension(0.7f);
    positionAnimation-&gt;SetKeyFrame(0.0f, Vector3(1, 1, -1));
    positionAnimation-&gt;SetKeyFrame(1.0f, Vector3(-1, 1, -1));
    positionAnimation-&gt;SetKeyFrame(2.0f, Vector3(-1, -1, -1));
    positionAnimation-&gt;SetKeyFrame(3.0f, Vector3(1, -1, -1));
    positionAnimation-&gt;SetKeyFrame(4.0f, Vector3(1, 1, -1));

    // Set position animation
    triangleAnimation-&gt;AddAttributeAnimation("Position", positionAnimation);

    // Create spinning triangle animation
    SharedPtr&lt;ValueAnimation&gt; rotationAnimation(new ValueAnimation(context_));
    rotationAnimation-&gt;SetInterpolationMethod(IM_NONE);
    rotationAnimation-&gt;SetKeyFrame(0.0f, Quaternion(0.f));
    rotationAnimation-&gt;SetKeyFrame(1.0f, Quaternion(90));
    rotationAnimation-&gt;SetKeyFrame(2.0f, Quaternion(180));
    rotationAnimation-&gt;SetKeyFrame(3.0f, Quaternion(270));
    rotationAnimation-&gt;SetKeyFrame(4.0f, Quaternion(360));

    // Set triangle rotation animation
    triangleAnimation-&gt;AddAttributeAnimation("Rotation", rotationAnimation);

    // Apply light animation to light node
    triangleNode-&gt;SetObjectAnimation(triangleAnimation);

};
</code></pre>
<p>you can animate not only by skeletons, but also using attribute animation. The concept is that you simply turn a train wheel around its axis by code…</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/750_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">crisx</div>
          <div class="post_content">
<p>Thanks, I will check that.<br/>
It doesn’t seems to apply to StaticModel or AnimatedModel classes, no?<br/>
So far, I’ve only been able to run model animations with a skeleton, and I’m still struggling to animate just parts of the model directly with the engine code.<br/>
I’ll check this anyway <img alt=":sunglasses:" class="emoji" src="../../../images2/b11e15d62f952a3da9d0ff6e5174f0bc.png" title=":sunglasses:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/788_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">johnnycable</div>
          <div class="post_content">
<p>Yes, this is <a href="https://urho3d.github.io/documentation/1.6/_attribute_animation.html" rel="nofollow noopener">attribute animation</a>, used to animate everything not-skeleton…</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>