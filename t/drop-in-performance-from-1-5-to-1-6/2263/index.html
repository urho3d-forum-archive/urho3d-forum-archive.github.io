<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Drop in performance from 1.5 to 1.6</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Drop in performance from 1.5 to 1.6</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Noticed performance drop from 1.5 to 1.6.</p>
<p>I was merging some projects that I’ve written in 1.4 and 1.5 to 1.6 and noticed that it wasn’t performing like what I remembered.</p>
<p>Just to be sure it wasn’t anything that I was doing, I rebuilt the 1.5 tag and 1.6 tag and did some comparison on the char demo.</p>
<p>Below are the pics.</p>
<p>I’ve also rebuilt 1.4 and that performed slightly better than 1.5 (maybe due to SSE being enabled by default back then).</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/SNenrC3.png" title=""><img alt="" height="500" src="../../../images2/52da235716062280691b2947523c49cd.png" width="666"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">800×600</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/2AR3bYn.png" title=""><img alt="" height="500" src="../../../images2/a51584c028946e2d55d8b3a7a288759e.png" width="666"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">800×600</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Are the additional queries made on Texture2D, Technique, etc. on the bottom of 1.6 screen using additional time?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">yushli</div>
          <div class="post_content">
<p>That looks like a real performace drop ( from 192 to 145). Don’t think those queries can cause that much performance hit. May need the Urho3D masters to look into this.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I hope not.  I’m sure the additional queries are not that significant, just haven’t measure them.</p>
<p>It just seems like my PC overall just runs slower than it did two weeks ago.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Ran the demo on my dual boot Linux that I installed recently, shown below.  This might confuse the issue, but I wanted to see the performance.</p>
<p>The issue is why is there a difference from 1.5 to 1.6 on Windows.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/NbTL4IM.png" title=""><img alt="" height="500" src="../../../images2/f4f9fcb8abf09c50eec95008ecb6e4b3.png" width="666"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1024×768</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Just to be fair, captured an image running on OpenGL on Windows.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/Y77WnQU.png" title=""><img alt="" height="500" src="../../../images2/8040e837f15c287da496a1997059ff2f.png" width="666"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1024×768</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">yushli</div>
          <div class="post_content">
<p>I am a little confused. Are the first two images (fps 192 and fps 146) running on the same machine?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>All screen captures are on the same PC. The first two images are using DX9.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Performed more testing.  Used naked Jack in all my tests to even the playing field, and that changed the GL test.</p>
<p>Results:<br/>
1.5 DX9 ~183 - 192 FPS<br/>
1.5 GL  ~ 192 - 195 FPS<br/>
1.6 DX9 ~ 132 - 151 FPS<br/>
1.6 GL  ~ 122 - 148 FPS</p>
<p>Conclusion: 1.6 runs slower than 1.5.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>This looks like overall CPU slowdown, as almost every part of the frame takes longer. Which would point to compiler settings. Which compiler are you using?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I use cmake_vs2013.bat file to build sln/proj files.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>Looking in more detail, GetUIBatches() execution time has grown in your screenshots quite substantially, and it’s at least partially explained by the added text in the memory profiler. Getting a lot of text on screen is indeed slow, especially because the debug hud is using a shadow effect, and the batches are constructed each frame which is somewhat suboptimal.</p>
<p>Things to try:</p>
<ul>
<li>Are you building debug or release?</li>
<li>Measure your frame performance without Urho’s debug hud on, e.g. by using Fraps. Is there still a substantial difference?</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I’m using debug build, and here is the result from Fraps benchmark.</p>
<hr/>
<p>1.5 - DX9<br/>
2016-09-23 07:38:00 - 18_CharacterDemo_d<br/>
Frames: 2013 - Time: 11016ms - Avg: 182.734 - Min: 133 - Max: 197</p>
<hr/>
<p>1.5 - GL<br/>
2016-09-23 07:59:30 - 18_CharacterDemo_d<br/>
Frames: 2671 - Time: 14156ms - Avg: 188.683 - Min: 178 - Max: 194</p>
<hr/>
<p>1.6 -DX9<br/>
2016-09-23 07:57:57 - 18_CharacterDemo_d<br/>
Frames: 1828 - Time: 9985ms - Avg: 183.075 - Min: 163 - Max: 195</p>
<hr/>
<p>1.6 - GL<br/>
2016-09-23 08:00:35 - 18_CharacterDemo_d<br/>
Frames: 2681 - Time: 14687ms - Avg: 182.542 - Min: 166 - Max: 193</p>
<p>Looks like the extra info added to 1.6 makes a huge difference on my machine.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>Yes, I’d never recommend debug build for any kinds of performance comparisons. Making the profiler display less taxing on the frame would be good though.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Something still seems off with the performance on my PC.  I don’t remember my frame rate being this bad.  It used to be capped at 200 some time ago, and now it’s crap.  Only significant installs I’ve done recently were to upgrade my virus software to version 2016 and Windows 10 Anniversary Update.</p>
<p>My PC is pretty old and probably need upgrade soon but I think it can hold off for another 2-3 yrs, ha.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>I found performance regressions with HugeObjectCount example. Instances of Node had grown in memory size due to addition of tags, causing worse cache performance, and PODVector Push() was slower due to new self-insertion safe behavior. I moved less critical Node variables into an implementation struct, and restored the old unsafe PODVector behavior with a note explaining it.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Your changes made definite improvement.  New benchmark:</p>
<p>1.6 GL<br/>
2016-09-27 15:50:36 - 18_CharacterDemo_d<br/>
Frames: 2961 - Time: 15375ms - Avg: 192.585 - Min: 190 - Max: 196</p>
<p>1.6 DX9<br/>
2016-09-27 15:52:09 - 18_CharacterDemo_d<br/>
Frames: 3016 - Time: 15578ms - Avg: 193.606 - Min: 191 - Max: 196</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3200_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rku</div>
          <div class="post_content">
<p>Not sure if this is related but i noticed that performance is significantly worse on galaxy s5 android device as well. This is strange because galaxy s2 runs exact same (release) build just fine and that is older device with weaker hardware. FrameLimiter=false helps only a bit. Could this be related?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>Androids are kind of a mystery black box and we don’t have the resources to investigate properly on multiple devices. So it has to rely on users contributing fixes, if there’s something device-specific to be done. It could be related to threads if the S5 has more cores, in which case you could try disabling the task threading (-nothreads option)</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3200_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rku</div>
          <div class="post_content">
<p>I was thinking maybe to begin tackling performance problems it would be good idea to work on better performance logging. To the file for example. Currently tracking performance with what is displayed on screen is really troublesome, especially if it is some lag spikes that show up in stats on screen for split second.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>