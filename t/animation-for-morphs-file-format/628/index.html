<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Animation for morphs file format</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Animation for morphs file format</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">amit</div>
          <div class="post_content">
<p>What is the custom “Binary animation format” for Animation for morphs, any tuts on it?<br/>
saw <a href="https://urho3d.github.io/documentation/HEAD/_file_formats.html" rel="nofollow noopener">https://urho3d.github.io/documentation/HEAD/_file_formats.html</a><br/>
any sample file to work?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<blockquote>
<p>any tuts on it?</p>
</blockquote>
<p>I took my old crafts (head model) with some shape keys and tried this feature engine.<br/>
Video of what happened.</p>
<div class="lazyYT" data-height="270" data-parameters="feature=oembed&amp;wmode=opaque" data-width="480" data-youtube-id="QBnMz90g78Q" data-youtube-title="Urho3d Shape Keys test"></div>
<p>below zipfile with example exe + source code in C ++<br/>
<a href="http://rghost.ru/59428400">rghost.ru/59428400</a></p>
<p>key_1 &amp; key_2 to change shapes<br/>
key_R - reset all shapes by default<br/>
mouse wheel - value control</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Thanks for sharing it. The real download button in the above link is the one on the top left. <img alt=":wink:" class="emoji" src="../../../images2/95940790c23d98635b2a6d3f22657158.png" title=":wink:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<p>no problem, this can used for a new example if required.<br/>
I hope that the head is not too heavy for this (golova.mdl ~ 1mb)</p>
<blockquote>
<p>The real download button in the above link is the one on the top left<br/>
yes there is a lot of add’s buttons download )<br/>
If in Russia we have not blocked <a href="http://Github.com">Github.com</a> (with Tor i may only see &amp; dowloand from guthub) i would have placed himself an example and posted a link to the repository.<br/>
But had to do so ) Sorry if that.</p>
</blockquote>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>Assimp defines the concept of morph animations, but it’s unused so far (even in latest master). However, the OgreImporter supports saving the morphes from Ogre meshes.</p>
<p>From a testing standpoint as well there certainly should be an example morph-enabled model in Urho repo <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/> One simple possibility is to take a version of the Jack model (from realXtend) that has morphs, the file will just be huge.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<blockquote>
<p>Assimp defines the concept of morph animations, but it’s unused so far (even in latest master). However, the OgreImporter supports saving the morphes from Ogre meshes.<br/>
i’m use this blender add-on, is very useful.<br/>
<a href="https://github.com/reattiva/Urho3D-Blender">github.com/reattiva/Urho3D-Blender</a><br/>
*but before you start exporting shapes you must adjust all shapes values to 0. otherwise is exported not correctly.</p>
</blockquote>
<p>and i’m forgot about one thing to tell. may be it’s issue and need to resolved.<br/>
in 3d editor shapes also used negative values to counter shapes poses, it’s very important thing to do some shape variants with face mimic.<br/>
but i’m now try to use nagative values with my example and it’s no affect to conter shape pose. it’s need to resolve.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">amit</div>
          <div class="post_content">
<p>I understand the morph data store, what i want is <span class="bbcode-b">animation time line for morphs</span>.</p>
<p><span class="mention">@codingmonkey</span> thanks for code and blender export, I use blender so it help a lot</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">cadaver</div>
          <div class="post_content">
<p>In Urho, applying morphs is an ugly and CPU-expensive operation, so it’s really intended for something like character customization, where you don’t need constant animation or an actual timeline.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<p>@<span class="bbcode-b">amit</span></p>
<blockquote>
<p>animation time line for morphs.<br/>
I guess what morfs use only two max/min delta vertexes buffers(or only max, min - it’s base mesh) and affect factor value to determine which buffer has more weight in to base mesh.</p>
</blockquote>
<p>and for timeline you need more then 2 state of mesh, and i guess what name of this “vertex animation” and it’s very huge in mem.</p>
<p>if you need to play morf at a certain time, write code like this:</p>
<p><code>static float accuTime = 0.0f;
float lenInSec = 5.0f;
float curValue = accuTime / LenInSec ; 
accuTime += timeStep
Model_-&gt;SetMorphWeight(StringHash("SomeShapeAnimWith5SecLen"), curValue);</code></p>
<p><span class="bbcode-b">cadaver</span><br/>
i think better to use a lot of bones in a special rig for the face )<br/>
or just use shape keys with values</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">amit</div>
          <div class="post_content">
<p>What i was tryin was to export morph animation timeline from blender and directly use it with out settin morph weith manually.<br/>
“Binary animation format” has mask for bones only, maybe we can use attribute animation system with call back for more automation for animation of morphs.</p>
<p>Ill make my own system to do the same now <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/></p>
<p><span class="mention">@cadaver</span>, yeah but some time we need it, as i req it now, hope the cpu calculation is optimised. hardware would limit it to certain no. of morphs … a limit i do not want (12 morph req).<br/>
All this on ios/android platform.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">boberfly</div>
          <div class="post_content">
<p>If the morphs are just done on one mesh and it isn’t too heavy, iOS/Android should handle it fine using the CPU and glBufferSubData (what Urho3D currently does). But yeah it invokes a large sync point so your GPU will stall. <img alt=":frowning:" class="emoji" src="../../../images2/2506cac83464f3f86e257fa414340d4c.png" title=":frowning:"/></p>
<p>There’s a GPU-friendly way of doing morphs for DX9/GL2.x, but it involves vertex texture fetch support (ie. accessing a sampler2D from a vertex shader) and many mobile GPUs I don’t think support it, although I think a few old iOS devices did support it but it was undocumented <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/>. The idea is that you index into a texture and bring in new vertex positions from it, and you can atlas a bunch of morphs into your texture, provided it is big enough to store every vertex as an RGB pixel (and it is probably best to use something bigger than RGB8 otherwise there’s precision loss). Using Urho3D’s current format you’d just grab the morph data and procedurally build a texture atlas from it and then bind it to some texture unit and in the vertex shader do some GLSL index and lerp magic off the base position of the verts.</p>
<p>Another way is to embed the different morphs into empty attribute data elements in your vertex buffer and just lerp them from your base position element in the shader. You’ll just be limited to a very tiny amount of them (typical mobile GPUs can store up to 8-16, and typically you’d use a few of them for the normals/tangents/pos/texcoords/skinbinds/etc.)</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/119_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">codingmonkey</div>
          <div class="post_content">
<blockquote>
<p>GPU-friendly way of doing morphs for DX9/GL2.x, but it involves vertex texture fetch support<br/>
it’s good idea in this case engine must setup or choice render strategy on fly or in start time.<br/>
if device support texture fech it use them, if this feature is not supported it use cpu-based morfs. i think this is right way, because it support old and modern devices.<br/>
at last may be the right way will be lie in the fact that refuse to support very old hardware.</p>
</blockquote>
<p>and finally, I think that the shape keys and vertex animation even tighter and use one technology, but in fact two different things.<br/>
if you want long animation of vertex then it is the task of the new component VertexAnimation, i guess.</p>
<p>ps. and in addition I want to note that the shapekeys need support negative values. If it does not have, you must to do some facial shapekeys twice.<br/>
For example: a smile with negative values can turn into sadness, without the negative values have to do a “smile” and “sadness” as individual shapekeys.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">amit</div>
          <div class="post_content">
<p><span class="mention">@boberfly</span> thanks for info,   ill try cpu first, if it works with my model, its all ok else<br/>
i read some where, ios 7 has “vertex texture fetch support” , else back to pc.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">0x4D3342</div>
          <div class="post_content">
<p>hi,it seems your link is not working</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">CE184</div>
          <div class="post_content">
<p>Could you re-upload the link? Thanks!</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>