<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Emscripten build issue</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Emscripten build issue</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Hi, i am very new on Urho3d, i work for a company and i have to find and evaluate some 3d engine with a good support for mobile and html5 (trough emscripten).<br/>
We will have to create a title and possibly use it for our next future games. We already developed 12 games with cocos2dx and unity, but unfortunately this engine does not have a very good support on html5.</p>
<p>I am trying to compile but i am not sure i did everythings correctly…</p>
<p>First of all i build the engine with codeblocks and everythings seems went fine.<br/>
So from here i was a little lost… I will explain what i did:<br/>
My root is this<br/>
d:\Urho3d<br/>
d:\Urho3d\Build (compiled engine)<br/>
d:\Test (Hello word copied from d:\Urho3d\Build\Source\Sample\01_HelloWorld)</p>
<p>So i enter in d:\Urho3d and launched:<br/>
cmake_emscripten.bat d:\Test3 -DURHO3D_SAMPLES=0</p>
<p>And it does create the base project for emscripten there.<br/>
So i enter in d:\Test and launch:<br/>
emake make</p>
<p>What i got are:<br/>
CoreData.pak<br/>
Data.pak<br/>
Urho3DPlayer.data<br/>
Urho3DPlayer.js<br/>
Urho3DPlayer.wasm</p>
<p>Where is my error? Can someone help me?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>In short, nothing. If you are able to get this far then all is good. Double confirm by listing to see you got the libUrho3D.a (.bc) in the lib folder under build tree. The make command will also return 0 as exit code when it builds cleanly.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Yeah the file is there…<br/>
So what’s next?<br/>
I checked your web sample and those are a lot different from mine.</p>
<p>I also try to load this Urho3DPlayer.js on html but i got some javascript exception</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>The sample you have on you server seems to search for Urho3d.js (which i don’t have) also they look for 2 files in Urho3D Sample_files (which i created in one of my tests, but not in the one i wrote here).</p>
<p>I don’t get how complete the task and test it on crhome.<br/>
As i told you i try to use Urho3dPlayer.js but i got this error:<br/>
Uncaught TypeError: Cannot read property ‘length’ of undefined<br/>
at _emscripten_get_num_gamepads (Urho3DPlayer.js:1)<br/>
at wasm-function[28379]:48<br/>
at wasm-function[5579]:266<br/>
at wasm-function[6941]:135<br/>
at wasm-function[17019]:304<br/>
at wasm-function[17955]:323<br/>
at wasm-function[17965]:105<br/>
at wasm-function[16623]:5<br/>
at wasm-function[17365]:68<br/>
at wasm-function[16970]:9</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>There is no canonical way to build Urho3D library (and its samples). Read the online doc for the available build options or check the CI build script to see what build options that it uses (if you want to get started with the same option).</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Can you just say me which files i should get on the end?<br/>
I read the online docs and but still i don’t understand if i am in right direction or if i miss/mess something.</p>
<p>What are the .download files i got in some test?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>The web samples that we generated during our CI build is using the “URHO3D_TESTING=1” build option. This option will provide a basic “html shell”. It is also using “EMSCRIPTEN_SHARE_DATA=1”. This gives the output as you have just observed.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Ok thank you so much.<br/>
Will try to figure it out.</p>
<p>I saw 3 other engines and if i let this work i will probably choose this one.<br/>
We have to create a new serie of games and (most probably) port some of our Cartoon Network title on this engine.</p>
<p>Thank you for your help, will let you know if i get it work.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/788_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">johnnycable</div>
          <div class="post_content">
<p>Just tried and it works. I’m on 1.7+. My tree:</p>
<blockquote>
<p>├── CoreData.pak</p>
<p>├── Data.pak</p>
<p>├── GameData.pak</p>
<p>├── myApp.data</p>
<p>├── myApp.html</p>
<p>├── myApp.html.map</p>
<p>└── myApp.js</p>
</blockquote>
<p>run command:</p>
<p>emrun --browser chrome myApp.html</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>I don’t have any idea how you get that html out…<br/>
I did what weitjong said and it created those files:</p>
<p>CoreData.pak<br/>
Data.pak<br/>
Urho3D.js<br/>
Urho3D.js.data<br/>
Urho3DPlayer.html<br/>
Urho3DPlayer.js<br/>
Urho3DPlayer.wasm</p>
<p>As i said i was trying to compile HelloWorld Sample.</p>
<p>I try to launch Urho3DPlayer.html and i got:<br/>
Urho3D.js:100 Uncaught (in promise) TypeError: Module.addRunDependency is not a function</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Will study a little bit on it, most probably i am doing something wrong but i don’t understand what and where.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>If you use “URHO3D_SAMPLES=0” then all the Urho3D provided samples are not included in the build tree. If you want HelloWorld sample then reenable this build option. Also, you can also tell <code>make</code> command to just to build a single sample target rather than all of them, which for Emscripten/Web build will take a lot of time. For example <code>make 01_HelloWorld</code>. This will also build all the deps required by the 01_HelloWorld target but perhaps you already know that. BTW, the “EMSCRIPTEN_SHARE_DATA=1” build option only makes sense when you eventually build all the sample targets and don’t want each of the sample target has its own set of resource paks (got individual file but otherwise contains identical data).</p>
<p>We have changed the Web build system from 1.6 to 1.7 and from 1.7 to current master. You may want to read the porting notes in this page: <a href="https://urho3d.github.io/documentation/HEAD/_porting_notes.html" rel="nofollow noopener">https://urho3d.github.io/documentation/HEAD/_porting_notes.html</a></p>
<p>What I told you earlier assume you are using 1.7. I know the documentation is quite sparse, but I hope you get it working. BTW, personally I believe the build system in the master branch is better.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Thank you for your support and sorry if i get a little lost…<br/>
Yes i am using the newer version.</p>
<p>What i don’t understand now is how use the cmake_emscripten command… I’ll try to explain as better as i can.<br/>
I start from beginning so after dl the engine i did make a version for vs2015 by make command to a subdir of Urho unzipped folder.<br/>
I compiled all with vs2015 and set the Urho home.</p>
<p>Now as far as i understood i should use cmake_emscripten from the unzipped folder and target the project i would like to build, so i targetted the compiled hello world Urho3d\BUILD\source\etc…<br/>
After that i did emmake make but as far as i see i don’t have a Helloworld.js but instead a Urho3DPlayer.js so i am a little confused in how it should work.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>Today i’ll retry from the beginning, but i still get this error on my Urho3DPlayer</p>
<p>Urho3DPlayer.js:1 Uncaught TypeError: Module.removeRunDependency is not a function<br/>
at HTMLScriptElement.s.onload (Urho3DPlayer.js:1)</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>I finnaly find the way to create hellowrold.js… But i still got the same bug <img alt=":frowning:" class="emoji" src="../../../images2/c383444e3b50f1554d2f21c7c206ca52.png" title=":frowning:"/></p>
<p>And when it create the html i got another issue:</p>
<blockquote>
<p>parseTools.js preprocessor error in shell.html:1: “#!/usr/bin/env firefox”!</p>
<p>undefined:81<br/>
throw e;<br/>
^<br/>
Unclear preprocessor command on line 0: #!/usr/bin/env firefox<br/>
Traceback (most recent call last):<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\emcc.py”, line 3276, in <br/>
sys.exit(run(sys.argv))<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\emcc.py”, line 2228, in run<br/>
memfile, optimizer)<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\emcc.py”, line 3091, in generate_html<br/>
wasm_binary_target, memfile, optimizer)<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\emcc.py”, line 2864, in generate_traditional_runtime_html<br/>
shell = read_and_preprocess(options.shell_path)<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\tools\shared.py”, line 3250, in read_and_preprocess<br/>
run_js(path_from_root(‘tools/preprocessor.js’), NODE_JS, args, True, stdout=open(stdout, ‘w’), cwd=path)<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\tools\shared.py”, line 1091, in run_js<br/>
return jsrun.run_js(filename, engine, *args, **kw)<br/>
File “C:\HTML5Games\tools\emsdk\emscripten\1.38.30\tools\jsrun.py”, line 155, in run_js<br/>
raise Exception('Expected the command ’ + str(command) + ’ to finish with return code ’ + str(assert_returncode) + ', but it returned with code ’ + str(proc.returncode) + ’ instead! Output: ’ + str(ret)[:error_limit])<br/>
Exception: Expected the command [‘C:/HTML5Games/tools/emsdk/node/8.9.1_64bit/bin/node.exe’, ‘C:\HTML5Games\tools\emsdk\emscripten\1.38.30\tools/preprocessor.js’, ‘C:\Users\Johnny\AppData\Local\Temp\emscripten_temp_qssv0c\settings.js’, ‘shell.html’] to finish with return code 0, but it returned with code 1 instead! Output:<br/>
Source\Samples\01_HelloWorld\CMakeFiles\01_HelloWorld.dir\build.make:94: recipe for target ‘bin/01_HelloWorld.html’ failed<br/>
mingw32-make[3]: *** [bin/01_HelloWorld.html] Error 1<br/>
CMakeFiles\Makefile2:1696: recipe for target ‘Source/Samples/01_HelloWorld/CMakeFiles/01_HelloWorld.dir/all’ failed<br/>
mingw32-make[2]: *** [Source/Samples/01_HelloWorld/CMakeFiles/01_HelloWorld.dir/all] Error 2<br/>
CMakeFiles\Makefile2:1708: recipe for target ‘Source/Samples/01_HelloWorld/CMakeFiles/01_HelloWorld.dir/rule’ failed<br/>
mingw32-make[1]: *** [Source/Samples/01_HelloWorld/CMakeFiles/01_HelloWorld.dir/rule] Error 2<br/>
Makefile:521: recipe for target ‘01_HelloWorld’ failed<br/>
mingw32-make: *** [01_HelloWorld] Error 2</p>
</blockquote>
<p>I am using latest emscripten should i use this one?<br/>
<aside class="onebox whitelistedgeneric">
<header class="source">
<img class="site-icon" height="32" src="../../../images2/298b47bcb25b5f93b2f65fdd18e4cc1a.ico" width="32"/>
<a  rel="nofollow noopener" target="_blank">GitHub</a>
</header>
<article class="onebox-body">
<img class="thumbnail onebox-avatar" height="400" src="../../../images2/d419f48bef588e4f5dc7ecc03797ad51.png" width="400"/>
<h3><a  rel="nofollow noopener" target="_blank">urho3d/emscripten-sdk</a></h3>
<p>Installed Emscripten SDK for speedy cloning into Travis CI worker VM. - urho3d/emscripten-sdk</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>No way… Same issue again even using the emscripten sdk in urho3d git.</p>
<p>Cannot create the html file (se above) and if i create a simple hmtl file and load it i get:<br/>
Uncaught TypeError: Module.removeRunDependency is not a function<br/>
at HTMLScriptElement.s.onload (02_HelloGUI.js:1)</p>
<p>Uncaught (in promise) TypeError: Module.addRunDependency is not a function<br/>
at DataRequest.open (Urho3D.js:100)<br/>
at runWithFS (Urho3D.js:119)<br/>
at callRuntimeCallbacks (02_HelloGUI.js:1)<br/>
at preRun (02_HelloGUI.js:1)<br/>
at run (02_HelloGUI.js:1)<br/>
at runCaller (02_HelloGUI.js:1)<br/>
at removeRunDependency (02_HelloGUI.js:1)<br/>
at receiveInstance (02_HelloGUI.js:1)<br/>
at receiveInstantiatedSource (02_HelloGUI.js:1)</p>
<p>I don’t know what else try, i did every kind of attempt even the silly one.<br/>
We managed to port few java games on emscripten but i don’t find a way to build the sample of Urho, i am losing hope.</p>
<p>Strangely searching for that error i found it in another engine <img alt=":slight_smile:" class="emoji" src="../../../images2/7bdd5ab4d67675d002d99e4b948c8cdb.png" title=":slight_smile:"/><br/>
<aside class="onebox githubissue">
<header class="source">
<a href="https://github.com/godotengine/godot/issues/17538" rel="nofollow noopener" target="_blank">github.com/godotengine/godot</a>
</header>
<article class="onebox-body">
<a href="https://github.com/psiker" rel="nofollow noopener">
<img class="thumbnail onebox-avatar" height="96" src="../../../images2/28a71561898b73c6d360c0f231cd363b.jpeg" width="96"/>
</a>
<h4><a href="https://github.com/godotengine/godot/issues/17538" rel="nofollow noopener" target="_blank">Issue: html5 export does not work anymore</a></h4>
<div class="date" style="margin-top:10px;">
<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/psiker" rel="nofollow noopener" target="_blank">psiker</a>
	on <a href="https://github.com/godotengine/godot/issues/17538" rel="nofollow noopener" target="_blank">2018-03-15</a>
</div>
<div class="user">
	closed by <a href="https://github.com/eska014" rel="nofollow noopener" target="_blank">eska014</a>
	on <a href="https://github.com/godotengine/godot/issues/17538" rel="nofollow noopener" target="_blank">2018-03-19</a>
</div>
</div>
<pre class="content" style="white-space: pre-wrap;">Godot version:
Godot 2.1.5 beta 2
OS/device including version:
Windows 10 64bit, 8GB, Intel HD Graphics 630, on chrome and firefox
Issue description:
Just did an...</pre>
<div class="labels">
<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">bug</span>
<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">platform:html5</span>
<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">topic:porting</span>
</div>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>OHHHH YESSSS…<br/>
I did it…<br/>
Strangely enought i had to use an old emscripten to let it work.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Congrats! About the EMSDK version, you are right, and that has been discussed before here in the forum a few months ago. For the best result you may want to use the same exact version that our web CI build job uses.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Azaratur</div>
          <div class="post_content">
<p>I try to dl this one:<br/>
<aside class="onebox whitelistedgeneric">
<header class="source">
<img class="site-icon" height="32" src="../../../images2/298b47bcb25b5f93b2f65fdd18e4cc1a.ico" width="32"/>
<a  rel="nofollow noopener" target="_blank">GitHub</a>
</header>
<article class="onebox-body">
<img class="thumbnail onebox-avatar" height="400" src="../../../images2/d419f48bef588e4f5dc7ecc03797ad51.png" width="400"/>
<h3><a  rel="nofollow noopener" target="_blank">urho3d/emscripten-sdk</a></h3>
<p>Installed Emscripten SDK for speedy cloning into Travis CI worker VM. - urho3d/emscripten-sdk</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
<p>But i had issue even with that.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>I meant to use the same version number as the CI. The repo that you link is not necessarily compatible with your system because you are not using Linux.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/788_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">johnnycable</div>
          <div class="post_content">
<p>mine is: /usr/local/emsdk_portable/emscripten/1.35.0</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>