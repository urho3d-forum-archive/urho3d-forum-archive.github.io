<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Graphical artifacts help</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Graphical artifacts help</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Integrating TurboBadger to Urho3D-master shows some weird graphical artifacts, e.g. lines above fonts, lines inside boxes and radial buttons, shown below.<br/>
Same code and data in 1.4 didn’t show any of this.</p>
<p>Where should I look to debug this problem? I’m thinking batch process or shader routine.</p>
<p>Both code base can be found here:<br/>
<a data-bbcode="true" href="https://github.com/Lumak/Urho3D-1.4-TurboBadger">https://github.com/Lumak/Urho3D-1.4-TurboBadger</a><br/>
<a data-bbcode="true" href="https://github.com/Lumak/Urho3D">https://github.com/Lumak/Urho3D</a></p>
<p><img alt="" height="354" src="../../../images2/aeeb7139e0d407475c285fa14e17b3ec.jpg" width="527"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Using the same code and data in 1.4 didn’t show this, a pic from 1.4 below.  It’s a screenshot that I took of my implementation and not a pic from Turbo Badger’s github.</p>
<p>I haven’t started digging into this yet, as I have no idea where to look, but I can start with diff’ing the UIBatch render process.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/gA2z5qi.jpg?1" title=""><img alt="" height="383" src="../../../images2/62a92e88cdcfe5df034be286a93bc539.jpg" width="690"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">900×500</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>Looks like texture bleeding to me too.<br/>
Notice how it mostly happen above upper case letters and special characters.<br/>
Maybe texture filtering changed somewhere? I’d try to test with no filtering.<br/>
Maybe adding 1 pixel padding around glyphs if nothing else works.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/827_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">friesencr</div>
          <div class="post_content">
<p>I got those kinds of artifacts from enabling multisampling a while ago.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Thanks for your input.</p>
<p>I looked at the graphics settings for 1.4 and 1.5 and they both have multisample set to 1.  I diff’d the UI code and didn’t see anything different that would caused this problem. Still no resolution.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>[quote=“Lumak”]Thanks for your input.</p>
<p>I looked at the graphics settings for 1.4 and 1.5 and they both have multisample set to 1.  I diff’d the UI code and didn’t see anything different that would caused this problem. Still no resolution.[/quote]<br/>
Try to disable filtering (completely) regardless of changes.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Setting multisample = 0 had no effect - still see the same artifacts.</p>
<p>I built OpenGL version of 1.5 and there is no graphical artifacts.  It’s clean as what’s seen in 1.4.</p>
<p>Just don’t use DirectX, ha.</p>
<p>But seriously, I diff’d DirectX9Texture and Graphics files and didn’t see changes that would cause this.  There’s something else I’m not seeing.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Ok, I’ll look into that next.</p>
<p>Here’s the recap:<br/>
[ul]<br/>
[li] 1.4 OpenGL - no issue[/li]<br/>
[li] 1.4 DirectX9 - no issue[/li]<br/>
[li] 1.5 OpenGL - no issue[/li]<br/>
[li]<span class="bbcode-b">[color=#FF0000]1.5 DirectX9 - artifacts[/color][/li][/ul]</span></p>
<p>edit: DirectX9</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<aside class="quote no-group" data-username="Lumak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/b3b294bc4454bf21e07a40d7aa09761d.png" width="20"/> Lumak:</div>
<blockquote>
<p>Setting multisample = 0 had no effect - still see the same artifacts.</p>
</blockquote>
</aside>
<p>If you mean engine MSAA than that’s not what I meant.<br/>
I meant texture filtering, disabling it by using FILTER_NEAREST.</p>
<p>Though just sticking with OpenGL is a valid solution.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p><span class="mention">@Sinoid</span>,<br/>
In the RenderBatch() func, all incoming batch are padded to the end of the vertexbuffer:</p>
<pre><code class="lang-auto">        unsigned begin = batch.vertexData_-&gt;Size();
        batch.vertexData_-&gt;Resize(begin + _pb-&gt;vertex_count * UI_VERTEX_SIZE);
        float* dest = &amp;(batch.vertexData_-&gt;At(begin));</code></pre>
<p>It’s similar to how UIBatch class constructs the batch data.  Here is a sniplet from UIBatch::AddQuad() func:</p>
<pre><code class="lang-auto">    unsigned begin = vertexData_-&gt;Size();
    vertexData_-&gt;Resize(begin + 6 * UI_VERTEX_SIZE);
    float* dest = &amp;(vertexData_-&gt;At(begin));
    vertexEnd_ = vertexData_-&gt;Size();

    dest[0] = left;
    dest[1] = top;
    dest[2] = 0.0f;
    ((unsigned&amp;)dest[3]) = topLeftColor;
    dest[4] = leftUV;
    dest[5] = topUV;</code></pre>
<p>Except my code is in a for loop.  If I wasn’t accounting for offset then I imagine I would not get anything to render except for garbage.</p>
<p>edit: added uibatch::addquad() code sniplet.</p>
<p>again, below is a pic from 1.4 DX9</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/gA2z5qi.jpg?1" title=""><img alt="" height="383" src="../../../images2/62a92e88cdcfe5df034be286a93bc539.jpg" width="690"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">900×500</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p><span class="mention">@Enhex</span></p>
<p>I thought you could’ve meant that, so also did that test but forgot to mentioned it.  Using the FILTER_NEAREST filter initially showed like it would work.  The very 1st window in the TB demo looked like there were no artifacts but the remaining windows had it.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<aside class="quote no-group" data-username="Lumak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/b3b294bc4454bf21e07a40d7aa09761d.png" width="20"/> Lumak:</div>
<blockquote>
<p>I thought you could’ve meant that, so also did that test but forgot to mentioned it.  Using the FILTER_NEAREST filter initially showed like it would work.  The very 1st window in the TB demo looked like there were no artifacts but the remaining windows had it.</p>
</blockquote>
</aside>
<p>I don’t know the implementation details, but maybe each window uses it’s own texture and you only disabled filtering on a single window?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>All TBTextures are created by a overriden Texture ctor and where the filter was set.  So, every TB demo window and textures went through the same ctor.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<aside class="quote no-group" data-username="Lumak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/b3b294bc4454bf21e07a40d7aa09761d.png" width="20"/> Lumak:</div>
<blockquote>
<p>All TBTextures are created by a overriden Texture ctor and where the filter was set.  So, every TB demo window and textures went through the same ctor.</p>
</blockquote>
</aside>
<p>Sounds like a “should”. Did you confirm that the windows with the artifacts have unfiltered texture?<br/>
Maybe something changes it later?<br/>
Maybe only the first window uses that constructor?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Now I understand what you mean. And I stand corrected in regards to my claim that the pic was from DX9, I looked at my build again and it was OpenGL.</p>
<p>All fixed!  Thanks for your help!</p>
<p>[RESOLVED]</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>[quote]</p>
<p>Re: graphical artifacts help</p>
<p>PostPosted by Sinoid ? 08 Nov 2015, 21:09<br/>
I did your work for you.</p>
<hr/>
<p>I said this:</p>
<pre><code>I'd look at texture coordinates and check 'border' colors and texture border modes. Looking at the lines around the colored text portion it appears that the lines are areas of "off glyph" texture that's bleeding through.

If you can get a dump of the rasterized font I'd look at that and compare it to the offending characters to see if there's any stand out indicators (ie. maybe the font rasterize only writes alpha where it thinks it needs to instead of everywhere).

Then I'd look at whoever/where-ever the font is rendered into an image (as in turning a TTF into a bitmap).
</code></pre>
<p>And then you said this:</p>
<pre><code>I haven't started digging into this yet, as I have no idea where to look, but I can start with diff'ing the UIBatch render process.
</code></pre>
<p>What is that: “I have no idea where to look” … I gave you a detailed list of exactly where I’d look. You’re implementing a third party library but incapable of looking into that library? You’re implementing a third party library without even thoroughly reading the documentation available?</p>
<p>I can tell you exactly how to adjust Recast/Detour/DetourCrowd to account for multiple agent sizes in exchange for speed - because I implemented that stuff and understood the library I was working with before I picked up the work before me.</p>
<p>You’ve expressed nothing but “terror” at the thought of investigating TurboBadger.</p>
<p>The 0.5,0.5 offset IS IN THE DOCUMENTATION! RTFM! There is no good reason for anyone to believe that your implementation of TurboBadger is worth using. You’re clearly afraid of TurboBadger, and you very clearly are lacking in ability.</p>
<p>So tubobadger isn’t filling my view horizontally, what’s wrong?</p>
<p>Find an answer.[/quote]<br/>
LOL, I don’t know what to make of this, but AWESOME JOB in doing all the work! You are the best!</p>
<p>And maybe you should get back on your meds! LOL</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Since the OP issue is already resolved, I lock this thread for now so it does not go off topic.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>