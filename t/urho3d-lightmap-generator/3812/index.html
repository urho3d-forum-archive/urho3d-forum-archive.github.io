<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Urho3D Lightmap generator</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Urho3D Lightmap generator</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Early Merry Christmas, repo: <a href="https://github.com/Lumak/Urho3D-Lightmap">https://github.com/Lumak/Urho3D-Lightmap</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Update the roomScene.xml to make the baked texture seamless.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2369_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Dave82</div>
          <div class="post_content">
<p>Looks great ! is there a way to bake some indirect lighting too ? Like AO and GI ? If yes or there’s EVEN a plan to implement it i will switch to this right away !</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Direct lighting only:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/4/4c5f489dda92ddbe97a6cc7be26f5b589e16cb24.png"/><br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/d/d31b4cb94eccf721d37e4a990b29f20eb3db3608.png"/></p>
<p>press <strong>F5</strong> to start the light process and once complete, technique is changed to xxLightMap and the results should look like this with indirect lighting… unless I forgot to check something in.<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/4/4f0377a807b8d2c968ae765148b0e9002d049f98.png"/><br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/f/fea1dbea8cbcef81f0f9ded98efa72a726fb3e46.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">dakilla</div>
          <div class="post_content">
<p>Nice work, thanks for sharing <img alt=":wink:" class="emoji" src="../../../images2/95940790c23d98635b2a6d3f22657158.png" title=":wink:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I managed to write bake indirect lighting code and capture, but what’s captured is not what I expect. It looks like just a larger version of the lightmap instead of direct+indirect+shadows.  Is that what you expect?</p>
<p>It might help you understand if I posted some images.</p>
<p>edit: nvm, indirect baked texture = diffuse texture + indirect lighting.  The lightmap is just indirect lighting, no texture. Anyway, indirect process is in the repo.</p>
<p>direct bake<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/a/a6fd6181789aec7a734b5f14255b02fcfa3ffafc.png"/></p>
<p>lightmap<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/a/a95414bbb52ab0a5bb9ba008966227944f70a717.png"/></p>
<p>indirect bake<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/e/edaadf298ec7b7374cb5c52571b93f27eda8ac2a.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Updated repo w/ bake indirect and misc. cleanup.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I wrote some test code to process solidangle color averaging in the background thread to reduce the overall build time for larger indirect lighting textures sizes, 128x128 and 256x256, and these are the kind of numbers that I’m getting in the <strong>lightmap.log</strong> file.</p>
<pre><code class="lang-auto">-------------128x128---------
[Mon Dec  4 09:13:25 2017] INFO: node7: indirect completion = 20.78 sec.
[Mon Dec  4 09:13:25 2017] INFO: node9: indirect completion = 20.79 sec.
[Mon Dec  4 09:13:25 2017] INFO: node10: indirect completion = 20.81 sec.
[Mon Dec  4 09:13:37 2017] INFO: node5: indirect completion = 33.39 sec.
[Mon Dec  4 09:14:04 2017] INFO: node8: indirect completion = 60.55 sec.
[Mon Dec  4 09:14:24 2017] INFO: node6: indirect completion = 80.01 sec.

-------------256x256---------
[Mon Dec  4 09:17:26 2017] INFO: node7: indirect completion = 81.61 sec.
[Mon Dec  4 09:17:26 2017] INFO: node9: indirect completion = 81.65 sec.
[Mon Dec  4 09:17:26 2017] INFO: node10: indirect completion = 81.69 sec.
[Mon Dec  4 09:18:13 2017] INFO: node5: indirect completion = 128.24 sec.
[Mon Dec  4 09:20:08 2017] INFO: node8: indirect completion = 243.74 sec.
[Mon Dec  4 09:21:21 2017] INFO: node6: indirect completion = 316.35 sec.
</code></pre>
<p>You can specify the size at line 258 in LightmapCreator.cpp:</p>
<pre><code class="lang-auto">lightmap-&gt;BeginIndirectLighting(outputPath_, 256);</code></pre>
<p>Detail images:<br/>
lightmap<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/0/06ded3ad6bd1dff7f023a637e1b13e969e38aa55.png"/><br/>
baked indirect<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/8/8d6225f2bec8bd3e4c1c6854f239e51a0cf5d009.png"/></p>
<p>And you have to ask, is it worth creating a higher res image for indirect bake. And the answer is no.<br/>
There are obvious detail difference in the lightmap images from 64x64 to 256x256, but the diff of baked indirect images aren’t all that different.<br/>
diff image online w/ fuzz 1%<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/4/474a28078abe20476a178f9af7a26d3be63e93a2.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Really no difference when comparing the default size at 64x64.</p>
<pre><code class="lang-auto">-------------64x64---------
[Mon Dec  4 11:28:45 2017] INFO: node7: indirect completion = 5.37 sec.
[Mon Dec  4 11:28:45 2017] INFO: node9: indirect completion = 5.37 sec.
[Mon Dec  4 11:28:45 2017] INFO: node10: indirect completion = 5.38 sec.
[Mon Dec  4 11:28:49 2017] INFO: node5: indirect completion = 9.14 sec.
[Mon Dec  4 11:28:54 2017] INFO: node8: indirect completion = 14.90 sec.
[Mon Dec  4 11:29:00 2017] INFO: node6: indirect completion = 20.73 sec.
total time = 20.73 sec.
--- threaded
[Mon Dec  4 11:30:11 2017] INFO: node7: indirect completion = 5.38 sec.
[Mon Dec  4 11:30:11 2017] INFO: node9: indirect completion = 5.39 sec.
[Mon Dec  4 11:30:11 2017] INFO: node10: indirect completion = 5.40 sec.
[Mon Dec  4 11:30:14 2017] INFO: node5: indirect completion = 9.07 sec.
[Mon Dec  4 11:30:20 2017] INFO: node8: indirect completion = 14.76 sec.
[Mon Dec  4 11:30:26 2017] INFO: node6: indirect completion = 20.49 sec.
total time = 20.49 sec.
</code></pre>
<p>You can save about a minute when creating 256x256 image threaded, but as mentioned previously, it’s not worth it. And for this reason, I won’t be checking in my threaded test code to the repo.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I was very skeptical about the diff’d images, and looking through my code, I realized I was calling <strong>lightmap-&gt;SetSavefile(false);</strong> early on to skip updating my baked files.</p>
<p><strong>True diff images:</strong></p>
<p><strong>64v128</strong><br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/3/37a467d0bb6c3c0faef00492ebc5eca2195709b1.png"/></p>
<p><strong>128v256</strong><br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/2/2f38bb047266d804df613133861ff0a4364aad09.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Repo updated w/ solid angle color computation threaded option, and more importantly the indirect render texture is now fixed to 64x64.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Repo updated: runs 4x faster. The default scene setup now completes in <strong>~5 secs.</strong></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">coldev</div>
          <div class="post_content">
<p>Thanks 4 share… nice christmas gift   <img alt=":grinning:" class="emoji" src="../../../images2/993cdd6d5aba3f941b7389fd0b3a1ba1.png" title=":grinning:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>You’re welcome <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/></p>
<p>Repo updated: refactored lightmap.cpp and created texturebake.cpp. This is the last update I’ll make this year.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">smellymumbler</div>
          <div class="post_content">
<p>I’m curious: any chance this can be used with external tools such as Mitsuba or Eevee?</p>
<p>Doing lighting correctly is something extremely difficult and this project could benefit from being a modular way of integrating renderers, instead of trying to render things itself. That’s just my two cents, of course! Amazing effort. Learning a lot from your code, Lumak. You rock.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I’m not aware of Eevee but have studies Mitsuba about a couple of years ago.  Mitsuba does generate <strong>perfect</strong> lighting images but it does this by screen space raycasts, and there are variations of raycast options, does it on the CPU, and is really slow.</p>
<p>My implementation is based on <strong>Hugo Elias’s Radiosity.</strong> Except, I haven’t implemented the skipping of pixels, evaluate, and interpolate part, but brute force pixel processing. And I also use hemisphere instead of hemicube that everyone who’s ever implemented Hugo’s method that I’ve seen are so keen to believe that is the best option.</p>
<p>Using Urho3D’s tech., indirect light processing is <strong>blazing fast.</strong> And the accuracy only depends on the lightmap/indirect light resolution that you choose.</p>
<p>Here’s an example of the lightmap image created at 512x512 resolution:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/5/5eaac9abb78c443c687d455019e1269d77da3647.png"/></p>
<p>I never realized how accurate <strong>Hugo’s</strong> method was until I observed the cascading light and shadow at the top/left of the image and color bleeding.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>That description above, I will have to use it on my github repo page.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">smellymumbler</div>
          <div class="post_content">
<p>I see. But isn’t speed that much of a concern when you’re baking lights? Or are you planning of generating lightmaps in realtime, similar to what Sauerbraten does?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Generating lightmaps at runtime to achieve static GI is exactly what’s happening in my demo - just skip baking textures because you really don’t need them, unless you’re wanting to remove lights from the scene and render baked images as unlit.</p>
<p>Speed is a concern to me. I don’t know about you but, I can remember a number of times when I’ve tried generating lightmaps in other engine/program and having to wait 40 mins. to see resulting lightmap textures with undesirable blemishes even for scenes strictly with box only type geometries.</p>
<p>What makes Mitsuba not work in this case is, it only does screen space processing. If you’re wanting to only do screen space, there are plenty of shaders out there that can do SSGI, of course, w/o BRDF that Mitsuba applies in its process.</p>
<p>edit: had to rephrase.<br/>
edit2: sry, I don’t know what a Sauerbraten is.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Let me also mention that there is a baked scene sample in Lightmap/bakedScene.xml which demonstrates rendering bakedIndirect as Unlit w/o any lights in the scene.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">smellymumbler</div>
          <div class="post_content">
<p>Now i understand what your goal is! I thought this was intended to be a lightmap baking tool, such as the ones included in UE and Unity.</p>
<p>About embree: <a href="https://github.com/prideout/aobaker" rel="nofollow noopener">https://github.com/prideout/aobaker</a><br/>
About sauerbraten: <a href="http://sauerbraten.org/" rel="nofollow noopener">http://sauerbraten.org/</a><br/>
<a href="http://sauerbraten.org/docs/editref.html" rel="nofollow noopener">http://sauerbraten.org/docs/editref.html</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>My original title for this thread was named “baking” something, so yeah, I really didn’t describe what I’ve implemented exactly. And I’m not sure if “generator” describes it properly.</p>
<p>I’ve not seen nor tried UE and Unity lightmap baking tool to know if I generate something comparable. I wrote this and the lightprobe to replace a ton of lights that I had in a scene that I couldn’t have in real time for mobile device.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Testing second light bounce in the demo.<br/>
edit: i guess it’d help to have a reference of the 1st bounce</p>
<p>light bounce=1<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/f/f28b9e0dc6561193f02a3ffff2be372e9c947302.png"/><br/>
light bounce=2<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/9/994ed32ba18287dddb4a39c1b0618fdffd718932.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Looking at the bounced light results had me look over my solid angle calculation again, and I believe there was an error.</p>
<p>edit: nope, it’s mathematically correct.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2369_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Dave82</div>
          <div class="post_content">
<p>I don’t know why but the indirect light doesn’t feel and seem right.</p>
<p>The red circles show some random artifacts and the whole area between the red cube and the pillars are too bright.Also where the pillars touch the ground doens’t seem right either.There are some bright circle shaped artifacts around them.<br/>
<img alt="image" height="388" src="../../../images2/92321acfe0359fd1561d01dbda4bcfcf.jpg" width="690"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Yeah, I’ve noticed some strange artifacts.</p>
<p>One that really boggles my mind is this one:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/9/936ce021ffc029bb699b422426072eaddff4eee2.png"/></p>
<p>I’ve gone through the debug draw process of drawing every point and normal on every object in the scene and they’re correctly positioned and points outward from where they should be.  Yet, how does a star cluster form on a sphere when irradiance of close or next neighbors should be gradient if not the same.</p>
<p>Math wise, I don’t massage my irradiance value during computation. What you see is what’s been calculated from what’s returned from render texture.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2369_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Dave82</div>
          <div class="post_content">
<p>Is the same artifact happens if you increase the resolution ? It seems like an ultra low resolution lightmap issue</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<ul>
<li>fixed the problem with star cluster on the sphere. turns out the camera rotation need to be set using FromLookRotation() fn, otherwise, the rotation gets skewed</li>
<li>fixes the partial lighting on the back wall - uv mapping was too close, new model provided. also provided a new uv mapped box model</li>
<li>the light ring around the pillars fixed by setting mat cull and shadowcull to “none.”  you can’t set this for the room!</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2369_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Dave82</div>
          <div class="post_content">
<p>That’s good news.Any screen shots ?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>images of fixes<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/4/4d0e885c81a0f6e64de2a0cd8798e3b951106ac9.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/49_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">godan</div>
          <div class="post_content">
<p>Just playing around with this: where can I set the bounces? Or is that feature not in yet?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I’ve not put that in yet. Mathematically, the irradiance calculation is correct, but I it just looks too bright to me. I’ll need to verify it with a second source and compare the results before I can check that in.</p>
<p>It’s simple to implement.</p>
<ol>
<li>reinit state in lightmapCreator to <code>LightMap_IndirectLightBegin;</code>
</li>
<li>reinit state in <code>Lightmap::BeginIndirectLighting</code> to <code>State_IndirectLightBegin</code>
</li>
</ol>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Maya’s second light bounce room image. I tried to dummy down the GI bake settings in Maya to mimic Hugo’s radiosity: sampling at 4096 (base on 64x64 texture size), no bake shadow, etc., because Maya does have some pretty sophisticated settings you can setup.  And I probably don’t have the shaders set correctly because I’m losing color on no-texture objects.</p>
<p>Baked images on 64x64 texture size.</p>
<p>Hugo:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/5/590fc22409d3be4c4d97f4bb37032f0d7cba7bdd.png"/></p>
<p>Maya:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/1/126007411d357803fd55886e3b3cc329125b7619.jpg"/></p>
<p>Summing the luma of generated second bounce images, Hugo’s method accumulated ~19% more light than Maya.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>If I multiply irradiance by 50% Luma and summed with 20% of the original color, I get:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/d/d20671b499b0a38012dae03ecdff9ecaebe45934.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Testing alternate approach by turning off all the lights in the scene and sampling light emitted from the lightmap in the first indirect light pass, results in the 2nd pass image below.</p>
<p>Total luma captured in the scene is 5% more than Maya. First, sampling was 19% more.  Of course you can always tone down color by replacing the percentage of the color with luma.</p>
<p><img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/3/3b91955ecefa3eca47e0e9b9ad5d55c58bbdbe39.png"/></p>
<p>Posting Maya image again for easy comparison:<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/1/126007411d357803fd55886e3b3cc329125b7619.jpg"/></p>
<p>Luma, RGB remove.<br/>
<img alt="" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/5/59a1c93c891ca5aa5d03c8b85d66d069d30a8681.png"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/49_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">godan</div>
          <div class="post_content">
<p>This looks a lot better IMO. Nice one!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">smellymumbler</div>
          <div class="post_content">
<p>Quick question: does this auto-unwrap my scene? Or i have to do that myself? That scene is a single object?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>By</p>
<aside class="quote">
<blockquote>
<p>does this auto-unwrap my scene?</p>
</blockquote>
</aside>
<p>I think you mean, does it uv unwrap. No, it doesn’t do any uv unwrapping. Each model is expected to already have texCoord2.</p>
<p>The scene has 6 static models, each with its own texcoord2.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Repo updated: 2ndary light bounce and clean up.</p>
<p>Final comparison with Maya: Hugo’s method results in <strong>3.5% less light</strong>.  And the default output is luma, no RGB. Set <strong>lumaOutputColor_=false</strong> in Lightmap.cpp for color.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/902_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Eugene</div>
          <div class="post_content">
<p>What’s the reason of these gradients lines on the columns? Looks like an artifact.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Ya, the pillars look like shit. It’s the way it’s uv mapped. It’d probably come out a lot better if <strong>Thekla</strong> uv mapper is used, but that’s entirely a whole another project and I’m not touching that.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>I have one word , beautiful.<br/>
Would be useful for low end mobile devices.<br/>
Once I will have some spare time will try it on more complex scene’s</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I will have another repo update before Christmas.  Update will include baking direct and indirect to produce a combined Unlit texture, so you can have it in a static environment.</p>
<p>Final will include:</p>
<ul>
<li>for dynamic environment: lightmap.</li>
<li>for static environment: unlit.</li>
<li>removing direct baked images.</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/55_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rasteron</div>
          <div class="post_content">
<p>Looking great Lumak and awesome work <img alt=":+1:" class="emoji" src="../../../images2/839de69da74ad690eef135029e0320bc.png" title=":+1:"/> Yes, I’m sure this will be great for mobile.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Repo updated with direct and indirect texture bake.  Before you start any lightmap process, check out the resulting baked texture by openging the bakedScene.xml in the editor.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>The baked outcome looks great</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">smellymumbler</div>
          <div class="post_content">
<p>Would this work with terrains?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p><span class="mention">@smellymumbler</span>, no.</p>
<p>Repo updated with HLSL support.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Liichi</div>
          <div class="post_content">
<p>Is there any reason not to merge this?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/902_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Eugene</div>
          <div class="post_content">
<p>I think I can answer this, as a person who implemented lightmapper myself.</p>
<p>There’s a huge difference between lightmapping sample and baked lighting support in the engine.</p>
<p>It took me 2 weeks to implement lightmap <em>generation</em> from scratch (aka “sample”), and 2.5 <em>months</em> to integrate baked lighting into the engine and polish most notable rough corners, so I get actually usable tool suitable for real scenes.</p>
<p>This is the reason why most of the samples (and Urho has a lot of the 3rd-party samples) are not merged into master in any form.</p>
<p>It’s only 5-10% of work to implement sample. The rest 90-95% of work is to smoothly integrate sample functionality into the engine in actually re-usable and flexible form.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Liichi</div>
          <div class="post_content">
<p>Oh, I thought that implementing lightmap generation was the hard part <img alt=":frowning:" class="emoji" src="../../../images2/c383444e3b50f1554d2f21c7c206ca52.png" title=":frowning:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3290_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Modanung</div>
          <div class="post_content">
<p>It probably <em>is</em> the part that requires most close-to-the-metal technical knowledge, but not what requires most lines of code. I think what <span class="mention">@Eugene</span> is saying is that making something work, is not the same as making it widely applicable in a way that is relatively easy to understand for others.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/902_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Eugene</div>
          <div class="post_content">
<aside class="quote no-group" data-post="52" data-topic="3812" data-username="Modanung">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/aa09a6d66b3358288e24be68832c9d3c.png" width="20"/> Modanung:</div>
<blockquote>
<p>It probably <em>is</em> the part that requires most close-to-the-metal technical knowledge, but not what requires most lines of code</p>
</blockquote>
</aside>
<p>So true.</p>
<p>The raytracting kernel of lightmapper requires certain technical knowledge and algorithms, so it may be hard to implement if one is not familiar with the area (like me 5 months ago).</p>
<p>On the other hand, this part is relatively simple from architectural point of view. Actual intergarion raises a lot of new questions and issues.</p>
<p>How lightmapper shall handle materials and models of the engine? What components are supported and how? What’s performance on real scenes? Does lightmapper converge with increasing quality? How to run it in the background while scene is open in the Editor? How to handle dynamic objects? How to handle model LODs? How to integrate new changes into legacy shaders? How to make it as simple-to-use as possible? In perfect world, with one or two clicks in the Editor.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>