<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Android launcher APK</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Android launcher APK</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Hello,</p>
<p>I was trying out Urho3D on Android, and checking the forums, it seems that some people had success on running the Launcher app, however, I can’t get it to install. Is anyone having the same issue? I know the Android build had some changes recently, but it seems that people managed to get it working.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2547_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Miegamicis</div>
          <div class="post_content">
<p>In some cases the application fails to install on my phone when the Google Play app has access to the internet. It’s a random issue not just with the Urho3D app.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Yeah I saw something about the google app store scanner messing up with the installation, so I disabled it. I tried installing it without internet, but it’s still failing. It fails to install too on android emulator (tried Android 8 and 9).</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>I almost always use SHARED lib type during development of the build script and I have never encountered any installation error before, at least not the one you guys described above.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>I followed the tutorial on <a href="https://urho3d.github.io/documentation/HEAD/_building.html#Building_Android" rel="nofollow noopener">here</a>, so I’m assuming that’s the way you compiled it? I’m using Linux and Android Studio btw</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Yes. That is the right page. That section was rewritten by me, unless I have I forgotten anything then what’s described in there is how I do the Android build.</p>
<p>I am using Linux host and IntelliJ IDEA as my IDE. I also just invoke Grade wrapper via CLI. At the initial stage I used Android Studio too. After the Gradle version upgrade recently, I believe you need to use preview version of the Android Studio. I wonder that is the cause. Using IntelliJ IDEA allows me to explore the bleeding edge of the Gradle with no sweat.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Tried again but this time building with ./gradlew build, same thing. As for the version, I’m using the Canary build of Android Studio, since it’s the only one that uses Gradle 3.5.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>It’s not clear from your post what exactly is failing , any errors ?  .<br/>
I don’t have any issues with either compiling or installing on any android device with any version ( I have many of them <img alt=":slight_smile:" class="emoji" src="../../../images2/7bdd5ab4d67675d002d99e4b948c8cdb.png" title=":slight_smile:"/> ) , never tried it on an emulator .</p>
<p>The following works for me ( I am using Mac , but I guess it should work also on a Linux machine)</p>
<p>Make sure that your .bashrc is configured correctly specifically these environment variables should be set pointing to your SDK and NDK.<br/>
ANDROID_NDK_HOME<br/>
ANDROID_NDK<br/>
ANDROID_HOME<br/>
In addition your PATH (in .bashrc)  should also contain “Android/sdk/tools”</p>
<p>For development I am using<br/>
./gradlew assembleDebug -P URHO3D_LUA=0 -P ANDROID_ABI=armeabi-v7a -P URHO3D_ANGELSCRIPT=1</p>
<p>The generated APK can be found in<br/>
Urho3D/android/launcher-app/build/outputs/apk/debug/launcher-app-armeabi-v7a-debug.apk</p>
<p>installing using adb<br/>
adb install -r launcher-app-armeabi-v7a-debug.apk</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Ok gonna try to do it that way, will update shortly.</p>
<p>And about that error, that’s the thing, it just fails to install with no error whatsoever. <a href="https://i.imgur.com/NO0S4h4.png" rel="nofollow noopener">Here</a> is a print from the emulator, and there’s no log too. The .apk I trying to install is the one generated on the release build named “launcher-app-release-unsigned.apk”.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>Well the error is obvious , your apk is not signed .<br/>
launcher-app-release-unsigned.apk<br/>
You have to sign it with release keys.</p>
<p>using my way it will sign it with debug keys , will allow you to install it .<br/>
Once again I am not sure that using an emulator is the right way to go , you have to try it on a real device</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Well, that may be, however, I enabled the installation from unknown sources, so that shouldn’t be an issue. However who knows, I will try it later. I also tried on a real device, same thing.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Update: following your way it works just fine! Apparently even if you turn on accept unknown sources on the android settings, you still gotta sign it. After following the tutorial <a href="http://www.androiddevelopment.org/2009/01/19/signing-an-android-application-for-real-life-mobile-device-usage-installation/" rel="nofollow noopener">here</a> I self-signed the .apk and now it installs just fine.</p>
<p>Thanks everyone for your help.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Glad you figured it out already. Just want to add that using the IDE then one can install by a click of a button. <img alt=":smiley:" class="emoji" src="../../../images2/94dd27e9c6c243335d29229e02e34e9d.png" title=":smiley:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Dammit, now what’s happening is that when I build the release version of the launcher app, I can’t run any examples, they all crash. There’s no log output either.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>So there’s no way to get it running on release? You guys always use it on debug?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>Yes , it’s a known issues , there are some threads talking about it .<br/>
The fix is very simple<br/>
You have to modify 2 functions as shown below</p>
<pre><code class="lang-auto">unsigned VectorBuffer::Write(const void* data, unsigned size)
{
    if (!size)
        return 0;

    if (size + position_ &gt; size_)
    {
        size_ = size + position_;
        buffer_.Resize(size_);
    }

    auto* srcPtr = (unsigned char*)data;
    unsigned char* destPtr = &amp;buffer_[position_];
    position_ += size;
    memcpy(destPtr, srcPtr, size);

    return size;
}
</code></pre>
<pre><code class="lang-auto">unsigned MemoryBuffer::Write(const void* data, unsigned size)
{
    if (size + position_ &gt; size_)
        size = size_ - position_;

    if (!size)
        return 0;

    auto* srcPtr = (unsigned char*)data;
    unsigned char* destPtr = &amp;buffer_[position_];
    position_ += size;
    memcpy(destPtr, srcPtr, size);

    return size;
}
</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pihozamo</div>
          <div class="post_content">
<p>Thanks, honestly it wouldn’t be such a big issue if it weren’t for the way larger file size <img alt=":stuck_out_tongue:" class="emoji" src="../../../images2/2163fe85d10cc0d651a6a2d04efe61d0.png" title=":stuck_out_tongue:"/></p>
<p>By changing those funcs nothing else changes? What’s the downside?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>There is no downside , the  upside is that it fixes unaligned write on ARM</p>
<p>You can read about it in <a  rel="nofollow noopener">https://github.com/urho3d/Urho3D/issues/2386</a></p>
<p>It should be merged into master</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>PR is welcome…</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>Done<br/>
20  characters .</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Thanks for your PR. It is merged.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1437_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">elix22</div>
          <div class="post_content">
<p>While working on my code<br/>
I found one more use case of Android crash in ARM/release configuration while calling MemoryBuffer::Read() or VectorBuffer::Read()</p>
<p>Previous fix was for crash  on MemoryBuffer::Write() , VectorBuffer::Write()</p>
<p>updated the PR<br/>
<aside class="onebox githubpullrequest">
<header class="source">
<a  rel="nofollow noopener" target="_blank">github.com/urho3d/Urho3D</a>
</header>
<article class="onebox-body">
<a href="https://github.com/elix22" rel="nofollow noopener" target="_blank">
<img alt="elix22" class="thumbnail onebox-avatar" height="90" src="../../../images2/79591f0ba32686fb2a1ef15e7bc147d0.png" width="90"/>
</a>
<h4>
<a  rel="nofollow noopener" target="_blank">Android crash in ARM/Release configuration while calling MemoryBuffer::Read() or VectorBuffer::Read()</a>
</h4>
<div class="date">
  by <a href="https://github.com/elix22" rel="nofollow noopener" target="_blank">elix22</a>
  on <a  rel="nofollow noopener" target="_blank">12:22PM - 04 May 19 UTC</a>
</div>
<div class="github-commit-stats">
<strong>4 commits</strong>
  changed <strong>2 files</strong>
  with <strong>2 additions</strong>
  and <strong>32 deletions</strong>.
</div>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Yeah, I also have a feeling the same pattern of code might get used in a few places in our code base.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>