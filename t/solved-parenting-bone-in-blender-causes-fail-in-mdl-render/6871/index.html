<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>[Solved] Parenting bone in Blender Causes Fail in mdl Render</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">[Solved] Parenting bone in Blender Causes Fail in mdl Render</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Jens</div>
          <div class="post_content">
<p>I have a character model, which needs to be movable. Unfortunately, parenting between mesh and bones causes strange problems when exporting via fbx - either the material is not drawn where it should be (is somehow deformed), else it is omitted altogether.</p>
<p>At first I’d thought the mesh is messed up; however, looking at the fbx model in a viewer shows the mesh  intact, whilst the material either isn’t present, or in the wrong position. For example with just a single bone, the hands are not visible, and part of the head is incorrect.</p>
<p>I do have software experience inc. c++ games (long time ago); however, here I’m using Urhosharp for an android application and am trying to learn as I go. I would imagine that Urho3d would also have problems with this model, since it nearly must be a problem with AssetImporter. Having said that, there are a lot of Blender (v2.92) options I’m not 100% sure of, so it could also be a problem with me. For example, maybe the mesh (approx. 9000 triangles) is too complex, and should be simplified. Having said that, the model renders perfectly when no bones attached. ANY help would be much appreciated, thanks.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">SirNate0</div>
          <div class="post_content">
<aside class="quote no-group" data-post="1" data-topic="6871" data-username="Jens">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/2afa8624aa322ffb54688f2962497a42.png" width="20"/> Jens:</div>
<blockquote>
<p>At first I’d thought the mesh is messed up; however, looking at the fbx model in a viewer shows the mesh intact, whilst the material either isn’t present, or in the wrong position. For example with just a single bone, the hands are not visible, and part of the head is incorrect.</p>
</blockquote>
</aside>
<p>Wouldn’t this indicate that it is a problem with Blenders fbx exporter, as opposed to something to do with the AssetImporter? If so, you might want to try the blender add-ons that directly export to Urho’s model format.</p>
<p>Also, welcome to the forum!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Jens</div>
          <div class="post_content">
<aside class="quote no-group" data-post="2" data-topic="6871" data-username="SirNate0">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/fb52f23a6782e890737d90432eac55f2.png" width="20"/> SirNate0:</div>
<blockquote>
<p>Wouldn’t this indicate that it is a problem with Blenders fbx exporter, as opposed to something to do with the AssetImporter? If so, you might want to try the blender add-ons that directly export to Urho’s model format.</p>
<p>Also, welcome to the forum!</p>
</blockquote>
</aside>
<p>Thanks very much!</p>
<p>I should maybe of mentioned this, but importing the fbx file back into Blender works fine (at least as far as material rendering goes).</p>
<p>Unfortunately, the blender add-on does not work with the newest versions of Blender. Though, if there seems to be no solution to this, my only option might be to try an older version + add on.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">SirNate0</div>
          <div class="post_content">
<p>According to another user there is a branch of the add-on that does work with Blender 2.92</p>
<aside class="quote" data-post="4" data-topic="6840">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" loading="lazy" src="../../../images2/7959f0d708dd3df34167f10f810416b9.png" width="20"/>
<a href="https://discourse.urho3d.io/t/what-are-the-options-for-dealing-with-animations/6840/4">What are the options for dealing with animations?</a> <a class="badge-wrapper bullet" href="/c/discussions/7"><span class="badge-category-bg" style="background-color: #25AAE2;"></span><span class="badge-category clear-badge" data-drop-close="true" style="" title="Discussions about using Urho3D.">Discussions</span></a>
</div>
<blockquote>
    The Blender addon has a <a href="https://github.com/1vanK/Urho3D-Blender/tree/2_80" rel="noopener nofollow ugc">2.8 branch</a> which works also for the latest 2.92 release.
  </blockquote>
</aside>

          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Jens</div>
          <div class="post_content">
<aside class="quote no-group" data-post="4" data-topic="6871" data-username="SirNate0">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/fb52f23a6782e890737d90432eac55f2.png" width="20"/> SirNate0:</div>
<blockquote>
<p>According to another user there is a branch of the add-on that does work with Blender 2.92</p>
</blockquote>
</aside>
<p>Ok, that’s good to know, thanks. Having tried the add-on, the problem persisted, so I tried to download another model to see what happens. Again, once an armature is applied to the mesh, render problems occur. Bit more dramatic this time in that the right arm and part of the chest are simply not rendered. The mesh is taken into Urho3d (via c# wrapper) as an AnimatedModel, with the .SetModel method’s boolean argument (create bones) set to true. Strangely, if this is set to false there is no apparent change - the skeleton still has a bone, and the rendered model still misses an arm. A material is then applied from a solid colour.</p>
<p>The only clue I can find, is that both models had a warning in the add-on export details:<br/>
‘Incompatible vertex elements in object…’</p>
<p>Nonetheless, I’m completely baffled as to what is happening, especially since the model renders perfectly when the armature is deleted. I’ve uploaded some screen shots of the differing model in the android emulator, plus the blender workspace. I was hoping to upload the actual blender file, in the hope that someone more knowledgeable might figure out what is wrong, but this is not allowed.</p>
<p><div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="NoBoneAndroid"><img alt="NoBoneAndroid" data-base62-sha1="uTYFnLqO72vtKHqsjDS5eQKifAL"  height="250" src="../../../images2/f5a16aa04dcd43eeb413807ba2207577.png"  width="175"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename">NoBoneAndroid</span><span class="informations">486×693 18.3 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Jens</div>
          <div class="post_content">
<p>It turns out that new users can only upload one item:<br/>
<div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="SingleBoneAndroid"><img alt="SingleBoneAndroid" data-base62-sha1="vsZUVJg1s1nazIafN4LWX8sPeYI"  height="250" src="../../../images2/10169c59f9860c97560107c7b7fad80b.png"  width="180"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename">SingleBoneAndroid</span><span class="informations">492×682 17.7 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Jens</div>
          <div class="post_content">
<p><img alt="SingleBoneBlender" data-base62-sha1="6e79xrTjUomAozMrAJsOhJBw7Al" height="250" src="../../../images2/cfa1b93cddd2cde4c73dccf99dba19b4.jpeg" width="233"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">SirNate0</div>
          <div class="post_content">
<p>The error in the exporter looks like it’s due to missing blend indices or something like that. Try making sure all the vertices have at least one bone with nonzero weight.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Jens</div>
          <div class="post_content">
<p>You are correct - on my full skeleton rig, changing parenting from auto to envelope weights fixed this. I thought that’d already been tried, but apparently not. Single bone tests were not useful, as it seems a single bone will not correctly set weights on all vertex groups.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>