<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>LitSolid(AO) missing vertex element?</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">LitSolid(AO) missing vertex element?</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>I’m converting the Basic Rendering Techniques sample to run on hololens. Currently have all the techniques working but two.</p>
<p>ERROR: Failed to create input layout for shader LitSolid(AO) due to missing vertex element(s) (HRESULT 80070057)</p>
<p>System.Exception: Failed to create blend state (HRESULT 80070057).</p>
<p>That technique is defined here: <a href="https://github.com/xamarin/urho-samples/blob/master/FeatureSamples/Assets/Data/Sample43/MatDiffAO.xml" rel="nofollow noopener">https://github.com/xamarin/urho-samples/blob/master/FeatureSamples/Assets/Data/Sample43/MatDiffAO.xml</a></p>
<p>The code using it is here: <a href="https://github.com/xamarin/urho-samples/tree/master/FeatureSamples/Core/43_BasicTechniques" rel="nofollow noopener">https://github.com/xamarin/urho-samples/tree/master/FeatureSamples/Core/43_BasicTechniques</a></p>
<p>Specifically: <a href="https://github.com/xamarin/urho-samples/blob/b72d055a424d0e6be825c0239683c225d29ee723/FeatureSamples/Core/43_BasicTechniques/BasicTechniques.cs#L104" rel="nofollow noopener">https://github.com/xamarin/urho-samples/blob/b72d055a424d0e6be825c0239683c225d29ee723/FeatureSamples/Core/43_BasicTechniques/BasicTechniques.cs#L104</a></p>
<p>As an aside, the other technique not working is the CustomShader technique which is missing the HLSL shader. Can anyone offer how to get the HLSL shader given the GLSL shader?</p>
<p>It’s not complex: <a href="https://github.com/xamarin/urho-samples/blob/master/FeatureSamples/Assets/Data/Shaders/GLSL/Sample43CustomShader.glsl" rel="nofollow noopener">https://github.com/xamarin/urho-samples/blob/master/FeatureSamples/Assets/Data/Shaders/GLSL/Sample43CustomShader.glsl</a></p>
<p>This sample works on other platforms.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">GodMan</div>
          <div class="post_content">
<p>So do you need someone to convert that opengl shader to hlsl?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3290_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Modanung</div>
          <div class="post_content">
<aside class="onebox whitelistedgeneric">
<header class="source">
<a href="https://docs.microsoft.com/en-us/windows/uwp/gaming/glsl-to-hlsl-reference" rel="nofollow noopener" target="_blank">docs.microsoft.com</a>
</header>
<article class="onebox-body">
<img class="thumbnail onebox-avatar" height="400" src="../../../images2/085ebe63bc7da53860ce43e2b2246307.png" width="400"/>
<h3><a href="https://docs.microsoft.com/en-us/windows/uwp/gaming/glsl-to-hlsl-reference" rel="nofollow noopener" target="_blank">GLSL-to-HLSL reference - Windows UWP applications</a></h3>
<p>You port your OpenGL Shader Language (GLSL) code to Microsoft High Level Shader Language (HLSL) code when you port your graphics architecture from OpenGL ES 2.0 to Direct3D 11 to create a game for Universal Windows Platform (UWP).</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>

          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-full="true" data-post="2" data-topic="4810" data-username="GodMan">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/ec6d74ff2472bced6f12da93c20c296f.png" width="20"/> GodMan:</div>
<blockquote>
<p>So do you need someone to convert that opengl shader to hlsl?</p>
</blockquote>
</aside>
<p>I didn’t know if there is an easy way to do it, for instance with a tool. But it looks like not.</p>
<p>When I get time I’ll work through it as per the link <span class="mention">@Modanung</span> provided.</p>
<p>I just wanted to get all those materials in the sample code working on hololens.</p>
<p>Getting to the root cause of the DiffAO material or shader issue is the more important issue  because root cause of the error is not yet known, whereas the CustomMaterial related error just needs the GLSL to HLSL conversion.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>I wiped out the code and started fresh. Whereupon the DiffAO related object at least paints, but still throws the error about the missing vertex.</p>
<p>Also, modified the TechniqueCustomShader.xml file from:</p>
<pre><code class="lang-auto">
&lt;!--Sample23CustomShader.glsl--&gt;
&lt;technique vs="Sample43CustomShader" ps="Sample43CustomShader" vsdefines="NOUV" &gt;
    &lt;pass name="alpha" depthwrite="false" blend="alpha" /&gt;
&lt;/technique&gt;
</code></pre>
<p>to</p>
<pre><code class="lang-auto">&lt;!--Sample23CustomShader.glsl for open GL systems, but on D3D it will go for the HLSL file --&gt;
&lt;technique vs="CustomLitSolid" ps="CustomLitSolid" vsdefines="NOUV" &gt;
    &lt;pass name="alpha" depthwrite="false" blend="alpha" /&gt;
&lt;/technique&gt;
</code></pre>
<p>Why? Because I’m just not a shader guru and don’t aspire to be one. And would just like the SharpReality c# samples to run on a hololens. And the CustomListSolid is a fairly interesting technique to view, but can’t put into words just what it is doing.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Just wanted to keep the error that’s occuring:</p>
<p>[4] [Fri Jan 11 19:40:33 2019] ERROR: Failed to create input layout for shader LitSolid(AO) due to missing vertex element(s) (HRESULT 80070057)<br/>
System.Exception: Failed to create blend state(HRESULT 80070057). You can omit this exception by subscribing to Urho.Application.UnhandledException event and set Handled property to True.<br/>
ApplicationOptions: args -w -nolimit -x 1268 -y 720 -p “CoreData;Data” -touch -hd -landscape -portrait<br/>
[4][Fri Jan 11 19:40:39 2019] ERROR: Failed to create blend state (HRESULT 80070057)</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>In the urho3d docs, there is this:</p>
<h2>Inbuilt compilation defines</h2>
<p>When rendering scene objects, t_he engine expects certain shader permutations to exist_ for different geometry types and lighting conditions. These correspond to the following compilation defines:</p>
<p>Vertex shader:</p>
<p>*** NUMVERTEXLIGHTS=1,2,3 or 4: number of vertex lights influencing the object**</p>
<p>Could this be what the error is referring to? There is a missing vertex light?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Got the urho logging going, so getting a bit more info, but not much. Here’s some of the log when loading the basic rendering techniques sample:</p>
<pre><code class="lang-auto">1:)  [Fri Jan 25 17:25:27 2019] DEBUG: Loading resource Shaders/HLSL/CopyFramebuffer.hlsl
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled vertex shader CopyFramebuffer()
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled pixel shader CopyFramebuffer()
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled vertex shader Water()
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled pixel shader Water()
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Loaded cached vertex shader CustomLitSolid(NOUV)
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Loaded cached pixel shader CustomLitSolid()
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled vertex shader LitSolid(AO)
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled pixel shader LitSolid(AO DIFFMAP)
4:)  [Fri Jan 25 17:25:28 2019] ERROR: Failed to create input layout for shader LitSolid(AO) due to missing vertex element(s) (HRESULT 80070057)
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled pixel shader LitSolid(DIFFMAP DIRLIGHT PERPIXEL SPECULAR)
1:)  [Fri Jan 25 17:25:28 2019] DEBUG: Compiled pixel shader LitSolid(DIFFMAP)
1:)  [Fri Jan 25 17:25:30 2019] DEBUG: Compiled vertex shader Unlit(NOUV)
1:)  [Fri Jan 25 17:25:30 2019] DEBUG: Compiled pixel shader Unlit()
1:)  [Fri Jan 25 17:25:30 2019] DEBUG: Compiled pixel shader LitSolid(AMBIENT DIRLIGHT NORMALMAP PERPIXEL)
Failed to create blend state (HRESULT 80070057). You can omit this exception by subscribing to Urho.Application.UnhandledException event and set Handled property to True.
ApplicationOptions: args -w -nolimit -x 1268 -y 720 -p "CoreData;Data" -touch -hd -landscape -portrait :Error
4:)  [Fri Jan 25 17:25:30 2019] ERROR: Failed to create blend state (HRESULT 80070057)
1:)  [Fri Jan 25 17:25:31 2019] DEBUG: Removed unused screen buffer size 1268x720 format 10
</code></pre>
<p>Trying to understand the root cause of this error:</p>
<aside class="quote no-group" data-post="9" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>4:) [Fri Jan 25 17:25:28 2019] ERROR: Failed to create input layout for shader LitSolid(AO) due to missing vertex element(s) (HRESULT 80070057)</p>
</blockquote>
</aside>
<p><strong><code>E_INVALIDARG</code> :</strong>  One or more arguments are not valid ( <code>0x80070057</code> )</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">lezak</div>
          <div class="post_content">
<p>From LitSolid.hlsl:</p>
<blockquote>
<p><span class="hashtag">#ifdef</span> AO<br/>
// If using AO, the vertex light ambient is black, calculate occluded ambient here<br/>
finalColor += Sample2D(EmissiveMap, iTexCoord2).rgb * cAmbientColor.rgb * diffColor.rgb;<br/>
<span class="hashtag">#endif</span></p>
</blockquote>
<p>AO uses second UV map and probably that’s what You’re missing.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Ok. But not sure what to do to fix that.</p>
<p>Experimented (did little changes all over the code, in the material file, the hlsl shader file, etc) trying to get some change in the error message. Nothing I did changed that error message.</p>
<p>Also noted that DiffAO.xml won’t show anything, but DiffAOAlpha.xml gives the exact same error but does show some of the material.</p>
<p>Also verified the <a href="https://github.com/xamarin/urho-samples/tree/master/FeatureSamples/Core/43_BasicTechniques" rel="nofollow noopener">UWP Feature Sample</a> behaves identically as my converted Hololens sample, and it does. Both generate the exact same message for UWP.</p>
<p>To verify that this feature sample creates the error, did a simple change and then ran it.</p>
<p>The change was to allow the sample to be included, the author’s of the UWP sample purposely excluded the Basic Techniques sample for UWP. In the file MainPage.XAML.cs, added the comment characters to allow Basic Techniques to be included. :</p>
<pre><code class="lang-auto">		public MainPage()
		{
			Urho.Application.UnhandledException += (s, e) =&gt; e.Handled = true;
			InitializeComponent();
			GameTypes = typeof(Sample).GetTypeInfo().Assembly.GetTypes()
				.Where(t =&gt; t.GetTypeInfo().IsSubclassOf(typeof(Application)) 
					&amp;&amp; t != typeof(Sample) //&amp;&amp; t != typeof(BasicTechniques) 
					&amp;&amp; t != typeof(PBRMaterials) &amp;&amp; t != typeof(DynamicGeometry))
				.Select((t, i) =&gt; new TypeInfo(t, $"{i + 1}. {t.Name}", ""))
				.ToArray();
			DataContext = this;
		}
</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">lezak</div>
          <div class="post_content">
<aside class="quote no-group" data-post="11" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>Ok. But not sure what to do to fix that.</p>
</blockquote>
</aside>
<p>Are You using model with second UV map? If not, don’t use technique that require second UV with model that don’t have it.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Well, I just don’t know if it has the second UV map. I’m not experienced with materials, or models or blender. I’m coming at this from a code first approach, and this is one of the few things I’ve not gotten past. Shadows is a second.</p>
<p>But here is what I do know:</p>
<p>The feature samples provided with SharpReality, can run this without the error, when run on WPF or WinForms platforms. It fails with UWP.</p>
<p>Because two platforms run this same model, and don’t have the error, it would seem it’s not a missing UV map in the model. Again, newbie assumption here I’m making.</p>
<p>The only difference, besides possible platform differences, and  that I can find with my beginner eyes, is the UWP platform sample includes it’s own Data file.</p>
<p>So I took all those files, and added to them all the files in Data/Assets folders I could find, those files used by the WPF and WinForms samples. My Data folder is now about .5 GB in size, bursting with every file found. And I don’t get any messages about missing files (except one custom hlsl shader, that is unrelated to this).</p>
<p>Now, my assumption all along is that some file is missing, because it works fine on WPF and winforms.</p>
<p>If I could find some way to relate that error message to something tangible, something to do other than hope, then maybe I’ll make progress. Have reviewed all I know to review, but in the end, it will surely be something totally simple. That’s just how it goes.</p>
<p>Edit: Here’s another difference. The WPF and Winforms samples must be running OpenGL, because they also show the CustomMaterial, and it’s shader is only provided in the GLSL version.</p>
<p>So apparently the DiffAO works only on OpenGL, and there must be some difference in the HLSL file or there is something else missing.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">lezak</div>
          <div class="post_content">
<aside class="quote no-group" data-post="13" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>So apparently the DiffAO works only on OpenGL, and there must be some difference in the HLSL file or there is something else missing.</p>
</blockquote>
</aside>
<p>This is not true. I’ve downloaded model used in the sample and on neather Directx nor OpenGL this material doesn’t work properly, it’s because of what I’ve said earlier - model don’t have second UV set, OpenGL just doesn’t log any error. Just to be clear I’m using ‘normal’ C++ Urho, but this shouldn’t make a difference.<br/>
As for Your “code first approach”, this not a way to go with this error. <a href="https://urho3d.github.io/documentation/HEAD/_vertex_buffers.html" rel="noopener nofollow ugc">Here is the list </a> of vertex elements and before that there is important, in this case, sentence: " Each of the following elements may or may not be present". Error under discussion means that shader require element that is not present. If You want to fix it only from code, here is what You should do to make this sample work as it supposed to: calculate uv coordinates for every vertex of each geometry (this model have 3 of them) and place them in right place in vertex buffers. It can be done, but good luck with that (ok, in this particular case it may not be that hard, since You’d propably want to use same coordinates as UV1).<br/>
Now, here are realistic and much simpler  solutions: don’t use this technique, since it’s not suitable for this model, modify shader to use only one UV or use 3d modelling software to add missing vertex elements. You can also remove all "defines=“AO” from “DiffAO” technique xml, but then it will be the same as “Diff.xml” technique.<br/>
To make it even more clear: nornal map can be another example - using normal map require tangent vertex element, if it’s not present You’ll get the same error on DirectX and on OpenGL material will be displayed without normal map.<br/>
And for the reference, here is how this material look on model with second UV:<div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="Screenshot_Sun_Jan_27_02_39_13_2019"><img alt="Screenshot_Sun_Jan_27_02_39_13_2019" data-base62-sha1="luIxM9IyBHyrGwVXKOc1aV3fsq"  height="356" src="../../../images2/cfca73199fb1d409392ce00d56738a05.png"  width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use href="#far-image"></use></svg><span class="filename">Screenshot_Sun_Jan_27_02_39_13_2019</span><span class="informations">1366×705 86 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>That is how the material looks in the feature samples when run on the WPF and WinForms platforms. Those two platforms run all the materials in the Basic Techniques seemingly perfectly. I didn’t know what DiffAO looked like until viewing on those. But, my eyes may not see enough detail, perhaps they are not right.</p>
<p>The UWP sample fails and there is nothing visible at all.</p>
<p>I thought all three WPF, UWP and WInForms would be D3D11. But I don’t understand where they get the HLSL shader for the CustomMaterial, so propose the WPF and WInForms samples run on GLSL not HLSL, and that is why they work.</p>
<p>Here’s the UWP, then WPF samples. The WPF sample also runs the CustomMaterial without error and only the GLSL shader is provided for it.</p>
<p><img alt="PNG" height="500" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/8/8d87db699468610e9fd76ea31671def5bb403ed3.jpeg" width="573"/></p>
<p>and now WPF<br/>
<img alt="WPF" height="394" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/1/18357b6441abb2bdde1be69ff056c9a3e1035740.png" width="690"/></p>
<p>Also on the UWP sample it looks like NoTextureMultiply isn’t working right either.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-post="14" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>And for the reference, here is how this material look on model with second UV:</p>
</blockquote>
</aside>
<p>Is that model available online? I’ll try to run it and see how it goes. Or another model I can use with 2nd UV map.</p>
<p>But also think you’re running OpenGL and that is why it is working. There isn’t a working instance of DiffAO on HLSL shaders that I’ve found.</p>
<p>The current model used is the Urho.Shapes.Sphere and this is the material:</p>
<pre><code class="lang-auto">&lt;material&gt;
    &lt;technique name="Techniques/DiffAO.xml" /&gt;
	&lt;texture unit="diffuse" name="Sample43/Earth.jpg" /&gt;
	&lt;texture unit="emissive" name="Sample43/Earth_SpecularMap.png" /&gt;
    &lt;parameter name="MatSpecColor" value="0.3 0.3 0.3 1" /&gt;
&lt;/material&gt;
</code></pre>
<p><a href="https://urho3d.github.io/documentation/HEAD/_vertex_buffers.html" rel="noopener nofollow ugc">Read the link provided</a>, and checked the vertex buffers of a model that is working:<br/>
<div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="VertexBuffersOfWorkingModel"><img alt="VertexBuffersOfWorkingModel" data-base62-sha1="131GwPqeoKY4rbD4so79MgZFjy5"  height="393" src="../../../images2/51aae94d046b3cb93c593b4a18c56b82.png" width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use href="#far-image"></use></svg><span class="filename">VertexBuffersOfWorkingModel</span><span class="informations">1601×913 22.5 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>Not sure how visible it is, there  is a single buffer.</p>
<p>The element mask is Position | Normal | Color | TexCoord1 | Tangent.</p>
<p>Here’s the same for a not working model, same model, but on UWP platform, and not working:<br/>
<div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="NotWorkingModelWithAO"><img alt="NotWorkingModelWithAO" data-base62-sha1="roXOSqthJkzhtJ41y2u4LcP4IkP"  height="388" src="../../../images2/05ac8f1b4195b7ac39f8521f98243703.png" width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use href="#far-image"></use></svg><span class="filename">NotWorkingModelWithAO</span><span class="informations">1620×911 21.9 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Have verified the WPF and Winforms samples are running the GLSL shaders.</p>
<p>So the primary difference between the working samples, and the NOT working sample is the working samples use LitSolid.GLSL and the NOT working sample uses the LitSolid.HLSL shader.</p>
<p><strong>I propose the LitSolid.HLSL shader does not work with AO. That it is faulty.</strong></p>
<p><a href="https://discourse.urho3d.io/t/failed-to-create-input-layout-for-shader-litsolid-dirlight-normalmap-perpixel-due-to-missing-vertex-element/4538">Similar but slightly different thread</a>, not for AO.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-full="true" data-post="2" data-topic="4810" data-username="GodMan">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/ec6d74ff2472bced6f12da93c20c296f.png" width="20"/> GodMan:</div>
<blockquote>
<p>So do you need someone to convert that opengl shader to hlsl?</p>
</blockquote>
</aside>
<p>Exploring why the LitSolid.hlsl shader doesn’t work with AO would be valuable, if you have time. As per my thesis …</p>
<aside class="quote no-group" data-post="17" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>I propose the LitSolid.HLSL shader does not work with AO. That it is faulty.</p>
</blockquote>
</aside>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">lezak</div>
          <div class="post_content">
<p>I don’t want to repeat, but once again: this material doesn’t work properly with this model no matter what graphics API You are using. Screenshot of Your “working” version just confirms that, because the material is not displayed correctly. Here’ s the tip if You don’t see any difference between screenshot I posted and what You think is correct: look closer at the part of sphere that is occluded from the light, there is a quite noticeable diffrence in looks of continents and oceans.<br/>
As for the model, I cannot upload it to the forum directly, but it’s just a sphere with the same uv map in two slots made in blender.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Ok, is there any model anywhere … anywhere obtainable, with two uv maps?</p>
<p>I’m not ready to learn blender yet.</p>
<aside class="quote no-group" data-post="19" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>Screenshot of Your “working” version just confirms that, because the material is not displayed correctly.</p>
</blockquote>
</aside>
<p>I’ve found that if I disable the vertex shading portion and just do the pixel shading of LitSolid.hlsl, then it will paint an output in UWP that looks very similar to the OpenGL version. So I am thinking that the glsl silently ignores VS, and just does PS for AO, at least for the model I’m using.</p>
<p>Alternatively,</p>
<aside class="quote no-group" data-post="14" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>modify shader to use only one UV</p>
</blockquote>
</aside>
<p>Is that easy? I looked through the file, and am not sure where the first UV map is being accessed, not to mention the second.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-post="14" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>here is what You should do to make this sample work as it supposed to: calculate uv coordinates for every vertex of each geometry (this model have 3 of them) and place them in right place in vertex buffers. It can be done, but good luck with that (ok, in this particular case it may not be that hard, since You’d propably want to use same coordinates as UV1).</p>
</blockquote>
</aside>
<p><a  rel="noopener nofollow ugc">So following the code as shown here</a> … what I’d need to do is define another TexCoord on each vertex?</p>
<p>Is that what will fix the model?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p><a href="https://github.com/xamarin/urho-samples/blob/b72d055a424d0e6be825c0239683c225d29ee723/HoloLens/02_HelloWorldAdvanced/Data/Shaders/HLSL/CustomLitSolid.hlsl#L1" rel="nofollow noopener">Found an example of rewriting PS() in the litsolid shader</a>. This sample explains it enough to be able to provide a custom shader for the AO implementation.</p>
<p>This is enough to figure out a workaround.</p>
<p>Still, at the point of use of the material in the code (mat = Material.FromImage(imageWithOneUVmap);), I suspect there is a simple way to correct this missing UV layer problem.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p><a href="https://github.com/xamarin/urho/blob/050fdf9943b154549e7928b32f398e727191202a/Urho3D/CoreData/Shaders/HLSL/LitSolid.hlsl#L19" rel="nofollow noopener">This is the line causing that error message to appear</a>.</p>
<p>If TEXCOORD1 is changed to TEXCOORD0, it will successfully paint the object, but the result is apparently is not proper AO.</p>
<p><img alt="PNG" height="500" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/7/7ac5b559907e3df95fbd8ae5f165fa138da4cea3.jpeg" width="481"/></p>
<p>Still haven’t got around to fixing CustomShader or NoTextureMultiply. The CustomShader in the sample is missing the HLSL shader, and not sure what is wrong with NoTextureMultiply.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-post="20" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>modify shader to use only one UV</p>
</blockquote>
</aside>
<p>That is what I’ve done at this point.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2384_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Leith</div>
          <div class="post_content">
<p>Modify geometry to have two UV maps sounds like what you really want.</p>
<p>The vertex data in your model requires more than one UV per vertex - so go back to your modelling app, and add a second UV map, save the asset, and reimport it. You should not be hacking the AO shader to suit the model, you should be hacking the model to suit the shader.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-post="25" data-topic="4810" data-username="Leith">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/344277caf39f87861709d8bd9d77ec6d.png" width="20"/> Leith:</div>
<blockquote>
<p>Modify geometry to have two UV maps sounds like what you really want.</p>
</blockquote>
</aside>
<p>Yes, <span class="mention">@lezak</span> has been making that same point.</p>
<aside class="quote no-group" data-post="12" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>Are You using model with second UV map? If not, don’t use technique that require second UV with model that don’t have it.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="14" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>As for Your “code first approach”, this not a way to go with this error.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="14" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>use 3d modelling software to add missing vertex elements</p>
</blockquote>
</aside>
<p>To which I responded:</p>
<aside class="quote no-group" data-post="20" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>I’m not ready to learn blender yet.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-post="13" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>I’m coming at this from a code first approach</p>
</blockquote>
</aside>
<p>In conclusion, was able to make a very simple change to an existing shader, and provided a custom shader for the particular problem, so I could continue to use the materials supplied with the original sample, and get close to a fully working sample.</p>
<p>Going through the process in the code allowed me to grasp the linkages between the .xml material file, the techniques, textures and shaders.  Blender use hasn’t yet transferred that knowledge to me (what I have gleaned from blender is I don’t know it well enough to use it effectively yet, and it’s just not yet the right time to begin to fully consume it with my mind, but have been slowly trodding that path, just not with determination, only curiosity)</p>
<p>Apparently, those much more experienced in graphics/3D world tech don’t agree. That’s fine, we all don’t have to agree.</p>
<p>My next steps for this are to write a custom shader by converting the glsl custom shader to an hlsl shader. Then figure out why the NoTextureMultiply sample isn’t working.</p>
<hr/>
<p>While <span class="mention">@lezak</span> points out the obvious differences between his AO display and mine, it would seem the edit I did and described above, produces identical results to his when ASSUMING the lighting, the ambient lighting, and material’s settings and zone settings are defined identically.</p>
<p>Because in the custom shader I did, it uses the first UV map as the second. In the custom model he did, he created a second UV map by copying the first.</p>
<p>It would be great if all the samples just worked on all the platforms. But learning blender won’t give me enough (or any) details on how to get the samples running on hololens without code changes. Digging into the code and actually getting the samples running on hololens does. But this code-first implementation is more about the hololens binding implementation than it is about urho3d (shadows not working on hololens).  But ultimately, without useful bindings, what good is urho3d?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">lezak</div>
          <div class="post_content">
<p>Rather sonner then later You’ll reach the point where You’ll have to use 3d modelling software, I would even say, that because we’ll still discussing in this topic, You’ve already reached that point.<br/>
The thing about ambient occlusion texture is that it shouldn’t be using overlapping UVs and that’s why it’s good to have it on the second UV, but if there is no overlapping (for example this case) there is no harm in using the same UV.</p>
<aside class="quote no-group" data-post="23" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p><a href="https://github.com/xamarin/urho/blob/050fdf9943b154549e7928b32f398e727191202a/Urho3D/CoreData/Shaders/HLSL/LitSolid.hlsl#L19" rel="noopener nofollow ugc">This is the line causing that error message to appear </a>.</p>
<p>If TEXCOORD1 is changed to TEXCOORD0, it will successfully paint the object, but the result is apparently is not proper AO.</p>
</blockquote>
</aside>
<p>Just to be clear - it’s not this line causing error, it’s wrong model, but this solution should work  just fine. I would also suggest using <a href="https://earthobservatory.nasa.gov/features/NightLights" rel="noopener nofollow ugc"> different AO texture </a>, to make it look better (I’ve used default sphere and shader modified same way as You did):<br/>
<div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="Screenshot_Tue_Feb__5_02_51_03_2019"><img alt="Screenshot_Tue_Feb__5_02_51_03_2019" data-base62-sha1="tJUihMWVJ5Hr1I0DuSGZuqnJHC8"  height="356" src="../../../images2/f8d8de5ce29d157c2e3b32b681125a5c.jpeg"  width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use href="#far-image"></use></svg><span class="filename">Screenshot_Tue_Feb__5_02_51_03_2019</span><span class="informations">1366×705 65.3 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<aside class="quote no-group" data-post="26" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>It would be great if all the samples just worked on all the platforms.</p>
</blockquote>
</aside>
<p>Wrong forum for this part. Maybe You should create issue on github/forum dedicated to urhosharp?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-post="27" data-topic="4810" data-username="lezak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/6ef2f82e83bb3859852dc241e102e0b3.png" width="20"/> lezak:</div>
<blockquote>
<p>I would also suggest using <a href="https://earthobservatory.nasa.gov/features/NightLights" rel="noopener nofollow ugc"> different AO texture </a>,</p>
</blockquote>
</aside>
<p>Not sure which texture you were referring to? I usually get them <a href="https://visibleearth.nasa.gov/view_cat.php?categoryID=1484" rel="noopener nofollow ugc">from here</a>.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>Got the customshader sample running, in case anyone is interested.</p>
<p><img alt="PNG" height="500" src="//cdck-file-uploads-global.s3.dualstack.us-west-2.amazonaws.com/standard17/uploads/urho3d/original/2X/b/b376b1d9152950ded0f19f5991776d89cea418fa.jpeg" width="544"/></p>
<p>The HLSL shader code is:</p>
<pre><code class="lang-auto">#include "Uniforms.hlsl"
#include "Samplers.hlsl"
#include "Transform.hlsl"
#include "ScreenPos.hlsl"

void VS(float4 iPos : POSITION,
	float3 iNormal : NORMAL,
	float4 iTangent : TANGENT,
	float2 iTexCoord : TEXCOORD0,
	out float2 oTexCoord : TEXCOORD0,
	out float3 oNormal : TEXCOORD1,
	out float4 oWorldPos : TEXCOORD2,
	out float4 oTangent : TEXCOORD3,
	out float4 oEyeVec : TEXCOORD4,
	out float4 oScreenPos : TEXCOORD5,
	out float4 oPos : OUTPOSITION)
{
	float3 worldPos = GetWorldPos(iModelMatrix);
	oPos = GetClipPos(worldPos);
	oNormal = GetWorldNormal(iModelMatrix);
	oWorldPos = float4(worldPos, GetDepth(oPos));
	float3 tangent = GetWorldTangent(iModelMatrix);
	float3 bitangent = cross(tangent, oNormal) * iTangent.w;
	oTexCoord = float4(GetTexCoord(iTexCoord), bitangent.xy);
	oEyeVec = float4(cCameraPos - worldPos, GetDepth(oPos));
}

void PS(
	float4 iTexCoord : TEXCOORD0,
	float3 iNormal : TEXCOORD1,
	float4 iWorldPos : TEXCOORD2,
	float4 iTangent : TEXCOORD3,
	float4 iEyeVec : TEXCOORD4,
	float4 iScreenPos : TEXCOORD5,
	out float4 oColor : OUTCOLOR0)
{
	float f = dot(normalize(iEyeVec.xyz), normalize(iNormal));
	oColor = float4(1,1,1,1-f);
}
</code></pre>
<p>First shader I’ve ever written. But it was mostly cut and paste.</p>
<p>There is something interesting in the rewrite.</p>
<p>The technique defines NOUV, which acts in the other shaders  to make iTexCoord a float2. But when I left it this way, the shader didn’t work. So I stipped out the float2 definition, and left it as a float4, and then in the VS part,  also calculated as a float4 as shown. Otherwise, it would have been just (GetTexCoord(iTexCoord)).</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<p>The last issue in that sample is the NoTextureMultiply doesn’t work.</p>
<p>This is the error generated:<br/>
ERROR: Failed to create blend state (HRESULT 80070057)</p>
<p>The hresult decodes as: E_INVALIDARG	One or more arguments are not valid</p>
<p>Not sure what this could be. The only way this particular sample varies from the NoTextureAdd sample is in the technique file:</p>
<p>NoTextureAdd.xml</p>
<pre><code class="lang-auto">&lt;technique vs="Unlit" ps="Unlit" vsdefines="NOUV" &gt;
    &lt;pass name="alpha" depthwrite="false" blend="add" /&gt;
&lt;/technique&gt;
</code></pre>
<p>And NoTextureMultiply:</p>
<pre><code class="lang-auto">&lt;technique vs="Unlit" ps="Unlit" vsdefines="NOUV" &gt;
  &lt;pass name="alpha" depthwrite="false" blend="multiply" /&gt;
&lt;/technique&gt;
</code></pre>
<p>Not sure how to approach this to solve it. Tried re-writing the shader, as per the CustomShader rewrite described above (by setting the iTexCoord to a float4).</p>
<p>So the blend state alpha pass of multiply doesn’t work, but add works.</p>
<p>Can anyone offer a clue how to solve or find more info?</p>
<p>edit: also, if a new material for DiffMultiply is added, using the technique DiffMlutiply.xml, the same error is emitted.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">I3DB</div>
          <div class="post_content">
<aside class="quote no-group" data-post="29" data-topic="4810" data-username="I3DB">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/08ac2a702e042b87fc3e2def689b323c.png" width="20"/> I3DB:</div>
<blockquote>
<p>The HLSL shader code is:</p>
</blockquote>
</aside>
<p>That shader doesn’t quite work correctly. Viewed through a stereoscopic display (such as hololens), each of the lenses gets a slightly different output depending on orientation. Moving left to right across the object highlights the issue.</p>
<p>Still researching, and<a href="https://github.com/reattiva/Urho3D-Blender/blob/master/guide.txt" rel="noopener nofollow ugc">found this resource</a> which has a lot of info, but<a href="https://github.com/reattiva/Urho3D-Blender/blob/8a95ce7a8e7b8488e0b164762d050b1f95b318fd/guide.txt#L186" rel="noopener nofollow ugc">explains uv maps</a> and materials from urho3d’s viewpoint. The <a href="https://github.com/reattiva/Urho3D-Blender/blob/8a95ce7a8e7b8488e0b164762d050b1f95b318fd/guide.txt#L78" rel="noopener nofollow ugc">sections on UV</a> and <a href="https://github.com/reattiva/Urho3D-Blender/blob/8a95ce7a8e7b8488e0b164762d050b1f95b318fd/guide.txt#L240" rel="noopener nofollow ugc">on Materials</a> explain it well.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>