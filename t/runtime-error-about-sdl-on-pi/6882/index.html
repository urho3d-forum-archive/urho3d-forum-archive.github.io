<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Runtime error about SDL on pi</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Runtime error about SDL on pi</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Hi</p>
<p>Build finished on Raspberry Pi 4 but when I got to run a demo, get the following error:</p>
<p>[Tue Jun  8 22:01:09 2021] ERROR: Could not create window, root cause: ‘OpenGL support is either not configured in SDL or not available in current SDL video driver (x11) or platform’</p>
<p>Any help appreciated</p>
<p>Thanks</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">SirNate0</div>
          <div class="post_content">
<p>Try running it from a terminal and not a desktop? Though it’s been quite I few years since I’ve worked with Urho on a Pi…</p>
<p>Also, make sure the right libraries are installed. That’s one issue people on the Pi 4 ran into.</p>
<aside class="onebox githubissue">
<header class="source">
<a href="https://github.com/libsdl-org/SDL/issues/3678" rel="noopener nofollow ugc" target="_blank">github.com/libsdl-org/SDL</a>
</header>
<article class="onebox-body">
<div class="github-row">
<div class="github-icon-container" title="Issue">
<svg aria-hidden="true" class="github-icon" height="60" viewbox="0 0 14 16" width="60"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
</div>
<div class="github-info-container">
<h4>
<a href="https://github.com/libsdl-org/SDL/issues/3678" rel="noopener nofollow ugc" target="_blank">rpi video backend doesn't work with OpenGL on Raspberry Pi 4</a>
</h4>
<div class="github-info">
<div class="date">
        opened <span class="discourse-local-date" data-date="2021-02-11" data-format="ll" data-time="01:57:51" data-timezone="UTC">01:57AM - 11 Feb 21 UTC</span>
</div>
<div class="user">
<a href="https://github.com/SDLBugzilla" rel="noopener nofollow ugc" target="_blank">
<img alt="SDLBugzilla" class="onebox-avatar-inline" height="20" src="../../../images2/c5b43f0a3c8967bc47d69f61fcf26ebf" width="20"/>
          SDLBugzilla
        </a>
</div>
</div>
<div class="labels">
<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">bug</span>
</div>
</div>
</div>
<div class="github-row">
<p class="github-body-container"># This bug report was migrated from our old Bugzilla tracker.

These attachments<span class="show-more-container"><a class="show-more" href="" rel="noopener">…</a></span><span class="excerpt hidden"> are available in the static archive:

* [Initial fix for Raspberry Pi 4 (SDL-rpi4-support-RYAN1.diff, text/plain, 2020-05-09 06:57:47 +0000, 1843 bytes)](https://bugzilla.libsdl.org/attachment.cgi?id=4335)

**Reported in version:** HG 2.0
**Reported for operating system, platform:** Linux, ARM

# Comments on the original bug report:

On 2020-05-08 23:51:40 +0000, Ryan C. Gordon wrote:

&gt; SDL works fine on a virtual terminal on a Raspberry Pi 3 and earlier, using SDL's "rpi" video backend, but it doesn't work on Raspberry Pi 4.
&gt; 
&gt; Running testsprite2 in this configuration produces:
&gt; 
&gt;     INFO: Couldn't create window: Could not initialize EGL
&gt; 
&gt; My basic understanding from reading RetroPie developer discussions is that the dispmanx API doesn't work on the RPi4, and you have to use kmsdrm instead.
&gt; 
&gt; SDL has a kmsdrm backend, too, but it currently produces this for testsprite2:
&gt; 
&gt;     INFO: Couldn't create window: Could not initialize OpenGL / GLES library
&gt; 
&gt; To be clear: SDL+X11 still works fine on the RPi4--accelerated GLX and all--but this affects things that want to use a Pi as a game console or kiosk thing without X11.
&gt; 
&gt; --ryan.

On 2020-05-09 06:57:47 +0000, Ryan C. Gordon wrote:

&gt; Created attachment 4335
&gt; Initial fix for Raspberry Pi 4
&gt; 
&gt; 
&gt; This patch gets it running again, but it's not ready for revision control.
&gt; 
&gt; The basic idea is the KMSDRM target works, but it tries to default to desktop OpenGL, which causes SDL_GLES_LoadLibrary to fail, etc.
&gt; 
&gt; Setting the default to GLES2 lets it slide through far enough that desktop GL _will_ work, fwiw, but generally most things want GLES2 on the Raspberry Pi in any case, so this default makes sense regardless.
&gt; 
&gt; But this patch needs a better way to decide that it's running on a Raspberry Pi than "the rpi video driver is also built into this copy of SDL." This is trivial, I assume, but I don't know a good preprocessor check at the moment.
&gt; 
&gt; Further work after that: the 2D render API needs to default to GLES2 on this platform; GLES1 and desktop OpenGL will all work but they are slower, and right now SDL picks desktop OpenGL.
&gt; 
&gt; --ryan.

On 2020-05-11 16:16:26 +0000, Cameron Gutman wrote:

&gt; I found that --enable-video-kmsdrm --disable-video-rpi results in working video on the Raspberry Pi 4 using KMSDRM, so that's what I've been using.
&gt; 
&gt; It was several months ago that I debugged this, but if I remember correctly, SDL_egl.c picks different GL libraries if SDL_VIDEO_DRIVER_RPI is specified at build.

On 2020-10-09 23:59:18 +0000, Sam Lantinga wrote:

&gt; Manuel, is this something that you can look at?

On 2020-10-10 14:13:54 +0000, Manuel Alfayate Corchete wrote:

&gt; @Sam Lantiga: Yes, but I believe dispmanx is more or less deprecated now, so maybe removing the specific Raspberry Pi support would be the easiest way to avoid this problem. All Pis should be using KMSDRM by now, not dispmanx anymore.
&gt; What do you think?</span></p>
</div>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
<p>And welcome to the forum!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>I did run it from a terminal, albeit one loaded through the desktop. Do you mean running it from a terminal without X loaded at all?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">SirNate0</div>
          <div class="post_content">
<p>Yes, without X loaded at all. But again, this may not be the cause of the problem at all. It’s just my recollection of how it worked several years ago.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Yes. Like what Sirnate0 said, Urho3D Pi port doesn’t required X at all. Last time I had my Pi configured to use text mode on boot, but I think just for testing you can just boot with single-user-mode or kill X before executing the binary. Having said that, even when X still runs in the background, it should not stop the app from initializing. It will just suck the computing juice from the Pi for nothing. What I think that can fail the initialization is the newer Raspbian switched from VC graphic driver to a standard driver. I cannot recall the exact specific now, so take it with some salt. I also recall I/we have done something about it in the master branch to deal with it. The new code in the master may not be well tested yet. I was waiting for my new Pi 4 at the time and when the thing finally arrived, it just collecting dust in my study as I have moved on to other thing. Are you using master branch BTW?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Yes, master branch</p>
<p>If I boot into CLI I get a different error:</p>
<p>ERROR: Failed to initialize SDL subsystem: No available video device</p>
<p>And before you ask, yes I have a monitor connected via HDMI <img alt=":wink:" class="emoji" src="../../../images2/537e3e653d641df5b9858e75faf3862a.png" title=":wink:"/></p>
<p>Apologies if I’m missing basic things here. Is it an SDL config issue? I hadn’t even heard of SDL until yesterday but if that’s the issue happy to research it myself. But it would be good to know if I’m even on the right track.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>How did you build your engine from source? Show us your exact build config that you pass to CMake during the initial configuration phase.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>I used the cmake_generic shell script with -DURHO3D_SAMPLES=1</p>
<p>After you asked that, I went back to the script folder and realized there’s also a cmakr_rpi script. I just ran a build with that script and now I get a new error …</p>
<p>Can’t find a way to dump the error to a file so here’s a photo.</p>
<p><div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="IMG_0537"><img alt="IMG_0537" data-base62-sha1="yfDf2VxK7V8Lv8IJOsHKPnvXkPr"  height="145" src="../../../images2/6cd6e2d58059c03629a73932ed35873c.jpeg"  width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename">IMG_0537</span><span class="informations">3867×813 495 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Did you pass anything else when you invoke the <code>cmake_rpi.sh</code>? Any build options or build config that you use? It is also not clear to me whether you were building on the Pi itself or you use a cross-compiling toolchain. The options to pass may be slightly different between these two approaches. You may try to pass “-D RPI_ABI=RPI4” and/or “-D URHO3D_64BIT=1” if you have 64 bit Raspbian on your Pi4, for example.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>No, didn’t pass anything else. I’m building directly on the pi, with a fresh install of 32 bit Raspberry Pi OS. For libs I used:</p>
<p>libxrandr-dev<br/>
libasound2-dev<br/>
libgles2-mesa-dev</p>
<p>The command is just</p>
<p>./cmake_rpi.sh ~/urho -DURHO3D_SAMPLES=1</p>
<p>I’ll try “-D RPI_ABI=RPI4” see if it helps</p>
<p>thanks for the responses</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Aha! That flag fixed it.</p>
<p>Thanks for the help!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Ok, so it works from X. But when I run from cli, I still get<br/>
“Could not create window, root cause: ‘No available video device’”</p>
<p>So close <img alt=":woozy_face:" class="emoji" src="../../../images2/e17b7d10292e739e50d7345e1965ba84.png" title=":woozy_face:"/></p>
<p>This time my make command was simply:<br/>
./cmake_generic.sh ~/urho1-D RPI_ABI=RPI4</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Glad to hear that. Without X then the game engine supposes to use the SDL support for KMS/DRM. Unfortunately, that’s the part where I said earlier it may not be well tested yet. There are also many improvements made in the upstream SDL regarding KMS/DRM that haven’t got merged yet in our subtree. Anyway, if I were you I would check the CMake cache to see if KMS/DRM support is enabled in your build. If it did then try to export an env-var to tell SDL subsystem to use it as the video driver instead of the default X11 video driver from SDL. I cannot remember the specific variable name at the moment. It should starts with “SDL_”. You are ahead of me now in this regards. So take what I have just said with a grain of salt.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Gotcha</p>
<p>Thanks for the tips, I’ll see what I can figure out.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3208_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tvault</div>
          <div class="post_content">
<p>I run Urho3D on the Pi 4, I used the master branch, created a build folder and ran cmake, within<br/>
the build folder and that’s all I did, I didn’t use the build scripts.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3208_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tvault</div>
          <div class="post_content">
<p>This is what I get:<br/>
<div class="lightbox-wrapper"><a class="lightbox"   rel="noopener nofollow ugc" title="Screenshot from 2021-06-13 14-13-10"><img alt="Screenshot from 2021-06-13 14-13-10" data-base62-sha1="7ZsSDobHWM6lroR3GQAM6e0K5C1"  height="430" src="../../../images2/0fd6f058440d171616aa3fb60e032b18.png"  width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename">Screenshot from 2021-06-13 14-13-10</span><span class="informations">858×535 71.4 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/259_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Pencheff</div>
          <div class="post_content">
<p>This looks completely fine.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>And the engine runs fine for you?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3208_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tvault</div>
          <div class="post_content">
<p>I can run the examples from both desktop and the terminal. I seem to have an issue running the UrhoPlayer with the ninja demo, i get a segmentation fault although it works fine on the pi 3.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>If you don’t pass any option and build from the Pi itself then it is likely (although I am not 100% sure anymore without double checking the script) that it will just target RPI3. Only when the build system finds a 64bit system then it will be sure to set the target to RPI4. Replying using my iPhone and just based on my recollection. But you can always use the CMakeCache to find out what is being set by default.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Interesting that it works for you, I tried building with your method and still get the SDL errors. I can only assume it’s some kind of dependency issue in that case. Can I ask if you’re using Raspian / Rapsian lite / something else? Did you build SDL from source?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3208_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tvault</div>
          <div class="post_content">
<p>I’m using Raspbian Buster.</p>
<p>I only use the dependencies provided by Urho.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>Then I am flummoxed  <img alt=":woozy_face:" class="emoji" src="../../../images2/e17b7d10292e739e50d7345e1965ba84.png" title=":woozy_face:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3208_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">tvault</div>
          <div class="post_content">
<p>I’m not sure if it will work but have you tried installing libsdl2-dev , I remember installing SDL this way for something else.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>Urho3D project contains all the 3rd party libraries that it uses, including SDL. By installing SDL-dev what it may help to solve is by doing so then the system package manager  also installs all the other dependencies package into the system. At the time you built Urho3D from source then it has most, if not all, of its build requirements already fulfilled. The legacy online documentation actually has a section for describing this build prerequisite. Have a look on the docs.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">arcadeperfect</div>
          <div class="post_content">
<p>I did read through the docs and was going off this page:</p>
<aside class="onebox allowlistedgeneric">
<header class="source">
<a href="https://urho3d.io/documentation/1.7/_building.html" rel="noopener nofollow ugc" target="_blank">Urho3D</a>
</header>
<article class="onebox-body">
<h3><a href="https://urho3d.io/documentation/1.7/_building.html" rel="noopener nofollow ugc" target="_blank">Building Urho3D library</a></h3>
<p>Urho3D is a free lightweight, cross-platform 2D and 3D game engine implemented in C++ and released under the MIT license. Greatly inspired by OGRE and Horde3D.</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
<p>Going by that it will build, although I do have to install one extra thing. I think it’s libgles2-mesa-dev</p>
<p>I was curious about building SDL from source after looking into your suggestion with the SDL_VIDEODRIVER env var, bc after googling the correct syntax to set that to KMS/DRM I found an example where someone set a flag during build of SDL to enable it and override X. (simply setting the var as is just leads to Urho saying that KMSDRM is not available, assuming I got the var right)</p>
<p>But no matter how I install SDL, be it from source, Urho, through apt-get or a tar ball of a pre-built bin, I always get the same error about “No available video device”.</p>
<p>I must confess I’m at the limits of my skill here, but my next step is to compile some example C code for SDL and see if that works at all.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>