<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>TurboBadger full integration</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">TurboBadger full integration</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I had another thread posted in “dev talk” section because there were some issues that I needed to resolve, but it’s all fixed now.</p>
<p>edit final: new repository created <a data-bbcode="true" href="https://github.com/Lumak/Urho3D-1.4-TurboBadger">https://github.com/Lumak/Urho3D-1.4-TurboBadger</a></p>
<hr/>
<h2>Features</h2>
<ul>
<li>no unique shader required</li>
<li>no unique render path required</li>
<li>no unique graphics settings required</li>
<li>uses Urho3D’s default UIBatch render process</li>
<li>delivers TurboBadger’s batch data in its format, so it pumps data as fast as Turbo Badger can send them</li>
</ul>
<hr/>
<p>Image (Turbo Badger demo shown in Urho3D):<br/>
<div class="lightbox-wrapper"><a class="lightbox" href="http://i.imgur.com/gA2z5qi.jpg?1" title=""><img alt="" height="383" src="../../../images2/62a92e88cdcfe5df034be286a93bc539.jpg" width="690"/><div class="meta"><svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">900×500</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I just been informed that this code is not compatible with the latest Urhod3D master branch, as reported by Hevedy:</p>
<aside class="quote">
<blockquote>
<p>Added the line 65 add_sample_subdirectory (54_TurboBadger) in Source/Samples/CMakeLists.txt to include the sample.<br/>
*Added the line 108 add_subdirectory (ThirdParty/TurboBadger) in Source/CMakeLists.txt to include the TurboBadger lib.</p>
<p>This are errors: ?<br/>
The line UIDrag.h 40 should be URHO3D_OBJECT( UIDrag ); and no OBJECT( UIDrag ); ?<br/>
The line TBWrapper.h 51 should be URHO3D_OBJECT( TUIRendererBatcher ); and no OBJECT( TUIRendererBatcher ) ?<br/>
HANDLER to URHO3D_HANDLER</p>
<p>Anyway after change that i got 6 errors<br/>
Error 8 error C2208: ‘Urho3D::Application’ : no members defined using this type 54_turbobadger\UIDrag.h 40 1 54_TurboBadger<br/>
Error 3 error C1903: unable to recover from previous error(s); stopping compilation 54_turbobadger\TBWrapper.h 51 1 54_TurboBadger</p>
<p>*I using the master version but with the 1.4 adding only that changes to the CMakeList.txt give me too errors with the generated files.</p>
<p>41&gt;Urho3D-1.4\Build\bin\54_TurboBadger.exe : fatal error LNK1120: 195 unresolved externals</p>
</blockquote>
</aside>
<p>I’m still on 1.4 and will not be merging with the master branch anytime soon. I hope there are others who can help him with his build errors. I’ll try to help him with 1.4 linking problem.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>I think it might be a good idea to wait for the 1.5 release before adopting to the changes.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>added a download link to the integration, including tb and its data.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>Why not make a public repository?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>I don’t see any reason why I should create a repository for this.  I don’t see anyone interest in this judging by the number of comments on this thread (only you commented about waiting), so I’m just going to provide a public downloadable link.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">thebluefish</div>
          <div class="post_content">
<p>A repo takes a minute to setup and makes it so much easier to look at the code. Even if there aren’t any comments to “show interest”, it doesn’t mean that people will be any less interested in your work. For example, a libGDX demo that I created and posted on the site only got a few comments, but has racked up well over 20k downloads.</p>
<p>Github (or really any public source control host) is a great place to keep a portfolio of your work if you plan on applying to developer positions.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2369_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Dave82</div>
          <div class="post_content">
<aside class="quote no-group" data-username="Lumak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/b3b294bc4454bf21e07a40d7aa09761d.png" width="20"/> Lumak:</div>
<blockquote>
<p>I don’t see any reason why I should create a repository for this.  I don’t see anyone interest in this judging by the number of comments on this thread (only you commented about waiting), so I’m just going to provide a public downloadable link.</p>
</blockquote>
</aside>
<p>I’ll comment <img alt=":smiley:" class="emoji" src="../../../images2/7014497b1c97c810791a011290bda7f5.png" title=":smiley:"/> You did an awesome work ! I can’t see the reason why devs won’t implement this as an official subsystem ? Looks professional , there are way more widgets , and could boost the editor’s appereance and it would attract more users.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/55_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">rasteron</div>
          <div class="post_content">
<p>Count me in! I would agree on this as well. <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/> It is another good UI framework option and setting up a repo where you can improve and fully integrate it is a big plus! I’m also thinking of using this as an alternative to Qt, due to its hefty payload.</p>
<p>Btw, thanks again for the download links and assistance Lumak! <img alt=":smiley:" class="emoji" src="../../../images2/c16ddadcbd525aa6d219a1df596d362f.png" title=":smiley:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/88_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">jenge</div>
          <div class="post_content">
<p>In terms of “higher end” editor, one thing TurboBadger needs is support for multiple top level windows.  Being able to drag windows in and out of tabs would also be huge.  Urho would also have to support multiple top level windows (probably with styling, as default style isn’t good for a an editor window like this)</p>
<ul>
<li>Josh</li>
</ul>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/348_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Bluemoon</div>
          <div class="post_content">
<aside class="quote no-group" data-username="Lumak">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/b3b294bc4454bf21e07a40d7aa09761d.png" width="20"/> Lumak:</div>
<blockquote>
<p>I don’t see any reason why I should create a repository for this.  I don’t see anyone interest in this judging by the number of comments on this thread (only you commented about waiting), so I’m just going to provide a public downloadable link.</p>
</blockquote>
</aside>
<p>Trying to figure out the interest of people through the comments here might be really misleading… Believe me, I spent a considerable amount of my time last month (January 2016) trying to implement Turbo Badger as a stand alone library to Urho3D and guess what? I achieved it using your Urho3D_TurboBadger implementation, the exact same one you pulled from github. I had a local copy of the last snapshot and was looking for the best time to tinker with it.<br/>
When I realized that jenge and the folks at Atomic Game Engine (which bred from Urho3D) had Turbo Badger Integrated, I was more than motivated to give it a shot.</p>
<p>I’ve only tested this on Windows Machine, OpenGL build was great, D3D9 was good but D3D11 had a bit of rendering issues (and I’m not really good at all those graphic pipeline stuffs <img alt=":unamused:" class="emoji" src="../../../images2/2af753f2483bb40ec48872793c2e1855.png" title=":unamused:"/>  ) What consumed a vast portion of my time and mental energy was how to integrate TB as part of other Third Party library and how its interface would be wrapped and exposed for use in Urho3D. Is it going to replace the existing UI system or will it be part of custom UI structure that would be implemented in Urho3D?</p>
<p>So… Quite a lot of people are interested in this project, even though some of us are yet to comment <img alt=":wink:" class="emoji" src="../../../images2/58bcd684421190f24be1944e2a997a04.png" title=":wink:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>I definitely want an external TurboBadger integration that doesn’t modify Urho3D, so there’s no need for a fork to maintain.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<aside class="quote no-group" data-username="thebluefish">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/bf1ad5330f9831ec6d82214e91751e5d.png" width="20"/> thebluefish:</div>
<blockquote>
<p>A repo takes a minute to setup and makes it so much easier to look at the code. Even if there aren’t any comments to “show interest”, it doesn’t mean that people will be any less interested in your work. For example, a libGDX demo that I created and posted on the site only got a few comments, but has racked up well over 20k downloads.</p>
</blockquote>
</aside>
<p>Nice, if only we can do so well with games that we create.</p>
<aside class="quote no-group" data-username="Dave82">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/39fd1aeff01d89e7279fa956666af00e.png" width="20"/> Dave82:</div>
<blockquote>
<p>I’ll comment <img alt=":smiley:" class="emoji" src="../../../images2/7014497b1c97c810791a011290bda7f5.png" title=":smiley:"/> You did an awesome work ! I can’t see the reason why devs won’t implement this as an official subsystem ? Looks professional , there are way more widgets , and could boost the editor’s appereance and it would attract more users.</p>
</blockquote>
</aside>
<p>Thank you. TurboBadger does have nice UI graphics.</p>
<aside class="quote no-group" data-username="rasteron">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/fd8529e5abecd6bdd1f8770e66ee2bab.png" width="20"/> rasteron:</div>
<blockquote>
<p>Count me in! I would agree on this as well. <img alt=":slight_smile:" class="emoji" src="../../../images2/480f97b912eb537e18032299081e582a.png" title=":slight_smile:"/> It is another good UI framework option and setting up a repo where you can improve and fully integrate it is a big plus! I’m also thinking of using this as an alternative to Qt, due to its hefty payload.<br/>
Btw, thanks again for the download links and assistance Lumak! <img alt=":smiley:" class="emoji" src="../../../images2/7014497b1c97c810791a011290bda7f5.png" title=":smiley:"/></p>
</blockquote>
</aside>
<p>Yeah Qt is also LGPL, and you’re welcome.</p>
<aside class="quote no-group" data-username="jenge">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/ccdeeb34ae6cb9672f51b41c28f5e07b.png" width="20"/> jenge:</div>
<blockquote>
<p>In terms of “higher end” editor, one thing TurboBadger needs is support for multiple top level windows. Being able to drag windows in and out of tabs would also be huge. Urho would also have to support multiple top level windows (probably with styling, as default style isn’t good for a an editor window like this)</p>
</blockquote>
</aside>
<p>I haven’t look into creating an editor, but I agree that having multiple top level windows in any editor would be beneficial.</p>
<aside class="quote no-group" data-username="Bluemoon">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/8778d5ed327752ae49ac8b54181440f8.png" width="20"/> Bluemoon:</div>
<blockquote>
<p>Trying to figure out the interest of people through the comments here might be really misleading… Believe me, I spent a considerable amount of my time last month (January 2016) trying to implement Turbo Badger as a stand alone library to Urho3D and guess what? I achieved it using your Urho3D_TurboBadger implementation, the exact same one you pulled from github. I had a local copy of the last snapshot and was looking for the best time to tinker with it.<br/>
When I realized that jenge and the folks at Atomic Game Engine (which bred from Urho3D) had Turbo Badger Integrated, I was more than motivated to give it a shot.</p>
<p>I’ve only tested this on Windows Machine, OpenGL build was great, D3D9 was good but D3D11 had a bit of rendering issues (and I’m not really good at all those graphic pipeline stuffs <img alt=":unamused:" class="emoji" src="../../../images2/2af753f2483bb40ec48872793c2e1855.png" title=":unamused:"/> ) What consumed a vast portion of my time and mental energy was how to integrate TB as part of other Third Party library and how its interface would be wrapped and exposed for use in Urho3D. Is it going to replace the existing UI system or will it be part of custom UI structure that would be implemented in Urho3D?</p>
<p>So… Quite a lot of people are interested in this project, even though some of us are yet to comment <img alt=":wink:" class="emoji" src="../../../images2/58bcd684421190f24be1944e2a997a04.png" title=":wink:"/></p>
</blockquote>
</aside>
<p>It’s great to hear that someone is making use of my repository from last year. I haven’t built D3D11 yet to see what’s going on with that, but I’ll attempt to build it and see sometime this week.</p>
<aside class="quote no-group" data-username="Enhex">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/2c165096ad375255e0c52a6a81137cd8.png" width="20"/> Enhex:</div>
<blockquote>
<p>I definitely want an external TurboBadger integration that doesn’t modify Urho3D, so there’s no need for a fork to maintain.</p>
</blockquote>
</aside>
<p>The Urho3D-1.4-TurboBadger repository will be a standalone integration to an app, and not integrated with Urho3D lib.  It’s good to hear comments like this so I can save myself the work trying to do the opposite.</p>
<p><span class="bbcode-b">[size=150]New Repository Created[/size]</span><br/>
Just because you asked - link <a data-bbcode="true" href="https://github.com/Lumak/Urho3D-1.4-TurboBadger" rel="noopener nofollow ugc">https://github.com/Lumak/Urho3D-1.4-TurboBadger</a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2367_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">jmiller</div>
          <div class="post_content">
<p>Nice work on the implementation. <img alt=":slight_smile:" class="emoji" src="../../../images2/ab33f6c546ca85e7d84a4e3c32cd4034.png" title=":slight_smile:"/></p>
<aside class="quote">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/2a544a080a692659db243ae9ac8c57ef.png" width="20"/> Enhex:</div>
<blockquote>
<p>I definitely want an external TurboBadger integration that doesn’t modify Urho3D, so there’s no need for a fork to maintain.</p>
</blockquote>
</aside>
<p>I think the Urho-TurboBadger integration posted by <span class="bbcode-b">thebluefish</span> also fits this bill.<br/>
<a href="http://discourse.urho3d.io/t/turbo-badger-implementation/1364/1">topic1413.html</a><br/>
I migrated over half a year ago and only looked forward, aside from some work in the shared linking department.  :mrgreen:</p>
<p>Re. multi-windows… others are more knowledgeable on this, but TB does have multiple internal windows (enough for me, in an editor), drop support, and is rather flexible in general.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">George</div>
          <div class="post_content">
<p>Hi,<br/>
This is great stuff.<br/>
I hope you have time to port this to the Urho trunk  version.</p>
<p>Best regards,</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">George</div>
          <div class="post_content">
<p>Ignore my previous message.<br/>
I got it to work in 1.5.</p>
<p>Just change these to new Urho3d name convention.</p>
<pre><code class="lang-auto">class UTBRendererBatcher : public UIElement, public TBRendererBatcher
{
	URHO3D_OBJECT( UTBRendererBatcher, UIElement)
...}



URHO3D_EVENT(E_TBMSG, TBMessageNamespace)
{
	URHO3D_PARAM(P_TBWIDGET, Widget);  // TBWidget pointer
}


//=============================================================================
//=============================================================================
class UTBListener : public Object, public TBWidgetListener
{
	URHO3D_OBJECT(UTBListener, Object);
public:
	UTBListener(Context *context);

	~UTBListener();

	void CreateMsgWindow();
	virtual void OnWidgetRemove(TBWidget *parent, TBWidget *child);
	virtual bool OnWidgetInvokeEvent(TBWidget *widget, const TBWidgetEvent &amp;ev);

	TBWidget* GetTBMessageWidget()
	{
		return (TBWidget*)pTBMessageWindow_;
	}
protected:
	void SendEventMsg();

protected:
	TBMessageWindow     *pTBMessageWindow_;

};



	// create TB render batcher
	Graphics *graphics = GetSubsystem&lt;Graphics&gt;();
	UTBRendererBatcher::Create(GetContext(), graphics-&gt;GetWidth(), graphics-&gt;GetHeight());
	UTBRendererBatcher::Singleton().Init("Data/TB/");

	// create a msg win
	pTBListener_ = new UTBListener(GetContext());
	pTBListener_-&gt;CreateMsgWindow();

	SubscribeToEvent(E_TBMSG, URHO3D_HANDLER(NVuDuMain, HandleTBMessage));

</code></pre>
<p>How to make it interact with Urho object?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>Pull request or let lumark add it to the repository, which should also remove the urho version number from the name, from “Urho3D-1.4-TurboBadger”, to “Urho3D-TurboBadger”.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">George</div>
          <div class="post_content">
<p>I think Lumak can update it. As it is easy for him to add changes to the code.</p>
<p>One more thing for those who want to see their game object. Just comment out the below line inside the UTBRendererBatcher.cpp</p>
<p>//  root_.SetSkinBg(TBIDC(“background”));</p>
<p>Cheers</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">christianclavet</div>
          <div class="post_content">
<p>Hi. I’ve tried to build it using cmake, but got some error (I’m not familiar with CMAKE, only used it to build URHO so far).</p>
<p>[quote]New Repository Created<br/>
Just because you asked - link <a href="https://github.com/Lumak/Urho3D-1.4-TurboBadger" rel="nofollow noopener">github.com/Lumak/Urho3D-1.4-TurboBadger</a>[/quote]<br/>
I extracted the archive then tried to build it with cmake… Here the result:</p>
<p>[code]C:\Users\Christian\Desktop\Urho3D-1.4-TurboBadger-master\Source\ThirdParty\TurboBadger&gt;cmake_codelite …/turbo<br/>
– The C compiler identification is GNU 5.1.0<br/>
– The CXX compiler identification is GNU 5.1.0<br/>
– Check for working C compiler: C:/TDM-GCC-64/bin/gcc.exe<br/>
– Check for working C compiler: C:/TDM-GCC-64/bin/gcc.exe – works<br/>
– Detecting C compiler ABI info<br/>
– Detecting C compiler ABI info - done<br/>
– Detecting C compile features<br/>
– Detecting C compile features - done<br/>
– Check for working CXX compiler: C:/TDM-GCC-64/bin/g++.exe<br/>
– Check for working CXX compiler: C:/TDM-GCC-64/bin/g++.exe – works<br/>
– Detecting CXX compiler ABI info<br/>
– Detecting CXX compiler ABI info - done<br/>
– Detecting CXX compile features<br/>
– Detecting CXX compile features - done<br/>
CMake Error at CMakeLists.txt:36 (setup_library):<br/>
Unknown CMake command “setup_library”.</p>
<p>CMake Warning (dev) in CMakeLists.txt:<br/>
No cmake_minimum_required command is present.  A line of code such as</p>
<pre><code>cmake_minimum_required(VERSION 3.4)
</code></pre>
<p>should be added at the top of the file.  The version specified may be lower<br/>
if you wish to support older CMake versions for this project.  For more<br/>
information run “cmake --help-policy CMP0000”.<br/>
This warning is for project developers.  Use -Wno-dev to suppress it.</p>
<p>– Configuring incomplete, errors occurred!<br/>
See also “C:/Users/Christian/Desktop/Urho3D-1.4-TurboBadger-master/Source/ThirdParty/turbo/CMakeFiles/CMakeOutput.log”.[/code]</p>
<p><span class="bbcode-b">EDIT:</span> Ok seen more of the structure of your files. This need to be added to the files of URHO and modify the makefiles so URHO add the new sub-directories to the build. I will have to download 1.4 to really test this, but understand more a little about CMAKE now. I would really like to have this in URHO3D as an option that could be activated. (Same for IMGUI), both GUI have their use and your worked to integrate them in URHO. Having a way to activate them in the build via cmake flag would be really nice.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<aside class="quote">
<blockquote>
<p>EDIT: Ok seen more of the structure of your files. This need to be added to the files of URHO and modify the makefiles so URHO add the new sub-directories to the build. I will have to download 1.4 to really test this, but understand more a little about CMAKE now. I would really like to have this in URHO3D as an option that could be activated. (Same for IMGUI), both GUI have their use and your worked to integrate them in URHO. Having a way to activate them in the build via cmake flag would be really nice.</p>
</blockquote>
</aside>
<p>Yes, all of my code exchanges are built as a sample in the sample folder.  Good to see that you figured it out.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">christianclavet</div>
          <div class="post_content">
<p>Hi, Downloaded 1.4 and added your files, it compile but fail at turbobadger because I think it require c++11 support and I don’t think the compiler I’m using (Windows 10, TDM-GCC5.1 64bit, Codelite) support it.<br/>
TDM-GCC should be the latest build for GNU GCC available for windows. (I think it’s based on MINGW64)</p>
<p>It all seem to fail when compiling theses directives (nullptr): From google, this seem that my toolchain doesnt support c++11 (If the C++11 is active in CMAKE for Urho1.5 it fail the generation). Is there a way to make it work, like replacing with NULL instead? All the errors seem to point at this nullptr use.</p>
<p><code>In file included from C:\Users\Public\Projets\URHO\Urho3D-1.4\Source\ThirdParty\TurboBadger\tb_addon.h:10:0,
                 from C:\Users\Public\Projets\URHO\Urho3D-1.4\Source\ThirdParty\TurboBadger\tb_addon.cpp:7:
C:\Users\Public\Projets\URHO\Urho3D-1.4\Source\ThirdParty\TurboBadger\tb_widgets.h: At global scope:
C:\Users\Public\Projets\URHO\Urho3D-1.4\Source\ThirdParty\TurboBadger\tb_widgets.h:583:60: error: 'nullptr' was not declared in this scope
  TBWidget *GetNextDeep(const TBWidget *bounding_ancestor = nullptr) const;</code><br/>
<span class="bbcode-b">EDIT: </span>Done replacement of “nullptr” to “NULL” all over the files of turbobadger and it now compile and build. But the example 54_Turbobadger.exe doesnt show any GUI exept the URHO ones.<br/>
EDIT2: Put back the source as they were. Then set the CMAKELIST.TXT of the source to specifically set the compiler to use the c++11 features (Mingw64 support it but need to be specified). No errors in compilation, linking. But still only a black window with the URHO3D logo.</p>
<p>Here is the code I added to the CMAKELIST to specifically set the compiler to use c++11 feature (from google)</p>
<p><code>include(CheckCXXCompilerFlag)
CHECK_CXX_COMPILER_FLAG("-std=c++11" COMPILER_SUPPORTS_CXX11)
CHECK_CXX_COMPILER_FLAG("-std=c++0x" COMPILER_SUPPORTS_CXX0X)
if(COMPILER_SUPPORTS_CXX11)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
elseif(COMPILER_SUPPORTS_CXX0X)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
else()
        message(STATUS "The compiler ${CMAKE_CXX_COMPILER} has no C++11 support. Please use a different C++ compiler.")
endif()</code></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>[quote=“christianclavet”]<br/>
<span class="bbcode-b">EDIT: </span>Done replacement of “nullptr” to “NULL” all over the files of turbobadger and it now compile and build. But the example 54_Turbobadger.exe doesnt show any GUI exept the URHO ones.[/quote]</p>
<p>You don’t see any gui except for the urho ones? That’s odd because there is no urho gui in that example.  They’re all TB gui.</p>
<p>Perhaps you can try skipping the “hello world” intro in the Start() func. and jump right into the TB demo:</p>
<pre><code class="lang-auto">void UIDrag::Start()
{
    // Execute base class startup
    Sample::Start();

    // Set mouse visible
    //String platform = GetPlatform();
    //if (platform != "Android" &amp;&amp; platform != "iOS")
    GetSubsystem&lt;Input&gt;()-&gt;SetMouseVisible(true);

    // create TB render batcher
    Graphics *graphics = GetSubsystem&lt;Graphics&gt;();
    UTBRendererBatcher::Create( GetContext(), graphics-&gt;GetWidth(), graphics-&gt;GetHeight() );
    UTBRendererBatcher::Singleton().Init( "Data/TB/" );
    
    // create a msg win
    //pTBListener_ = new UTBListener( GetContext() );
    //pTBListener_-&gt;CreateMsgWindow();

    //SubscribeToEvent(E_TBMSG, HANDLER(UIDrag, HandleTBMessage));

    // skip to tb demo
    TBDemo::Init();
}
</code></pre>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>You did copy “bin\Data\TB” folder to your build folder?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">christianclavet</div>
          <div class="post_content">
<p>Hi,</p>
<p>I had packed resources. I had put them in the source files. Removed the archives and copied the folders instead. I see everything now. Do I have to tell something in the makefile to put them in the pak files?<br/>
Thanks a lot for helping me! I see the gui now!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>[quote=“christianclavet”]Hi,</p>
<p>I had packed resources. I had put them in the source files. Removed the archives and copied the folders instead. I see everything now. Do I have to tell something in the makefile to put them in the pak files?<br/>
Thanks a lot for helping me! I see the gui now![/quote]</p>
<p>I don’t usually work with pak files unless it’s something that I create specifically to protect data content/save file.  I’m not sure how the pak files are auto generated on platforms other than Android – auto built from Android Studio for me.  So, I’m no help.</p>
<p>It’s good to hear you got it working!  And, I didn’t do much, just watched your progress onto getting it working  <img alt=":wink:" class="emoji" src="../../../images2/95940790c23d98635b2a6d3f22657158.png" title=":wink:"/></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">christianclavet</div>
          <div class="post_content">
<p>Thanks Lumak!</p>
<p>I’ve done a search of all the makefiles that URHO uses to see how it creating the .PAK archives. It use a folder and put the files recursively into an archive.<br/>
I’ve done it manually via the pakage tool and from the output of the console the resources were packed in the .pak files with the rest. So I checked the sources files of the demo and I think TurboBadger is using it’s own file system to load the ressources.</p>
<p><span class="bbcode-b">From TBDEMO.cpp</span>[code]void ResourceEditWindow::Load(const char *resource_file)<br/>
{<br/>
m_resource_filename.Set(resource_file);<br/>
SetText(resource_file);</p>
<pre><code>// Set the text of the source view
m_source_edit-&gt;SetText("");

if (TBFile *file = TBFile::Open(m_resource_filename, TBFile::MODE_READ))
{
	TBTempBuffer buffer;
	if (buffer.Reserve(file-&gt;Size()))
	{
		uint32 size_read = file-&gt;Read(buffer.GetData(), 1, buffer.GetCapacity());
		m_source_edit-&gt;SetText(buffer.GetData(), size_read);
	}
	delete file;
}
else // Error, show message
{
	TBStr text;
	text.SetFormatted("Could not load file %s", resource_file);
	if (TBMessageWindow *msg_win = new TBMessageWindow(GetParentRoot(), TBIDC("")))
		msg_win-&gt;Show("Error loading resource", text);
}

RefreshFromSource();
</code></pre>
<p>}[/code]</p>
<p>It is probably not using the file system mechanism from URHO. That explain why I had a black window with only the URHO logo. (This will happen if it fail to load the resources). I don’t know if this could be fixed to use URHO to load the files and convert it in a TBFILE pointer…</p>
<p>If this would mean modifying the Turbobadger source files (not the demo), I don’t think it would be worth it, since somebody would have to maintain it at each revision… Perhaps warn if URHO_PACKAGING is active that the UI resources need to be in a folder not into an archive (Would this create problems with other platforms like IOS, Android and Emscriptem?). I mean, if the resources can’t be put in a pak file, would not work on these platforms?</p>
<p>Or there a way to make this completely external?</p>
<p>This seem to work fine here on Windows and Linux Mint (using codelite on both). And for me it’s what I need.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">George</div>
          <div class="post_content">
<p>Hi christianclavet</p>
<p>Read my post on this thread to get it to run on Urho 1.5.</p>
<p>Regards</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">christianclavet</div>
          <div class="post_content">
<p>HI, George.</p>
<p>When I saw it first I was not understanding. I checked the source again and saw a difference:</p>
<p><code>class UTBRendererBatcher : public UIElement, public TBRendererBatcher
{
    OBJECT( UTBRendererBatcher )</code></p>
<p>Would be something like this:</p>
<p><code>class UTBRendererBatcher : public UIElement, public TBRendererBatcher
{
    URHO3D_OBJECT( UTBRendererBatcher )</code></p>
<p>I’ll try it and report.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">christianclavet</div>
          <div class="post_content">
<p>Hi. Sorry to double post. You were right, it worked. I decided to load the last version of Urho directly from GITHUB (03/20/16) and try to build it with it. There are new keywords that have been changed since with the URHO3D_ prefix.</p>
<p>For using this with URHO 1.5 (last revision) you will have to replace 4 files from the example folder (54_Turbobadger folder)(this only affect the demo source, the source for TurboBadger I had is unchanged).</p>
<p>First file: <span class="bbcode-b">UIDRAG.H</span></p>
<p>[code]//<br/>
// Copyright © 2008-2015 the Urho3D project.<br/>
//<br/>
// Permission is hereby granted, free of charge, to any person obtaining a copy<br/>
// of this software and associated documentation files (the “Software”), to deal<br/>
// in the Software without restriction, including without limitation the rights<br/>
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br/>
// copies of the Software, and to permit persons to whom the Software is<br/>
// furnished to do so, subject to the following conditions:<br/>
//<br/>
// The above copyright notice and this permission notice shall be included in<br/>
// all copies or substantial portions of the Software.<br/>
//<br/>
// THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br/>
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br/>
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br/>
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br/>
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br/>
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br/>
// THE SOFTWARE.<br/>
//</p>
<p><span class="hashtag">#pragma</span> once</p>
<p><span class="hashtag">#include</span> &lt;Urho3D/Core/Object.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_widgets_listener.h&gt;</p>
<p><span class="hashtag">#include</span> “Sample.h”</p>
<p>namespace Urho3D<br/>
{<br/>
class Node;<br/>
class Scene;<br/>
}</p>
<p>namespace tb<br/>
{<br/>
class TBMessageWindow;<br/>
}</p>
<p>using namespace Urho3D;<br/>
using namespace tb;</p>
<p>//=====================================<br/>
URHO3D_EVENT(E_TBMSG, TBMessageNamespace)<br/>
{<br/>
URHO3D_PARAM(P_TBWIDGET, Widget);  // TBWidget pointer<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
class UTBListener : public Object, public TBWidgetListener<br/>
{<br/>
URHO3D_OBJECT(UTBListener, Object);<br/>
public:<br/>
UTBListener(Context *context);</p>
<pre><code>~UTBListener();

void CreateMsgWindow();
virtual void OnWidgetRemove(TBWidget *parent, TBWidget *child);
virtual bool OnWidgetInvokeEvent(TBWidget *widget, const TBWidgetEvent &amp;ev);

TBWidget* GetTBMessageWidget()
{
    return (TBWidget*)pTBMessageWindow_;
}
</code></pre>
<p>protected:<br/>
void SendEventMsg();</p>
<p>protected:<br/>
TBMessageWindow     *pTBMessageWindow_;</p>
<p>};</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
/// GUI test example.<br/>
/// This sample demonstrates:<br/>
///     - Creating GUI elements from C++<br/>
///     - Loading GUI Style from xml<br/>
///     - Subscribing to GUI drag events and handling them.<br/>
class UIDrag : public Sample<br/>
{<br/>
URHO3D_OBJECT(UIDrag,Sample);</p>
<p>public:<br/>
/// Construct.<br/>
UIDrag(Context* context);<br/>
~UIDrag();</p>
<pre><code>/// Setup after engine initialization and before running the main loop.
virtual void Setup();
virtual void Start();
virtual void Stop();
</code></pre>
<p>protected:<br/>
void HandleTBMessage(StringHash eventType, VariantMap&amp; eventData);</p>
<pre><code>/// Return XML patch instructions for screen joystick layout for a specific sample app, if any.
virtual String GetScreenJoystickPatchString() const { return
    "&lt;patch&gt;"
    "    &lt;add sel=\"/element/element[./attribute[@name='Name' and @value='Hat0']]\"&gt;"
    "        &lt;attribute name=\"Is Visible\" value=\"false\" /&gt;"
    "    &lt;/add&gt;"
    "&lt;/patch&gt;";
}

UTBListener     *pTBListener_;
</code></pre>
<p>};<br/>
[/code]<br/>
<span class="bbcode-b">UIDRAG.CPP</span></p>
<p>[code]//<br/>
// Copyright © 2008-2015 the Urho3D project.<br/>
//<br/>
// Permission is hereby granted, free of charge, to any person obtaining a copy<br/>
// of this software and associated documentation files (the “Software”), to deal<br/>
// in the Software without restriction, including without limitation the rights<br/>
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br/>
// copies of the Software, and to permit persons to whom the Software is<br/>
// furnished to do so, subject to the following conditions:<br/>
//<br/>
// The above copyright notice and this permission notice shall be included in<br/>
// all copies or substantial portions of the Software.<br/>
//<br/>
// THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br/>
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br/>
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br/>
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br/>
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br/>
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br/>
// THE SOFTWARE.<br/>
//</p>
<p><span class="hashtag">#include</span> &lt;Urho3D/Urho3D.h&gt;</p>
<p><span class="hashtag">#include</span> “UIDrag.h”<br/>
<span class="hashtag">#include</span> “UTBRendererBatcher.h”<br/>
<span class="hashtag">#include</span> “TBDemo.h”</p>
<p><span class="hashtag">#include</span> &lt;Urho3D/DebugNew.h&gt;</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
URHO3D_DEFINE_APPLICATION_MAIN(UIDrag)</p>
<p>//=============================================================================<br/>
//=============================================================================</p>
<p>UIDrag::UIDrag(Context* context) :<br/>
Sample(context), pTBListener_( NULL )<br/>
{<br/>
}</p>
<p>UIDrag::~UIDrag()<br/>
{<br/>
if ( pTBListener_ )<br/>
{<br/>
delete pTBListener_;<br/>
pTBListener_ = NULL;<br/>
}<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UIDrag::Setup()<br/>
{<br/>
// Modify engine startup parameters<br/>
engineParameters_[“WindowTitle”] = GetTypeName();<br/>
engineParameters_[“LogName”]     = GetSubsystem()-&gt;GetAppPreferencesDir(“urho3d”, “logs”) + GetTypeName() + “.log”;<br/>
engineParameters_[“FullScreen”]  = false;<br/>
engineParameters_[“Headless”]    = false;<br/>
engineParameters_[“WindowWidth”] = 1280;<br/>
engineParameters_[“WindowHeight”] = 720;<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UIDrag::Start()<br/>
{<br/>
// Execute base class startup<br/>
Sample::Start();</p>
<pre><code>// Set mouse visible
String platform = GetPlatform();
if (platform != "Android" &amp;&amp; platform != "iOS")
    GetSubsystem&lt;Input&gt;()-&gt;SetMouseVisible(true);

// create TB render batcher
Graphics *graphics = GetSubsystem&lt;Graphics&gt;();
UTBRendererBatcher::Create( GetContext(), graphics-&gt;GetWidth(), graphics-&gt;GetHeight() );
UTBRendererBatcher::Singleton().Init( "Data/TB/" );

// create a msg win
pTBListener_ = new UTBListener( GetContext() );
pTBListener_-&gt;CreateMsgWindow();

SubscribeToEvent(E_TBMSG, URHO3D_HANDLER(UIDrag, HandleTBMessage));
</code></pre>
<p>}</p>
<p>void UIDrag::Stop()<br/>
{<br/>
TBDemo::Destroy();<br/>
UTBRendererBatcher::Destroy();<br/>
Sample::Stop();<br/>
}</p>
<p>void UIDrag::HandleTBMessage(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace TBMessageNamespace;</p>
<pre><code>TBWidget *pTBWidget = (TBWidget*)eventData[P_TBWIDGET].GetVoidPtr();

if ( pTBListener_-&gt;GetTBMessageWidget() == pTBWidget )
{
    TBDemo::Init();
}
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
UTBListener::UTBListener(Context *context)<br/>
: Object(context)<br/>
, pTBMessageWindow_( NULL )<br/>
{<br/>
}</p>
<p>UTBListener::~UTBListener()<br/>
{<br/>
if ( pTBMessageWindow_ )<br/>
{<br/>
pTBMessageWindow_ = NULL;<br/>
}<br/>
}</p>
<p>void UTBListener::CreateMsgWindow()<br/>
{<br/>
TBStr text("\nHellow World from Turbo Badger.\n\nClick OK to get started.");<br/>
pTBMessageWindow_ = new TBMessageWindow( &amp;UTBRendererBatcher::Singleton().Root(), TBIDC("") );<br/>
pTBMessageWindow_-&gt;Show(“Start Message”, text);</p>
<pre><code>TBWidgetListener::AddGlobalListener( this );
</code></pre>
<p>}</p>
<p>void UTBListener::OnWidgetRemove(TBWidget *parent, TBWidget *child)<br/>
{<br/>
if ( pTBMessageWindow_ == child )<br/>
{<br/>
TBWidgetListener::RemoveGlobalListener( this );<br/>
}<br/>
}</p>
<p>bool UTBListener::OnWidgetInvokeEvent(TBWidget *widget, const TBWidgetEvent &amp;ev)<br/>
{<br/>
if ( pTBMessageWindow_ &amp;&amp; pTBMessageWindow_ == ev.target )<br/>
{<br/>
if ( ev.type == EVENT_TYPE_CLICK )<br/>
{<br/>
TBWidgetListener::RemoveGlobalListener( this );</p>
<pre><code>        SendEventMsg();
    }
}

return false; 
</code></pre>
<p>}</p>
<p>void UTBListener::SendEventMsg()<br/>
{<br/>
using namespace TBMessageNamespace;</p>
<pre><code>VariantMap&amp; eventData = GetEventDataMap();
eventData[P_TBWIDGET] = GetTBMessageWidget();

SendEvent( E_TBMSG, eventData );
</code></pre>
<p>}<br/>
[/code]<br/>
<span class="bbcode-b">UTBRendererBatcher.h</span></p>
<p>[code]//=============================================================================<br/>
// Copyright © 2015 LumakSoftware<br/>
//<br/>
//=============================================================================<br/>
<span class="hashtag">#pragma</span> once</p>
<p><span class="hashtag">#include</span> &lt;Urho3D/Urho3D.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_widgets.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_renderer.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/renderers/tb_renderer_batcher.h&gt;</p>
<p>namespace Urho3D<br/>
{<br/>
class Context;<br/>
class VertexBuffer;<br/>
class Texture2D;<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
using namespace Urho3D;<br/>
using namespace tb;</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
class UTBBitmap : public TBBitmap<br/>
{<br/>
public:<br/>
UTBBitmap(Context *_pContext, int _width, int _height);<br/>
~UTBBitmap();</p>
<pre><code>// =========== virtual methods required for TBBitmap subclass =========
virtual void SetData(uint32 *_pdata)
{
    texture_-&gt;SetData( 0, 0, 0, width_, height_, _pdata );
}

virtual int Width() { return width_; }
virtual int Height(){ return height_; }

SharedPtr&lt;Context&gt;      context_;
SharedPtr&lt;Texture2D&gt;    texture_;
int                     width_;
int                     height_;
</code></pre>
<p>};</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
class UTBRendererBatcher : public UIElement, public TBRendererBatcher<br/>
{<br/>
URHO3D_OBJECT( UTBRendererBatcher, UIElement );<br/>
public:<br/>
// static funcs<br/>
static void Create(Context *_pContext, int <em>iwidth, int <em>iheight)<br/>
{<br/>
if ( pSingleton</em> == NULL )<br/>
{<br/>
pSingleton</em> = new UTBRendererBatcher( _pContext, _iwidth, _iheight );<br/>
}<br/>
}</p>
<pre><code>static void Destroy()
{
    if ( pSingleton_ )
    {
        pSingleton_-&gt;Remove();
        pSingleton_ = NULL;
    }
}

static UTBRendererBatcher&amp; Singleton() { return *pSingleton_; }

// methods
void Init(const String &amp;_strDataPath);
void LoadDefaultResources();

TBWidget&amp; Root() { return root_; }
const String&amp; GetDataPath() { return strDataPath_; }

// override funcs
virtual void BeginPaint(int render_target_w, int render_target_h);
virtual void EndPaint();

// UIElement override method to add TB batches
virtual void GetBatches(PODVector&lt;UIBatch&gt;&amp; batches, PODVector&lt;float&gt;&amp; vertexData, const IntRect&amp; currentScissor);

// ===== methods that need implementation in TBRendererBatcher subclasses =====
virtual TBBitmap* CreateBitmap(int width, int height, uint32 *data);

virtual void RenderBatch(Batch *batch);

virtual void SetClipRect(const TBRect &amp;rect)
{
    m_clip_rect = rect;
}
</code></pre>
<p>protected:<br/>
// override methods<br/>
virtual void AddQuadInternal(const TBRect &amp;dst_rect, const TBRect &amp;src_rect, uint32 color, TBBitmap *bitmap, TBBitmapFragment *fragment);</p>
<p>protected:<br/>
UTBRendererBatcher(Context *_pContext, int _iwidth, int _iheight);<br/>
virtual ~UTBRendererBatcher();</p>
<pre><code>void OnResizeWin(int _iwidth, int _iheight);
void CreateKeyMap();
void RegisterHandlers();

void HandleUpdate(StringHash eventType, VariantMap&amp; eventData);

// renderer
void HandleScreenMode(StringHash eventType, VariantMap&amp; eventData);
void HandleBeginFrame(StringHash eventType, VariantMap&amp; eventData);
void HandlePostUpdate(StringHash eventType, VariantMap&amp; eventData);
void HandlePostRenderUpdate(StringHash eventType, VariantMap&amp; eventData);

// inputs
void HandleMouseButtonDown(StringHash eventType, VariantMap&amp; eventData);
void HandleMouseButtonUp(StringHash eventType, VariantMap&amp; eventData);
void HandleMouseMove(StringHash eventType, VariantMap&amp; eventData);
void HandleMouseWheel(StringHash eventType, VariantMap&amp; eventData);
void HandleKeyDown(StringHash eventType, VariantMap&amp; eventData);
void HandleKeyUp(StringHash eventType, VariantMap&amp; eventData);
void HandleTextInput(StringHash eventType, VariantMap&amp; eventData);

// TB special and quality keys func
int FindTBKey(int _ikey);
</code></pre>
<p>protected:<br/>
static UTBRendererBatcher   *pSingleton_;</p>
<pre><code>TBWidget            root_;
PODVector&lt;float&gt;    vertexData_;
PODVector&lt;UIBatch&gt;  batches_;

String              strDataPath_;

HashMap&lt;int, int&gt;   uKeytoTBkeyMap;
IntVector2          lastMousePos_;
</code></pre>
<p>};</p>
<p>[/code]<br/>
<span class="bbcode-b">UTBRendererBatcher.cpp</span></p>
<p>[code]//=============================================================================<br/>
// Copyright © 2015 LumakSoftware<br/>
//<br/>
//=============================================================================<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Urho3D.h&gt;</p>
<p><span class="hashtag">#include</span> &lt;Urho3D/Core/Context.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Core/Object.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Core/CoreEvents.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/UI/UI.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/UI/UIElement.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/UI/UIEvents.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Graphics/Graphics.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Graphics/GraphicsEvents.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Graphics/VertexBuffer.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Graphics/Texture2D.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Resource/ResourceCache.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/IO/FileSystem.h&gt;<br/>
<span class="hashtag">#include</span> &lt;Urho3D/Input/InputEvents.h&gt;</p>
<p><span class="hashtag">#include</span> &lt;TurboBadger/tb_font_renderer.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_widgets.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_bitmap_fragment.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_system.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_msg.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/tb_language.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/animation/tb_animation.h&gt;<br/>
<span class="hashtag">#include</span> &lt;TurboBadger/animation/tb_widget_animation.h&gt;</p>
<p><span class="hashtag">#include</span> “UTBRendererBatcher.h”</p>
<p><span class="hashtag">#include</span> &lt;Urho3D/DebugNew.h&gt;</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
<span class="hashtag">#define</span> QAL_VAL         0x60000000 // value to offset qualifier keys from all other keys in the same hash map</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
UTBRendererBatcher* UTBRendererBatcher::pSingleton_ = NULL;</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
UTBBitmap::UTBBitmap(Context *<em>pContext, int <em>width, int <em>height)<br/>
: context</em>( <em>pContext )<br/>
, width</em>( <em>width )<br/>
, height</em>( <em>height )<br/>
, texture</em>( NULL )<br/>
{<br/>
texture</em> = new Texture2D( context</em> );</p>
<pre><code>// set texture format
texture_-&gt;SetMipsToSkip( QUALITY_LOW, 0 );
texture_-&gt;SetNumLevels( 1 );
texture_-&gt;SetSize( width_, height_, Graphics::GetRGBAFormat() );

// set uv modes
texture_-&gt;SetAddressMode( COORD_U, ADDRESS_WRAP );
texture_-&gt;SetAddressMode( COORD_V, ADDRESS_WRAP );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
UTBBitmap::~UTBBitmap()<br/>
{<br/>
if ( texture_ )<br/>
{<br/>
texture_ = NULL;<br/>
}<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
UTBRendererBatcher::UTBRendererBatcher(Context *_pContext, int _iwidth, int _iheight)<br/>
: UIElement( _pContext )<br/>
, TBRendererBatcher()<br/>
{<br/>
SetPosition( 0, 0 );<br/>
OnResizeWin( _iwidth, _iheight );<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
UTBRendererBatcher::~UTBRendererBatcher()<br/>
{<br/>
vertexData_.Clear();<br/>
batches_.Clear();<br/>
uKeytoTBkeyMap.Clear();</p>
<pre><code>TBWidgetsAnimationManager::Shutdown();

// shutdown
tb_core_shutdown();
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::OnResizeWin(int _iwidth, int _iheight)<br/>
{<br/>
m_screen_rect = TBRect( 0, 0, _iwidth, _iheight );</p>
<pre><code>SetSize( _iwidth, _iheight );

root_.SetRect( m_screen_rect );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::Init(const String &amp;_strDataPath)<br/>
{<br/>
// register with UI<br/>
GetSubsystem()-&gt;GetRoot()-&gt;AddChild( this );</p>
<pre><code>// store data path
strDataPath_ = GetSubsystem&lt;FileSystem&gt;()-&gt;GetProgramDir() + _strDataPath;

// init tb core
tb_core_init( this );

// load resources
LoadDefaultResources();

// map keys
CreateKeyMap();

// register handlers
RegisterHandlers();
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::LoadDefaultResources()<br/>
{<br/>
g_tb_lng-&gt;Load(“resources/language/lng_en.tb.txt”);</p>
<pre><code>// Load the default skin, and override skin that contains the graphics specific to the demo.
g_tb_skin-&gt;Load("resources/default_skin/skin.tb.txt", "demo01/skin/skin.tb.txt");

// **README**
// - define TB_FONT_RENDERER_FREETYPE in tb_config.h for non-demo
</code></pre>
<p><span class="hashtag">#ifdef</span> TB_FONT_RENDERER_TBBF<br/>
void register_tbbf_font_renderer();<br/>
register_tbbf_font_renderer();<br/>
<span class="hashtag">#endif</span><br/>
<span class="hashtag">#ifdef</span> TB_FONT_RENDERER_STB<br/>
void register_stb_font_renderer();<br/>
register_stb_font_renderer();<br/>
<span class="hashtag">#endif</span><br/>
<span class="hashtag">#ifdef</span> TB_FONT_RENDERER_FREETYPE<br/>
void register_freetype_font_renderer();<br/>
register_freetype_font_renderer();<br/>
<span class="hashtag">#endif</span></p>
<pre><code>// Add fonts we can use to the font manager.
</code></pre>
<p><span class="hashtag">#if</span> defined(TB_FONT_RENDERER_STB) || defined(TB_FONT_RENDERER_FREETYPE)<br/>
g_font_manager-&gt;AddFontInfo(“resources/vera.ttf”, “Vera”);<br/>
<span class="hashtag">#endif</span><br/>
<span class="hashtag">#ifdef</span> TB_FONT_RENDERER_TBBF<br/>
g_font_manager-&gt;AddFontInfo(“resources/default_font/segoe_white_with_shadow.tb.txt”, “Segoe”);<br/>
g_font_manager-&gt;AddFontInfo(“fonts/neon.tb.txt”, “Neon”);<br/>
g_font_manager-&gt;AddFontInfo(“fonts/orangutang.tb.txt”, “Orangutang”);<br/>
g_font_manager-&gt;AddFontInfo(“fonts/orange.tb.txt”, “Orange”);<br/>
<span class="hashtag">#endif</span></p>
<pre><code>// Set the default font description for widgets to one of the fonts we just added
TBFontDescription fd;
</code></pre>
<p><span class="hashtag">#ifdef</span> TB_FONT_RENDERER_TBBF<br/>
fd.SetID(TBIDC(“Segoe”));<br/>
<span class="hashtag">#else</span><br/>
fd.SetID(TBIDC(“Vera”));<br/>
<span class="hashtag">#endif</span><br/>
fd.SetSize(g_tb_skin-&gt;GetDimensionConverter()-&gt;DpToPx(14));<br/>
g_font_manager-&gt;SetDefaultFontDescription(fd);</p>
<pre><code>// Create the font now.
TBFontFace *font = g_font_manager-&gt;CreateFontFace(g_font_manager-&gt;GetDefaultFontDescription());

// Render some glyphs in one go now since we know we are going to use them. It would work fine
// without this since glyphs are rendered when needed, but with some extra updating of the glyph bitmap.
if ( font )
{
    font-&gt;RenderGlyphs(" !\"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~????????");
}

root_.SetSkinBg(TBIDC("background"));

TBWidgetsAnimationManager::Init();
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::CreateKeyMap()<br/>
{<br/>
// special keys<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_UP       , TB_KEY_UP        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_DOWN     , TB_KEY_DOWN      ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_LEFT     , TB_KEY_LEFT      ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_RIGHT    , TB_KEY_RIGHT     ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_PAGEUP   , TB_KEY_PAGE_UP   ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_PAGEDOWN , TB_KEY_PAGE_DOWN ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_HOME     , TB_KEY_HOME      ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_END      , TB_KEY_END       ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_TAB      , TB_KEY_TAB       ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_BACKSPACE, TB_KEY_BACKSPACE ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_INSERT   , TB_KEY_INSERT    ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_DELETE   , TB_KEY_DELETE    ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_RETURN   , TB_KEY_ENTER     ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_ESC      , TB_KEY_ESC       ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F1       , TB_KEY_F1        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F2       , TB_KEY_F2        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F3       , TB_KEY_F3        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F4       , TB_KEY_F4        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F5       , TB_KEY_F5        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F6       , TB_KEY_F6        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F7       , TB_KEY_F7        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F8       , TB_KEY_F8        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F9       , TB_KEY_F9        ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F10      , TB_KEY_F10       ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F11      , TB_KEY_F11       ) );<br/>
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( KEY_F12      , TB_KEY_F12       ) );</p>
<pre><code>// qualifiers: add QAL_VAL to qual keys to separate their range from rest of the keys
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( QUAL_SHIFT + QAL_VAL, TB_SHIFT ) );
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( QUAL_CTRL  + QAL_VAL, TB_CTRL  ) );
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( QUAL_ALT   + QAL_VAL, TB_ALT   ) );
uKeytoTBkeyMap.Insert( Pair&lt;int,int&gt;( QUAL_ANY   + QAL_VAL, TB_SUPER ) );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
TBBitmap* UTBRendererBatcher::CreateBitmap(int width, int height, uint32 *data)<br/>
{<br/>
UTBBitmap *pUTBBitmap = new UTBBitmap( GetContext(), width, height );</p>
<pre><code>FlushBitmap( (TBBitmap*)pUTBBitmap );

pUTBBitmap-&gt;SetData( data );

return (TBBitmap*)pUTBBitmap;
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::RenderBatch(Batch *_pb)<br/>
{<br/>
if ( _pb )<br/>
{<br/>
UTBBitmap <em>pUTBBitmap = (UTBBitmap</em>)<em>pb-&gt;bitmap;<br/>
SharedPtr tdummy;<br/>
SharedPtr texture = pUTBBitmap?pUTBBitmap-&gt;texture</em>: tdummy;<br/>
IntRect scissor( _pb-&gt;clipRect.x, _pb-&gt;clipRect.y, _pb-&gt;clipRect.x + _pb-&gt;clipRect.w, _pb-&gt;clipRect.y + <em>pb-&gt;clipRect.h );<br/>
UIBatch batch( this, BLEND_ALPHA, scissor, texture, &amp;vertexData</em> );</p>
<pre><code>    unsigned begin = batch.vertexData_-&gt;Size();
    batch.vertexData_-&gt;Resize(begin + _pb-&gt;vertex_count * UI_VERTEX_SIZE);
    float* dest = &amp;(batch.vertexData_-&gt;At(begin));

    // set start/end
    batch.vertexStart_ = begin;
    batch.vertexEnd_   = batch.vertexData_-&gt;Size();

    for ( int i = 0; i &lt; _pb-&gt;vertex_count; ++i )
    {
        dest[0+i*UI_VERTEX_SIZE]              = _pb-&gt;vertex[i].x; 
        dest[1+i*UI_VERTEX_SIZE]              = _pb-&gt;vertex[i].y; 
        dest[2+i*UI_VERTEX_SIZE]              = 0.0f;
        ((unsigned&amp;)dest[3+i*UI_VERTEX_SIZE]) = _pb-&gt;vertex[i].col;
        dest[4+i*UI_VERTEX_SIZE]              = _pb-&gt;vertex[i].u; 
        dest[5+i*UI_VERTEX_SIZE]              = _pb-&gt;vertex[i].v;
    }

    // store
    UIBatch::AddOrMerge( batch, batches_ );
}
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::GetBatches(PODVector&amp; batches, PODVector&amp; vertexData, const IntRect&amp; currentScissor)<br/>
{<br/>
for ( unsigned i = 0; i &lt; batches_.Size(); ++i )<br/>
{<br/>
// get batch<br/>
UIBatch &amp;batch     = batches_[ i ];<br/>
unsigned beg       = batch.vertexStart_;<br/>
unsigned end       = batch.vertexEnd_;<br/>
batch.vertexStart_ = vertexData.Size();<br/>
batch.vertexEnd_   = vertexData.Size() + (end - beg);</p>
<pre><code>    // resize and copy
    vertexData.Resize( batch.vertexEnd_ );
    memcpy( &amp;vertexData[ batch.vertexStart_ ], &amp;vertexData_[ beg ], (end - beg) * sizeof(float) );

    // store
    UIBatch::AddOrMerge( batch, batches );
}

// clear buffers
vertexData_.Clear();
batches_.Clear();
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::BeginPaint(int render_target_w, int render_target_h)<br/>
{<br/>
TBRendererBatcher::BeginPaint( render_target_w, render_target_h );<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::EndPaint()<br/>
{<br/>
TBRendererBatcher::EndPaint();<br/>
}</p>
<p>//=============================================================================<br/>
// TBRendererBatcher::AddQuadInternal function override<br/>
// ** move this to TurboBadger/renderers/tb_renderer_batcher.cpp once you understand the changes, as this function should be in the library<br/>
//=============================================================================<br/>
void UTBRendererBatcher::AddQuadInternal(const TBRect &amp;dst_rect, const TBRect &amp;src_rect, uint32 color,<br/>
TBBitmap *bitmap, TBBitmapFragment *fragment)<br/>
{<br/>
if (batch.bitmap != bitmap)<br/>
{<br/>
batch.Flush(this);<br/>
batch.bitmap = bitmap;<br/>
}<br/>
batch.fragment = fragment;</p>
<pre><code>// save clip rect
// **note** the clipRect member var, as declared below, was added to the Batch class in tb_renderer_batcher.h
// TBRect clipRect; 
batch.clipRect = m_clip_rect;

if ( bitmap )
{
    // ** Urho3D adds UV offset when using DX, see:
    // https://github.com/urho3d/Urho3D/commit/0990fd72f239594fae113820233d1f858325f8dd
    #ifdef URHO3D_OPENGL
    float uvOffset = 0.0f;
    #else
    float uvOffset = 0.5f;
    #endif
    int bitmap_w = bitmap-&gt;Width();
    int bitmap_h = bitmap-&gt;Height();
    m_u  = (float)(src_rect.x + uvOffset)/ bitmap_w;
    m_v  = (float)(src_rect.y + uvOffset)/ bitmap_h;
    m_uu = (float)(src_rect.x + uvOffset + src_rect.w) / bitmap_w;
    m_vv = (float)(src_rect.y + uvOffset + src_rect.h) / bitmap_h;
}

// change triangle winding order to clock-wise
Vertex *ver = batch.Reserve(this, 6);
ver[0].x = (float) dst_rect.x;
ver[0].y = (float) (dst_rect.y + dst_rect.h);
ver[0].u = m_u;
ver[0].v = m_vv;
ver[0].col = color;
ver[2].x = (float) (dst_rect.x + dst_rect.w);
ver[2].y = (float) (dst_rect.y + dst_rect.h);
ver[2].u = m_uu;
ver[2].v = m_vv;
ver[2].col = color;
ver[1].x = (float) dst_rect.x;
ver[1].y = (float) dst_rect.y;
ver[1].u = m_u;
ver[1].v = m_v;
ver[1].col = color;

ver[3].x = (float) dst_rect.x;
ver[3].y = (float) dst_rect.y;
ver[3].u = m_u;
ver[3].v = m_v;
ver[3].col = color;
ver[5].x = (float) (dst_rect.x + dst_rect.w);
ver[5].y = (float) (dst_rect.y + dst_rect.h);
ver[5].u = m_uu;
ver[5].v = m_vv;
ver[5].col = color;
ver[4].x = (float) (dst_rect.x + dst_rect.w);
ver[4].y = (float) dst_rect.y;
ver[4].u = m_uu;
ver[4].v = m_v;
ver[4].col = color;

// Update fragments batch id (See FlushBitmapFragment)
if (fragment)
    fragment-&gt;m_batch_id = batch.batch_id;
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::RegisterHandlers()<br/>
{<br/>
// timer<br/>
SubscribeToEvent(E_UPDATE, URHO3D_HANDLER(UTBRendererBatcher, HandleUpdate));</p>
<pre><code>// screen resize and renderer
SubscribeToEvent(E_SCREENMODE, URHO3D_HANDLER(UTBRendererBatcher, HandleScreenMode));
SubscribeToEvent(E_BEGINFRAME, URHO3D_HANDLER(UTBRendererBatcher, HandleBeginFrame));
SubscribeToEvent(E_POSTUPDATE, URHO3D_HANDLER(UTBRendererBatcher, HandlePostUpdate));
SubscribeToEvent(E_POSTRENDERUPDATE, URHO3D_HANDLER(UTBRendererBatcher, HandlePostRenderUpdate));

// inputs
SubscribeToEvent(E_MOUSEBUTTONDOWN, URHO3D_HANDLER(UTBRendererBatcher, HandleMouseButtonDown));
SubscribeToEvent(E_MOUSEBUTTONUP, URHO3D_HANDLER(UTBRendererBatcher, HandleMouseButtonUp));
SubscribeToEvent(E_MOUSEMOVE, URHO3D_HANDLER(UTBRendererBatcher, HandleMouseMove));
SubscribeToEvent(E_MOUSEWHEEL, URHO3D_HANDLER(UTBRendererBatcher, HandleMouseWheel));
SubscribeToEvent(E_KEYDOWN, URHO3D_HANDLER(UTBRendererBatcher, HandleKeyDown));
SubscribeToEvent(E_KEYUP, URHO3D_HANDLER(UTBRendererBatcher, HandleKeyUp));
SubscribeToEvent(E_TEXTINPUT, URHO3D_HANDLER(UTBRendererBatcher, HandleTextInput));
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleUpdate(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
// msg timer<br/>
double t = TBMessageHandler::GetNextMessageFireTime();</p>
<pre><code>if ( t != TB_NOT_SOON &amp;&amp; t &lt;= TBSystem::GetTimeMS() )
{
    TBMessageHandler::ProcessMessages();
}
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleScreenMode(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace ScreenMode;</p>
<pre><code>OnResizeWin( eventData[P_WIDTH].GetInt(), eventData[P_HEIGHT].GetInt() );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleBeginFrame(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
TBAnimationManager::Update();<br/>
root_.InvokeProcessStates();<br/>
root_.InvokeProcess();<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandlePostUpdate(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
BeginPaint( root_.GetRect().w, root_.GetRect().h );</p>
<pre><code>root_.InvokePaint( TBWidget::PaintProps() );

// If animations are running, reinvalidate immediately
if ( TBAnimationManager::HasAnimationsRunning() )
{
    root_.Invalidate();
}
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandlePostRenderUpdate(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
EndPaint();<br/>
}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleMouseButtonDown(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace MouseButtonDown;</p>
<pre><code>int mouseButtons = eventData[P_BUTTONS].GetInt();
int qualifiers = eventData[P_QUALIFIERS].GetInt();
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );

// exit if not the left mb
if ( mouseButtons != MOUSEB_LEFT )
{
    return;
}

root_.InvokePointerDown( lastMousePos_.x_, lastMousePos_.y_, 1, modKey, false );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleMouseButtonUp(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace MouseButtonUp;</p>
<pre><code>int qualifiers = eventData[P_QUALIFIERS].GetInt();
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );

root_.InvokePointerUp( lastMousePos_.x_, lastMousePos_.y_, modKey, false );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleMouseMove(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace MouseMove;</p>
<pre><code>int qualifiers = eventData[P_QUALIFIERS].GetInt();
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );
lastMousePos_ = IntVector2( eventData[P_X].GetInt(), eventData[P_Y].GetInt() );

root_.InvokePointerMove( lastMousePos_.x_, lastMousePos_.y_, modKey, false );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleMouseWheel(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace MouseWheel;</p>
<pre><code>int qualifiers = eventData[P_QUALIFIERS].GetInt();
int delta = eventData[P_WHEEL].GetInt();
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );

root_.InvokeWheel( lastMousePos_.x_, lastMousePos_.y_, 0, -delta, modKey );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleKeyDown(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace KeyDown;</p>
<pre><code>int qualifiers = eventData[P_QUALIFIERS].GetInt();
int key = eventData[P_KEY].GetInt();
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );
SPECIAL_KEY spKey = (SPECIAL_KEY)FindTBKey( key );

// exit if not a special key
if ( spKey == TB_KEY_UNDEFINED )
{
    return;
}

root_.InvokeKey( key, spKey, modKey, true );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleKeyUp(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace KeyUp;</p>
<pre><code>int qualifiers = eventData[P_QUALIFIERS].GetInt();
int key = eventData[P_KEY].GetInt();
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );
SPECIAL_KEY spKey = (SPECIAL_KEY)FindTBKey( key );

root_.InvokeKey( key, spKey, modKey, false );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
void UTBRendererBatcher::HandleTextInput(StringHash eventType, VariantMap&amp; eventData)<br/>
{<br/>
using namespace TextInput;</p>
<pre><code>int qualifiers = eventData[P_QUALIFIERS].GetInt();
int key = (int)eventData[ P_TEXT ].GetString().CString()[ 0 ];
MODIFIER_KEYS modKey = (MODIFIER_KEYS)FindTBKey( qualifiers + QAL_VAL );

root_.InvokeKey( key, TB_KEY_UNDEFINED, modKey, true );
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
// TB special and quality keys func<br/>
//=============================================================================<br/>
int UTBRendererBatcher::FindTBKey(int _ikey)<br/>
{<br/>
HashMap&lt;int, int&gt;::Iterator itr = uKeytoTBkeyMap.Find( _ikey );<br/>
int itbkey = 0;</p>
<pre><code>if ( itr != uKeytoTBkeyMap.End() )
{
    itbkey = itr-&gt;second_;
}

return itbkey;
</code></pre>
<p>}</p>
<p>//=============================================================================<br/>
//=============================================================================<br/>
class UTBFile : public TBFile<br/>
{<br/>
public:<br/>
UTBFile(Context *<em>pContext)<br/>
: ufileSize</em>( 0 )<br/>
{<br/>
pfile_ = new File( _pContext );<br/>
}</p>
<pre><code>virtual ~UTBFile() 
{ 
    if ( pfile_ )
    {
        pfile_-&gt;Close();
        pfile_ = NULL;
    }
}

bool OpenFile(const char* fileName)
{
    bool bopen = pfile_-&gt;Open( fileName );

    if ( bopen )
    {
        ufileSize_ = pfile_-&gt;Seek( (unsigned)-1 );
        pfile_-&gt;Seek( 0 );
    }

    return bopen;
}

virtual long Size()
{
    return (long)ufileSize_;
}

virtual size_t Read(void *buf, size_t elemSize, size_t count)
{
    return pfile_-&gt;Read( buf, elemSize * count );
}
</code></pre>
<p>protected:<br/>
SharedPtr pfile_;<br/>
unsigned ufileSize_;<br/>
};</p>
<p>//=============================================================================<br/>
// static<br/>
//=============================================================================<br/>
TBFile* TBFile::Open(const char *filename, TBFileMode )<br/>
{<br/>
UTBFile *pFile = new UTBFile( UTBRendererBatcher::Singleton().GetContext() );<br/>
String strFilename = UTBRendererBatcher::Singleton().GetDataPath() + String( filename );</p>
<pre><code>if ( !pFile-&gt;OpenFile( strFilename.CString() ) )
{
    delete pFile;
    pFile = NULL;
}

return pFile;
</code></pre>
<p>}<br/>
[/code]<br/>
This worked with the latest of URHO3D (March 20 2016). I have the GUI displaying with this version (URHO 3D 1.5 GITHUB head revision 03/20/16).</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>BTW the licensing is messed up.<br/>
You got zlib license in the <a href="http://README.md" rel="nofollow noopener">README.md</a>, but all rights reserved in the source files.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>My TB integration work is <a data-bbcode="true" href="https://opensource.org/licenses/MIT">MIT</a>, and that license has a precedence and covers everything that I have included in the repository (with exception to TB lib which is covered below) w/o having to recopy it in every file.<br/>
TB library has its own license - I’ve included the TB library link, the original author’s link, and its license in the <a href="http://readme.md">readme.md</a> file.</p>
<p>Edit: should I remove TB lib license to avoid any confusion?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>“Copyright © 2015 LumakSoftware” defaults to all rights reserved.<br/>
The safest option is to include the whole license in every file.<br/>
A shorter solution is to just say or add “look at file X for the license”.<br/>
Or at least don’t write anything so there are no conflicting statements.</p>
<p>You can put the TB license in a separate file (so when people scroll down and see “License” they don’t confuse it to your license), but if you include TB in your repo then you can’t remove it completely.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/{size}.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Lumak</div>
          <div class="post_content">
<p>Added the license info in the repository.<br/>
I already had the TB lib license in the Source/ThirdParty/TurboBadger/ section from day one, and I think it’s more clear about my license having the TB license removed from the main readme page.<br/>
Good call.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/81_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Enhex</div>
          <div class="post_content">
<p>Thanks!</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/87_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">sabotage3d</div>
          <div class="post_content">
<p>Anyone using TB for in-game UI or it is suitable only for debug editor?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2367_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">jmiller</div>
          <div class="post_content">
<aside class="quote no-group" data-username="sabotage3d">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/4d54cd4ee2f08a1ba79603d6f6b6ab43.png" width="20"/> sabotage3d:</div>
<blockquote>
<p>Anyone using TB for in-game UI or it is suitable only for debug editor?</p>
</blockquote>
</aside>
<p>Sure, have been using the other integration since it was posted: <a href="http://discourse.urho3d.io/t/turbo-badger-implementation/1364/1">topic1413.html</a><br/>
I’ve posted my Console widget there and I’m intending to post an animated+skinned radial menu widget soon. TB is fast, many-featured, and I like the retained mode.</p>
<p><a data-bbcode="true" href="http://imgbox.com/SSproDGw"><img alt="" height="350" src="../../../images2/36ad49143f47f8adeed756a5c1ac0a5b.jpg" width="350"/></a></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/87_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">sabotage3d</div>
          <div class="post_content">
<p>Looks really nice. I think the other one is removed is there any public repo?</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2367_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">jmiller</div>
          <div class="post_content">
<aside class="quote">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="../../../images2/db4c02596e658dc9102b66ceb5fb9d80.png" width="20"/> sabotage3d:</div>
<blockquote>
<p>Looks really nice. I think the other one is removed is there any public repo?</p>
</blockquote>
</aside>
<p>Just posted my working version in that thread.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>