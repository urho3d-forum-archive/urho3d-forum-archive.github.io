<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Editor crash: ListView and GC</title>
    <link rel="stylesheet" href="../../../archived.css" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>

  <body>
    <header class="header">
      <div class="title-span">
        <a href="../../../">
          <img src="../../../images/site-logo.png" height="40" alt="Urho3D" id="site-logo" />
        </a>
      </div>
    </header>

    <div class="main">
    <div class="archive-span">Archive 17/01/2023.</div>
    <h1 class="topic-title">Editor crash: ListView and GC</h1>
            <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2113_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">fnadalt</div>
          <div class="post_content">
<p>Hi! I’d like to report en Editor crash. When clicking on an item in the Hierarchy panel, the app crashed, without even showing anything<br/>
on the Inspector panel. Latest master branch debug compilation.</p>
<p>Backtrace:<br/>
<span class="hashtag">#0</span>  0x0000555555d046de in Urho3D::CScriptArray::Release (this=0x555500005555) at /home/flaco/build/Urho3D/Source/Urho3D/AngelScript/Addons.cpp:1596<br/>
<span class="hashtag">#1</span>  0x0000555555d6264f in asCScriptEngine::CallObjectMethod (this=0x5555573215f0, obj=0x555500005555, i=0x555557335c20, s=0x555557335cb0)<br/>
at /home/flaco/build/Urho3D/Source/ThirdParty/AngelScript/source/as_scriptengine.cpp:4020<br/>
<span class="hashtag">#2</span>  0x0000555555d62501 in asCScriptEngine::CallObjectMethod (this=0x5555573215f0, obj=0x555500005555, func=25)<br/>
at /home/flaco/build/Urho3D/Source/ThirdParty/AngelScript/source/as_scriptengine.cpp:3987<br/>
<span class="hashtag">#3</span>  0x0000555555d8e080 in asCContext::ExecuteNext (this=0x555558025860) at /home/flaco/build/Urho3D/Source/ThirdParty/AngelScript/source/as_context.cpp:2781<br/>
<span class="hashtag">#4</span>  0x0000555555d8a6f4 in asCContext::Execute (this=0x555558025860) at /home/flaco/build/Urho3D/Source/ThirdParty/AngelScript/source/as_context.cpp:1318<br/>
<span class="hashtag">#5</span>  0x0000555555b3d7af in Urho3D::ScriptFile::Execute (this=0x555557159790, function=0x555557fc91e0, parameters=…, unprepare=true)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/AngelScript/ScriptFile.cpp:323<br/>
<span class="hashtag">#6</span>  0x0000555555b4079a in Urho3D::ScriptEventInvoker::HandleScriptEvent (this=0x555558261b20, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/AngelScript/ScriptFile.cpp:955<br/>
<span class="hashtag">#7</span>  0x0000555555b46797 in Urho3D::EventHandlerImpl<a>Urho3D::ScriptEventInvoker</a>::Invoke (this=0x555557f23a80, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/AngelScript/…/AngelScript/…/Core/Object.h:315<br/>
<span class="hashtag">#8</span>  0x0000555555b269d1 in Urho3D::Object::OnEvent (this=0x555558261b20, sender=0x555557d342c0, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:116<br/>
<span class="hashtag">#9</span>  0x0000555555b274d6 in Urho3D::Object::SendEvent (this=0x555557d342c0, eventType=…, eventData=…) at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:330<br/>
<span class="hashtag">#10</span> 0x0000555555b272da in Urho3D::Object::SendEvent (this=0x555557d342c0, eventType=…) at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:294<br/>
<span class="hashtag">#11</span> 0x0000555555ecf0d9 in Urho3D::ListView::SetSelections (this=0x555557d342c0, indices=…) at /home/flaco/build/Urho3D/Source/Urho3D/UI/ListView.cpp:585<br/>
<span class="hashtag">#12</span> 0x0000555555eced47 in Urho3D::ListView::SetSelection (this=0x555557d342c0, index=4) at /home/flaco/build/Urho3D/Source/Urho3D/UI/ListView.cpp:513<br/>
<span class="hashtag">#13</span> 0x0000555555ed0eaf in Urho3D::ListView::HandleUIMouseClick (this=0x555557d342c0, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/UI/ListView.cpp:1046<br/>
<span class="hashtag">#14</span> 0x0000555555ed57c9 in Urho3D::EventHandlerImpl<a>Urho3D::ListView</a>::Invoke (this=0x555557f19f70, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/UI/…/Core/…/Core/Object.h:315<br/>
<span class="hashtag">#15</span> 0x0000555555b26a1c in Urho3D::Object::OnEvent (this=0x555557d342c0, sender=0x555556fc39c0, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:124<br/>
<span class="hashtag">#16</span> 0x0000555555b27638 in Urho3D::Object::SendEvent (this=0x555556fc39c0, eventType=…, eventData=…) at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:361<br/>
<span class="hashtag">#17</span> 0x0000555555e925da in Urho3D::UI::SendClickEvent (this=0x555556fc39c0, eventType=…, beginElement=0x555558dd7d10, endElement=0x555558dd7d10, pos=…,<br/>
button=Urho3D::MOUSEB_LEFT, buttons=…, qualifiers=…) at /home/flaco/build/Urho3D/Source/Urho3D/UI/UI.cpp:1650<br/>
<span class="hashtag">#18</span> 0x0000555555e917ba in Urho3D::UI::ProcessClickEnd (this=0x555556fc39c0, windowCursorPos=…, button=Urho3D::MOUSEB_LEFT, buttons=…, qualifiers=…, cursor=<br/>
0x555557d0d310, cursorVisible=true) at /home/flaco/build/Urho3D/Source/Urho3D/UI/UI.cpp:1472<br/>
<span class="hashtag">#19</span> 0x0000555555e92a5e in Urho3D::UI::HandleMouseButtonUp (this=0x555556fc39c0, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/UI/UI.cpp:1720<br/>
<span class="hashtag">#20</span> 0x0000555555e9cf33 in Urho3D::EventHandlerImpl<a>Urho3D::UI</a>::Invoke (this=0x555556fbfaf0, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/UI/…/Core/…/Core/Object.h:315<br/>
<span class="hashtag">#21</span> 0x0000555555b26a1c in Urho3D::Object::OnEvent (this=0x555556fc39c0, sender=0x555556f76f70, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:124<br/>
<span class="hashtag">#22</span> 0x0000555555b27638 in Urho3D::Object::SendEvent (this=0x555556f76f70, eventType=…, eventData=…) at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:361<br/>
<span class="hashtag">#23</span> 0x0000555555fe71e0 in Urho3D::Input::SetMouseButton (this=0x555556f76f70, button=Urho3D::MOUSEB_LEFT, newState=false)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Input/Input.cpp:1768<br/>
<span class="hashtag">#24</span> 0x0000555555fe7eeb in Urho3D::Input::HandleSDLEvent (this=0x555556f76f70, sdlEvent=0x7fffffffe3e0) at /home/flaco/build/Urho3D/Source/Urho3D/Input/Input.cpp:1961<br/>
<span class="hashtag">#25</span> 0x0000555555fe1ead in Urho3D::Input::Update (this=0x555556f76f70) at /home/flaco/build/Urho3D/Source/Urho3D/Input/Input.cpp:419<br/>
<span class="hashtag">#26</span> 0x0000555555fe9ed7 in Urho3D::Input::HandleBeginFrame (this=0x555556f76f70, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Input/Input.cpp:2436<br/>
<span class="hashtag">#27</span> 0x0000555555ff08ed in Urho3D::EventHandlerImpl<a>Urho3D::Input</a>::Invoke (this=0x5555572ee430, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Input/…/Core/…/Core/Object.h:315<br/>
<span class="hashtag">#28</span> 0x0000555555b26a1c in Urho3D::Object::OnEvent (this=0x555556f76f70, sender=0x555556f68960, eventType=…, eventData=…)<br/>
at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:124<br/>
<span class="hashtag">#29</span> 0x0000555555b27638 in Urho3D::Object::SendEvent (this=0x555556f68960, eventType=…, eventData=…) at /home/flaco/build/Urho3D/Source/Urho3D/Core/Object.cpp:361<br/>
<span class="hashtag">#30</span> 0x0000555555b2078e in Urho3D::Time::BeginFrame (this=0x555556f68960, timeStep=0.0187795013) at /home/flaco/build/Urho3D/Source/Urho3D/Core/Timer.cpp:126<br/>
<span class="hashtag">#31</span> 0x0000555555b0890a in Urho3D::Engine::RunFrame (this=0x555556f68f40) at /home/flaco/build/Urho3D/Source/Urho3D/Engine/Engine.cpp:497<br/>
<span class="hashtag">#32</span> 0x0000555555b1831e in Urho3D::Application::Run (this=0x555556f68e90) at /home/flaco/build/Urho3D/Source/Urho3D/Engine/Application.cpp:86<br/>
<span class="hashtag">#33</span> 0x0000555555a94abe in RunApplication () at /home/flaco/build/Urho3D/Source/Tools/Urho3DPlayer/Urho3DPlayer.cpp:42<br/>
<span class="hashtag">#34</span> 0x0000555555a94b70 in main (argc=3, argv=0x7fffffffe7d8) at /home/flaco/build/Urho3D/Source/Tools/Urho3DPlayer/Urho3DPlayer.cpp:42</p>
<p>Scene: bin/Data/Scenes/World.xml</p>
<p>“World” project:<br/>
<a class="onebox" href="https://drive.google.com/open?id=1chko8MpacAUgmSWMnhY0dTEI18wkmxX_" rel="nofollow noopener" target="_blank">https://drive.google.com/open?id=1chko8MpacAUgmSWMnhY0dTEI18wkmxX_</a></p>
<p>4.17.2-1-ARCH<br/>
gcc versión 8.1.1<br/>
AMD Athlon™ 64 X2 Dual Core Processor 4600+<br/>
1995MiB System memory<br/>
Cedar [Radeon HD 5000/6000/7350/8350 Series]</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>It is most probably related to AngelScript version upgrade. The latest version of AngelScript has changed how it handles constant strings. On our side that has impacted how we write our StringFactory class. In the master branch we have now a new StringFactory class which is backed by StringMap type (aka <code>HashMap&lt;StringHash, String&gt;</code>). In order to make it works, the hash generated by StringHash class should be good and fast enough without the worry of hash collision. To do that, I have changed the hash calculation logic to be case-sensitive (see <a href="https://urho3d.github.io/documentation/HEAD/_porting_notes.html">https://urho3d.github.io/documentation/HEAD/_porting_notes.html</a> “From 1.7 to master”). That change has broken the Editor somewhat and the necessary fixes have been made, but I am not surprised if there are still some being left out.</p>
<p>If you have some saved XML files, you have to make sure all your string constants have the correct letter case. For example: “CheckBox” as a UIElement type is correct, while “Checkbox” is wrong. Depends on where the string constant is being used, the mismatch may cause an AS crashes.</p>
<p>HTH.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2113_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">fnadalt</div>
          <div class="post_content">
<p>I con reproduce the crash simply by:<br/>
Open Editor<br/>
Add local Node<br/>
(Try to) add a Static Model… Crash.</p>
<p>I reached Scripts/Editor/AttributeEditor.as:1215… attrInfo.type=12<br/>
Fails within GetResourcePicker… never returns I think<br/>
Called from Scripts/Editor/AttributeEditor.as:366</p>
<p>Help…</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/4_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">weitjong</div>
          <div class="post_content">
<p>I am not able to reproduce the crash on my Linux host system. Added the static model component and picked a model  to render successfully.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/357_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">JTippetts</div>
          <div class="post_content">
<p>Make sure your Urho3DPlayer.exe is seeing the absolute latest CoreData and Data folders. The line numbers you list ( <a  rel="nofollow noopener">366</a> and  <a  rel="nofollow noopener">1215</a> ) don’t really seem to match up well with the current version of AttributeEditor.as, unless I’m mistaken, so you might be trying to run an old version and that’s an invitation to Crash City.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/1856_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">MrMilad</div>
          <div class="post_content">
<p>I’m having the same issue.<br/>
vs 2017 15.9.3<br/>
win10 10.0.15063 Build 15063<br/>
NVIDIA GeForce GT 640M<br/>
8gb ram</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2053_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Yatsomi</div>
          <div class="post_content">
<p><span class="mention">@fnadalt</span> Hi. I had the same problem with editor. Crash after adding components. Using latest commit in windows 10.<br/>
My problem fixed using <span class="mention">@lezak</span> suggestion in <a  rel="nofollow noopener">here</a>. Changing line 1203 in AttributeEditor.as<br/>
from<br/>
<code>if (resourcePickers[i].type == resourceType)</code><br/>
to<br/>
<code>if (resourcePickers[i].type.value == resourceType.value)</code></p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/3290_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Modanung</div>
          <div class="post_content">
<p>If you only modified a script (as-file) rebuilding should not be required.</p>
          </div>
        </div>
      </div>

      <div class="post_container">
        <div class="avatar_container">
          <img src="../../../images/2053_2.png" class="avatar" />
        </div>
        <div class="post">
          <div class="user_name">Yatsomi</div>
          <div class="post_content">
<p>Yeah you are right, my bad, sorry.</p>
          </div>
        </div>
      </div>


    </div>
  </body>
</html>